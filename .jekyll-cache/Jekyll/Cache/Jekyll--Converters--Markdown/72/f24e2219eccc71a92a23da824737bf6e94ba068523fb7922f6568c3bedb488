I"ºh<h1 id="1-dockerä»‹ç»">1. Dockerä»‹ç»</h1>

<h2 id="11-ä»€ä¹ˆæ˜¯docker">1.1. ä»€ä¹ˆæ˜¯Docker</h2>

<ul>
  <li>Dockeræ˜¯ Docker.Incå…¬å¸å¼€æºçš„ä¸€ä¸ªåŸºäºLXCæŠ€æœ¯ä¹‹ä¸Šæ„å»ºçš„containerå®¹å™¨å¼•æ“æŠ€æœ¯ã€‚</li>
  <li>DockeråŸºäºå®¹å™¨æŠ€æœ¯çš„è½»é‡çº§è™šæ‹ŸåŒ–è§£å†³æ–¹æ¡ˆã€‚</li>
  <li>Dockeræ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè¯ç”Ÿäº2013å¹´ï¼ŒåŸºäº Googleå…¬å¸é€€å‡ºçš„Goè¯­è¨€å®ç°</li>
  <li>å¾®è½¯ã€Redhatã€IBMã€Oracleç­‰ä¸»æµITå‚å•†å·²ç»åœ¨è‡ªå·±çš„äº§å“é‡Œé¢å¢åŠ å¤šDockerçš„æ”¯æŒ</li>
  <li>Gooler æ¯å‘¨å¯åŠ¨è¶…è¿‡æ•°äº¿ä¸ªå®¹å™¨è¿›è¡Œä¸šåŠ¡æœåŠ¡ï¼Œäºä¸Šå®é™…90å¹´ä»£å·²ç»å¼€å§‹å¤§è§„æ¨¡ä½¿ç”¨çš„å®¹å™¨æŠ€æœ¯ã€‚</li>
</ul>

<h2 id="12-dockerå†å²">1.2. Dockerå†å²</h2>

<p>2013å¹´docker/coreOSè¯ç”Ÿ
2014å¹´è·å–4000ä¸‡ç¾å…ƒèèµ„
-2015å¹´èèµ„è¶…è¿‡1äº¿ç¾å…ƒ
2015å¹´6æœˆæˆç«‹å¼€æ”¾å®¹å™¨æŠ€æœ¯é¡¹ç›®â€œopen container projectâ€</p>

<h2 id="13-é›†è£…ç®±">1.3. é›†è£…ç®±</h2>

<h2 id="14-ä¼ ç»Ÿvmæ–¹æ¡ˆç—›ç‚¹">1.4. ä¼ ç»ŸVMæ–¹æ¡ˆç—›ç‚¹</h2>

<ol>
  <li>èµ„æºåˆ©ç”¨ä½</li>
  <li>å•ç‰©ç†æœºå¤šåº”ç”¨æ— æ³•æœ‰æ•ˆéš”ç¦»ï¼ˆè¿›ç¨‹ç©ºé—´ã€cpuèµ„æºã€ç£ç›˜ï¼‰</li>
  <li>è¿ç»´éƒ¨ç½²ä¸æ–¹ä¾¿</li>
  <li>æµ‹è¯•ã€ç‰ˆæœ¬ç®¡ç†å¤æ‚</li>
  <li>æ— æ³•é«˜æ•ˆäº¤äº’</li>
  <li>ä¼ ç»Ÿè™šæ‹Ÿæœºï¼Œç©ºé—´å ç”¨å¤§ã€å¯åŠ¨æ…¢ã€ç®¡ç†å¤æ‚ã€‚</li>
</ol>

<h2 id="15-dockerçš„ä¼˜åŠ¿">1.5. Dockerçš„ä¼˜åŠ¿</h2>

<ol>
  <li>ç§’çº§å¯åŠ¨ã€åœæ­¢ï¼Œç©ºé—´å ç”¨å°‘</li>
  <li>å®ç°è¿›ç¨‹çº§åˆ«çš„éš”ç¦»</li>
  <li>å¯åœ¨æ™®é€šæœåŠ¡å™¨ä¸Šå»ºç«‹ä¸Šç™¾ä¸ªdockerå®ä¾‹</li>
  <li>åŠ å¿«å¼€å‘æµ‹è¯•éƒ¨ç½²çš„é€Ÿåº¦</li>
  <li>ç®€åŒ–ç‰ˆæœ¬ç®¡ç†</li>
  <li>é«˜æ•ˆçš„äº¤ä»˜æ–¹æ¡ˆ</li>
</ol>

<h1 id="2-dockeråŸºæœ¬åŸç†">2. DockeråŸºæœ¬åŸç†</h1>

<h2 id="21-docker-ä¸‰å¤§æ ¸å¿ƒ">2.1. Docker ä¸‰å¤§æ ¸å¿ƒ</h2>

<p>é•œåƒimagesã€ä»“åº“ã€å®¹å™¨Container</p>

<p>é•œåƒï¼šæ–‡ä»¶å±‚æ¬¡ç»“æ„ï¼Œä»¥åŠåŒ…å«å¦‚ä½•è¿è¡Œå®¹å™¨çš„å…ƒæ•°æ®ï¼ŒDockerfileä¸­çš„æ¯æ¡å‘½ä»¤éƒ½ä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å±‚æ¬¡ç»“æ„ï¼Œæ–‡ä»¶ç³»ç»Ÿåœ¨è¿™äº›å±‚æ¬¡ç»“æ„ä¸Šå»ºç«‹èµ·æ¥ï¼Œé•œåƒå°±æ„å»ºè¿™äº›è”åˆçš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Š</p>

<dl>
  <dt>å®¹å™¨</dt>
  <dd>å®¹å™¨æ˜¯é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ï¼Œå®ƒå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ã€‚æ¯ä¸ªå®¹å™¨æ˜¯ç›¸äº’éš”ç¦»çš„ã€ä¿è¯å®‰å…¨çš„å¹³å°ã€‚å¯ä»¥æŠŠå®¹å™¨çœ‹ç€ç®€æ˜“ç‰ˆçš„Linuxç¯å¢ƒï¼ŒDockeråˆ©ç”¨å®¹å™¨æ¥è¿è¡Œåº”ç”¨ã€‚</dd>
</dl>

<p>ä»“åº“ï¼šä»“åº“æ˜¯é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€ï¼Œä»“åº“æ³¨å†ŒæœåŠ¡å™¨ä¸Šå¾€å¾€å­˜æ”¾ç€å¤šä¸ªä»“åº“ï¼Œæ¯ä¸ªä»“åº“ä¸­åˆä¿æŠ¤äº†å¤šä¸ªé•œåƒï¼Œæ¯ä¸ªé•œåƒæœ‰ä¸åŒçš„æ ‡ç­¾tagã€‚ç›®å‰æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯Docker Hubï¼Œå­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒæä¾›ç”¨æˆ·ä¸‹è½½ã€‚</p>

<h2 id="22-docker-ç‰¹æ€§">2.2. Docker ç‰¹æ€§</h2>

<ol>
  <li>æ–‡ä»¶ç³»ç»Ÿéš”ç¦» - æ¯ä¸ªè¿›ç¨‹å®¹å™¨è¿è¡Œåœ¨å®Œå…¨ç‹¬ç«‹çš„è·Ÿæ–‡ä»¶ç³»ç»Ÿé‡Œã€‚</li>
  <li>èµ„æºé™åˆ¶ - å¯ä»¥ä½¿ç”¨cgroupä¸ºæ¯ä¸ªè¿›ç¨‹å®¹å™¨åˆ†é…ä¸åŒçš„ç³»ç»Ÿèµ„æºï¼Œä¾‹å¦‚CPUå’Œå†…å­˜ã€‚</li>
  <li>namespaceå‘½åç©ºé—´éš”ç¦» - æ¯ä¸ªè¿›ç¨‹å®¹å™¨è¿è¡Œåœ¨è‡ªå·±çš„ç½‘ç»œå‘½åç©ºé—´é‡Œï¼Œæ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿæ¥å£çš„IPåœ°å€ç­‰ã€‚</li>
  <li>å†™æ˜¯å¤åˆ¶ - ç”±äºé•œåƒé‡‡ç”¨å±‚æ¬¡æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥é‡‡ç”¨å†™æ—¶å¤åˆ¶æ–¹å¼åˆ›å»ºé•œåƒçš„è·Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œè¿™è®©éƒ¨ç½²å˜å¾—æä¸ºå¿«æ·ï¼Œå¹¶ä¸”èŠ‚çœå†…å­˜å’Œç£ç›˜ç©ºé—´ã€‚</li>
  <li>æ—¥å¿—è®°å½• - Dockerå°†ä¼šæ”¶é›†å’Œè®°å½•æ¯ä¸ªè¿›ç¨‹å®¹å™¨çš„æ ‡å‡†æµï¼ˆstdout/stderr/stdinï¼‰ï¼Œç”¨äºå®æ—¶æ£€ç´¢æˆ–æ‰¹é‡æ£€ç´¢ï¼Œä¸æ¶ˆè€—æœ¬åœ°IOã€‚</li>
  <li>å˜æ›´ç®¡ç† - å®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„å˜æ›´å¯ä»¥æäº¤åˆ°æ–°çš„é•œåƒä¸­ï¼Œå¹¶ä¸”å¯é‡å¤ä½¿ç”¨ä»¥åˆ›å»ºæ›´å¤šçš„å®¹å™¨ã€‚æ— éœ€ä½¿ç”¨æ¨¡æ¿æˆ–æ‰‹åŠ¨é…ç½®ã€‚</li>
  <li>äº¤äº’å¼shell - Dockerå¯ä»¥åˆ†é…ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯å¹¶å…³è”åˆ°ä»»ä½•å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼Œä¾‹å¦‚è¿è¡Œä¸€ä¸ªäº¤ä»˜å¼shellã€‚</li>
</ol>

<h2 id="23-docker-éš”ç¦»">2.3. Docker éš”ç¦»</h2>

<p>Mount namespace : Mount namespaceæ˜¯å¯¹æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€è¿›è¡Œéš”ç¦»
UTS namespace : nodename å’Œ domannameéš”ç¦»ã€‚æ¯ä¸ªå®¹å™¨å¯ä»¥æœ‰è‡ªå·±çš„hostnaneå’Œdomainnameã€‚
IPC namespace: å¤„äºåŒä¸€ä¸ª namespace ä¸‹çš„è¿›ç¨‹æ‰å¯ä»¥è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ã€‚
NET namespace: å®ç°ç½‘ç»œåè®®ä¸Šçš„éš”ç¦»ï¼Œåœ¨è‡ªå·±çš„namespaceä¸­å¯¹ç½‘ç»œçš„è®¾ç½®åªèƒ½åœ¨æœ¬namespaceä¸­ç”Ÿæ•ˆ
PID namespace: è¿›ç¨‹éš”ç¦»ã€‚
USER namespace: ç›¸å½“äºç”¨æˆ·ç³»ç»Ÿéš”ç¦»ï¼Œ User namespaceä¸­ä½¿ç”¨äº†mapè½¬æ¢ï¼Œç”±äºcontainerå¹¶ä¸æ˜¯çœŸæ­£çš„è™šæ‹Ÿè¯ï¼Œæ‰€ä»¥åœ¨Cuest-OSä¸­åˆ›å»ºçš„rootç”¨æˆ·ä¼šè¢«æ˜ å°„åˆ°Host-OSä¸­çš„æ™®é€šç”¨æˆ·åœ¨ã€‚</p>

<h2 id="24-å·¥ä½œæµç¨‹">2.4. å·¥ä½œæµç¨‹</h2>

<ol>
  <li>æ„å»ºé•œåƒï¼Œé€šè¿‡Dockerfile buildæ„å»º</li>
  <li>ç»™é•œåƒæ–‡ä»¶æ ‡è¯†tag(ç‰ˆæœ¬)</li>
  <li>ä¸Šä¼ åˆ°é•œåƒå‡ºåº“</li>
  <li>é•œåƒä¸‹è½½</li>
  <li>å®‰è£…é•œåƒ-å®¹å™¨è¿è¡Œå®ä¾‹</li>
  <li>å®¹å™¨è¿è¡Œã€åœæ­¢ã€åˆ é™¤</li>
  <li>å®¹å™¨ä¿®æ”¹äº†æ·»åŠ æ–°åŠŸèƒ½ï¼Œå¯commitåˆå¹¶æ–°çš„é•œåƒåˆ°é•œåƒå‡ºåº“</li>
</ol>

<h1 id="3-dockeråŸºæœ¬æ“ä½œ">3. DockeråŸºæœ¬æ“ä½œ</h1>

<h2 id="31-windowså®‰è£…è€ç‰ˆæœ¬æ–°ç‰ˆæœ¬windowsä¸ä¸»æŒ">3.1. windowså®‰è£…ï¼ˆè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬windowsä¸ä¸»æŒï¼‰</h2>

<h3 id="å…ˆæ‰‹åŠ¨å®‰è£…virtualbox">å…ˆæ‰‹åŠ¨å®‰è£…VirtualBox</h3>

<h3 id="vt-x-is-not-availableverr_vmx_no_vmx">VT-x is not available(VERR_VMX_NO_VMX)</h3>

<p>Win10 æ›´æ–°ä¹‹åVirtualBoxå®‰è£…ubuntuå¯åŠ¨æŠ¥ VT-x is not available(VERR_VMX_NO_VMX).</p>

<p>ä¸‹è½½åœ°å€
http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</p>

<p>å®‰è£…è¿‡ç¨‹å¦‚æœå·²ç»å®‰è£…äº†gitï¼Œé‚£ä¹ˆä¸éœ€è¦å‹¾é€‰git, å¦‚æœå·²ç»è‡ªå·±æ‰‹åŠ¨å®‰è£…äº†Oracle VMï¼Œä¹Ÿä¸è¦é€‰æ‹©Oracle VM VirtualBoxã€‚</p>

<p><img src="https://liulv.work/images/img/20200922110456.png" alt="20200922110456" /></p>

<p>å®‰è£…å®Œæˆåï¼Œæ¡Œé¢ä¼šç”ŸæˆOracle VM VirtualBoxã€Kitematic (Alpha)ã€Docker Quickstart Terminalä¸‰ä¸ªå›¾æ ‡</p>

<p><img src="https://liulv.work/images/img/20200922102429.png" alt="20200922102429" /></p>

<p>å¦‚æœgitæ²¡å®‰è£…åœ¨C:\Program Files\Gitç›®å½•ï¼Œé‚£ä¹ˆå³é”®Docker Quickstart Terminalå±æ€§ä¿®æ”¹é…ç½®ï¼Œå¦‚<code class="language-plaintext highlighter-rouge">D:\gongji\Git\bin\bash.exe --login -i "C:\Program Files\Docker Toolbox\start.sh"</code></p>

<p>å¦‚ç›´æ¥å¯åŠ¨Docker Quickstart Terminal å¦‚æœç¯èŠ‚åˆå§‹åŒ–å‡ºé—®é¢˜ï¼Œé‚£ä¹ˆåˆ é™¤~/.dockeræ–‡ä»¶é‡å¯</p>

<p>å¯èƒ½è¿˜ä¼šéœ€è¦ä¸‹è½½boot2docker</p>

<p><img src="https://liulv.work/images/img/20200922102530.png" alt="20200922102530" /></p>

<p>ä¸è¦è‡ªåŠ¨ä¸‹è½½<a href="https://github.com/boot2docker/boot2docker/releases">boot2docker</a> ï¼Œç„¶åæ”¾åˆ°<code class="language-plaintext highlighter-rouge">~\.docker\machine\cache\</code>ç›®å½•ä¸‹ï¼Œç„¶åé‡å¯docker</p>

<p>å¯åŠ¨æˆåŠŸç•Œé¢å¦‚ä¸‹ï¼š</p>

<p><img src="https://liulv.work/images/img/20200922110649.png" alt="20200922110649" /></p>

<h2 id="32-linuxå®‰è£…">3.2. linuxå®‰è£…</h2>

<p><a href="https://download.docker.com/linux/static/stable/x86_64/">ä¸‹è½½åœ°å€</a>é€‰æ‹©è‡ªå·±æƒ³è¦çš„ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä¸‹è½½19.03.9</p>

<p>ä¸Šä¼ åˆ°linux æœåŠ¡å™¨ä¸‹ï¼Œç„¶åè§£å‹
tar -zxvf docker-19.03.9.tgz</p>

<p>æ–‡ä»¶æ‹·è´åˆ°/usr/bin
sudo cp docker/* /usr/bin</p>

<p>dockeræ³¨å†Œä¸ºæœåŠ¡
vim /etc/systemd/system/docker.service</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>[<span class="n">Unit</span>]
<span class="n">Description</span>=<span class="n">Docker</span> <span class="n">Application</span> <span class="n">Container</span> <span class="n">Engine</span>
<span class="n">Documentation</span>=<span class="n">https</span>://<span class="n">docs</span>.<span class="n">docker</span>.<span class="n">com</span>
<span class="n">After</span>=<span class="n">network</span>-<span class="n">online</span>.<span class="n">target</span> <span class="n">firewalld</span>.<span class="n">service</span>
<span class="n">Wants</span>=<span class="n">network</span>-<span class="n">online</span>.<span class="n">target</span>
 
[<span class="n">Service</span>]
<span class="n">Type</span>=<span class="n">notify</span>
<span class="c"># the default is not to use systemd for cgroups because the delegate issues still
# exists and systemd currently does not support the cgroup feature set required
# for containers run by docker
</span><span class="n">ExecStart</span>=/<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">dockerd</span>
<span class="n">ExecReload</span>=/<span class="n">bin</span>/<span class="n">kill</span> -<span class="n">s</span> <span class="n">HUP</span> $<span class="n">MAINPID</span>
<span class="c"># Having non-zero Limit*s causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
</span><span class="n">LimitNOFILE</span>=<span class="n">infinity</span>
<span class="n">LimitNPROC</span>=<span class="n">infinity</span>
<span class="n">LimitCORE</span>=<span class="n">infinity</span>
<span class="c"># Uncomment TasksMax if your systemd version supports it.
# Only systemd 226 and above support this version.
#TasksMax=infinity
</span><span class="n">TimeoutStartSec</span>=<span class="m">0</span>
<span class="c"># set delegate yes so that systemd does not reset the cgroups of docker containers
</span><span class="n">Delegate</span>=<span class="n">yes</span>
<span class="c"># kill only the docker process, not all processes in the cgroup
</span><span class="n">KillMode</span>=<span class="n">process</span>
<span class="c"># restart the docker process if it exits prematurely
</span><span class="n">Restart</span>=<span class="n">on</span>-<span class="n">failure</span>
<span class="n">StartLimitBurst</span>=<span class="m">3</span>
<span class="n">StartLimitInterval</span>=<span class="m">60</span><span class="n">s</span>
 
[<span class="n">Install</span>]
<span class="n">WantedBy</span>=<span class="n">multi</span>-<span class="n">user</span>.<span class="n">target</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®¾ç½®æ‰§è¡Œæƒé™</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">chmod</span><span class="w"> </span><span class="o">+</span><span class="nx">x</span><span class="w"> </span><span class="nx">/etc/systemd/system/docker.service</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>å¯åŠ¨docker</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nf">systemctl</span><span class="w"> </span><span class="nx">daemon-reload</span><span class="w">
</span><span class="nf">systemctl</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">docker</span><span class="w">			</span><span class="c">#å¯åŠ¨Docker</span><span class="w">
</span><span class="nf">systemctl</span><span class="w"> </span><span class="nx">enable</span><span class="w"> </span><span class="nx">docker.service</span><span class="w">			</span><span class="c">#è®¾ç½®å¼€æœºè‡ªå¯</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20200923162719.png" alt="20200923162719" /></p>

<p><img src="https://liulv.work/images/img/20200923162838.png" alt="20200923162838" /></p>

<p>æ£€æŸ¥</p>

<p>systemctl status docker</p>

<p><img src="https://liulv.work/images/img/20200923210013.png" alt="20200923210013" /></p>

<p>docker -v</p>

<p><img src="https://liulv.work/images/img/20200923162900.png" alt="20200923162900" /></p>

<p>éœ€è¦å…³é—­å°†SELINUXï¼Œç¼–è¾‘/etc/selinux/configå°†SELINUX=enforcingæ”¹ä¸ºSELINUX=disableé‡å¯æœ</p>

<h2 id="33-åŸºæœ¬å‘½ä»¤">3.3. åŸºæœ¬å‘½ä»¤</h2>

<p><strong>docker é•œåƒå­˜å‚¨ç›®å½•</strong>
/var/lib/docker/</p>

<p><strong>windowæŸ¥çœ‹è™šæ‹Ÿå®¿ä¸»æœºip</strong>
docker-machine ls</p>

<p>defaultè™šæ‹Ÿæœºçš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç 
ç”¨æˆ·åï¼šdocker 
å¯†ç ï¼š tcuser</p>

<p><strong>è¿è¡Œäº¤äº’å¼çš„å®¹å™¨</strong>
æˆ‘ä»¬é€šè¿‡ docker çš„ä¸¤ä¸ªå‚æ•° -i -tï¼Œè®© docker è¿è¡Œçš„å®¹å™¨å®ç°â€å¯¹è¯â€çš„èƒ½åŠ›ï¼š</p>

<p>docker run -i -t ubuntu:15.10 /bin/bash</p>

<p><strong>æŸ¥çœ‹æ—¥å¿—</strong></p>

<p>docker logs <dockerName>
æ ‡å‡†æ—¥å¿—
docker logs -f <dockerName></dockerName></dockerName></p>

<p>docker logs -f -tail=200 <dockerName></dockerName></p>

<p><strong>åœæ­¢å®¹å™¨</strong></p>

<p>docker stop <dockerName></dockerName></p>

<p><strong>æŸ¥çœ‹å…¨éƒ¨å®¹å™¨</strong>
è¿è¡Œä¸­
docker ps
å…¨éƒ¨
docker ps -a</p>

<p><strong>å¯åŠ¨ä¸€ä¸ªå·²ç»åœæ­¢çš„å®¹å™¨</strong></p>

<p>docker start b750bbbcfd88ï¼ˆnameï¼‰</p>

<p><strong>è¿›å…¥å®¹å™¨</strong>
docker exec -it powerjob-server /bin/bash</p>

<p><strong>æ˜¾ç¤ºå®¹å™¨åˆ†å±‚</strong>
inspectå‘½ä»¤å¯ä»¥åˆ†å±‚çº§æ˜¾ç¤ºä¸€ä¸ªé•œåƒæˆ–å®¹å™¨çš„ä¿¡æ¯
docker inspect</p>

<p><strong>æŸ¥è¯¢å®¹å™¨å†…IPåœ°å€</strong></p>

<p>docker inspect -f â€˜â€™ powerjob-server</p>

<p><strong>åœæ­¢å®¹å™¨</strong>
docker stop powerjob-server</p>

<p><strong>åˆ é™¤å®¹å™¨</strong>
docker container rm powerjob-server</p>

<p><strong>åˆ é™¤é•œåƒ</strong>
docker rmi -f tjqq/powerjob-server:$version</p>

<p><strong>ä¿å­˜å·²å®‰è£…çš„é•œåƒ</strong>
docker save -o powerjob-server.tar tjqq/powerjob-server</p>

<p>ä¸‹è½½åˆ°å½“å‰ç›®å½•ï¼Œç„¶åæ‹·è´åˆ°éœ€è¦çš„æœºå™¨ä¸‹</p>

<p><strong>åŠ è½½æ‹·è´ä¸Šä¼ çš„é•œåƒ</strong>
docker load -i powerjob-server.tar</p>

<h2 id="34-dockerå®‰è£…nginx">3.4. Dockerå®‰è£…Nginx</h2>

<ol>
  <li>æŸ¥çœ‹Nginxç‰ˆæœ¬</li>
</ol>

<p>è®¿é—® Nginx é•œåƒåº“åœ°å€ï¼š https://hub.docker.com/_/nginx?tab=tagsã€‚</p>

<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æ¥æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬ï¼š</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker search nginx
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>pullæœ€æ–°ç‰ˆæœ¬é•œåƒåˆ°æœ¬åœ°</li>
</ol>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">pull</span><span class="w"> </span><span class="nx">nginx:latest</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>æŸ¥çœ‹å½“å‰é•œåƒ
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">images</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>è¿è¡Œé•œåƒ
    <div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">--name</span><span class="w"> </span><span class="nx">nginx-test</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">10080:80</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">nginx</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<p>å‚æ•°è¯´æ˜ï¼š</p>

<p>â€“name nginx-testï¼šå®¹å™¨åç§°ã€‚
-p 10080:80ï¼š ç«¯å£è¿›è¡Œæ˜ å°„ï¼Œå°†æœ¬åœ° 10080 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨çš„ 80 ç«¯å£ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª-p 7701:7701 -p 10086:10086
-d è®¾ç½®å®¹å™¨åœ¨åå°ä¸€ç›´è¿è¡Œ
â€“restart=always ï¼šæŒ‡å®šè¯¥å®¹å™¨éšç€dockerå¯åŠ¨è€Œè‡ªåŠ¨å¯åŠ¨åº”ç”¨
 -e TZ=â€Asia/Shanghaiâ€ ï¼šæ—¶åŒºï¼Œé»˜è®¤æ—¶åŒºä¸ºä¸­å›½æ ‡å‡†æ—¶åŒºï¼ˆAsia/Shanghaiï¼‰ï¼Œå›½å¤–ç”¨æˆ·è¯·ä¿®æ”¹ä¸ºæ­£ç¡®çš„æ—¶åŒº
 -v ~/docker/powerjob-server:/root/powerjob-server -v ~/.m2:/root/.m2 ï¼šæ˜ å°„æ•°æ®å·
 nginxï¼šæŒ‡å®šä½¿ç”¨çš„dockeré•œåƒï¼Œè¿è¡Œçš„é•œåƒ</p>

<ol>
  <li>æŸ¥çœ‹è¿è¡Œå®¹å™¨
docker ps</li>
</ol>

<p>å¯æŸ¥çœ‹å…¨éƒ¨çŠ¶æ€çš„å®¹å™¨
docker ps -all</p>

<ol>
  <li>webåœ°å€è®¿é—®å¯åŠ¨çš„åº”ç”¨åœ°å€
192.168.99.100:10080</li>
</ol>

<p>å…¶ä¸­çš„192.168.99.100ä¸ºdefaulté…ç½®çš„ipåœ°å€</p>

<h2 id="35-æ„å»ºpowerjobé•œåƒlinuxè™šæ‹Ÿæœº">3.5. æ„å»ºpowerjobé•œåƒï¼ˆlinuxè™šæ‹Ÿæœºï¼‰</h2>

<ol>
  <li>
    <p>åˆ›å»ºè™šæ‹Ÿæœºlinux</p>
  </li>
  <li>
    <p>é€šè¿‡<a href="#3dot2-linuxå®‰è£…">ä¸Šé¢ç« èŠ‚</a>å®‰è£…docker</p>
  </li>
  <li>
    <p>å…ˆpullåŸºç¡€é•œåƒ
docker pull adoptopenjdk:8-jdk-hotspot</p>
  </li>
  <li>
    <p>åˆ›å»ºæ„å»ºé•œåƒç›®å½•
mkdir -p /powerjob-soucre/powerjob-server
mkdir -p /powerjob-soucre/powerjob-worker-agent</p>
  </li>
  <li>
    <p>mavenæ‰“å…¨é‡åŒ…å¹¶å»æ‰ç‰ˆæœ¬åç¼€ååæ‹·è´åˆ°æœ¬åœ°å·¥ç¨‹çš„/powerjob-soucre/powerjob-serverå’Œ/powerjob-soucre/powerjob-worker-agert</p>
  </li>
  <li>å°†ç¨‹åºå·¥ç¨‹å¯¹åº”çš„powerjob-serverä¸‹çš„dockeræ•´ä¸ªç›®å½•ä¸Šä¼ åˆ°/powerjob-soucre/powerjob-serverç›®å½•</li>
  <li>
    <p>å°†ç¨‹åºå·¥ç¨‹å¯¹åº”çš„powerjob-worker-agertä¸‹çš„dockeræ•´ä¸ªç›®å½•ä¸Šä¼ åˆ°/powerjob-soucre/powerjob-worker-agertç›®å½•</p>
  </li>
  <li>
    <p>å°†å·¥ç¨‹ä¸‹çš„otheræ•´ä¸ªç›®å½•ä¸Šä¼ åˆ°/powerjob-soucreç›®å½•ä¸‹å¹¶shä¿®æ”¹æ‰§è¡Œæƒé™
chmod 755 /data/docker/powerjob/others/script/*.sh</p>
  </li>
  <li>æ‰§è¡Œå‘½ä»¤/powerjob-soucre/others/script/build_docker.sh
æˆ–/data/docker/powerjob/others/script/build_docker.sh</li>
</ol>

<p>a. è¾“å…¥é•œåƒç‰ˆæœ¬å·å¦‚1.0.2
b. æ˜¯å¦é‡æ–°æ„å»ºé•œåƒï¼ˆy/nï¼‰ y
c. æ˜¯å¦å¯åŠ¨ server &amp; agentï¼ˆy/nï¼‰n  â€”å¦‚æœæ­¤è™šæ‹Ÿæœºå½“å¼€å‘æµ‹è¯•ç”¨ï¼Œåˆ™å¯åŠ¨yï¼Œå¦‚æœåªæ˜¯æ‰“åŒ…çš„è¯å°±æ²¡å¿…è¦äº†</p>

<ol>
  <li>
    <p>æŸ¥çœ‹é•œåƒ
docker images</p>
  </li>
  <li>
    <p>ä¿å­˜é•œåƒ
mkdir /data/docker/images
cd /data/docker/images
docker save -o powerjob-server.tar tjqq/powerjob-server
docker save -o powerjob-agent.tar tjqq/powerjob-agent</p>
  </li>
</ol>

<p>docker save -o adoptopenjdk_8-jdk-hotspot.tar adoptopenjdk:8-jdk-hotspot</p>

<ol>
  <li>
    <p>å°†/data/docker-imagesç›®å½•ä¸‹powerjob-server.tarã€powerjob-agent.taræ‹·è´åˆ°éœ€è¦æ‰§è¡Œçš„æœåŠ¡å™¨ä¸‹</p>
  </li>
  <li>
    <p>åœ¨æœåŠ¡å™¨ä¸‹åŠ è½½é•œåƒ
cd /data/docker/images
docker load -i powerjob-server.tar
docker load -i powerjob-agent.tar</p>
  </li>
</ol>

<p>docker load -i adoptopenjdk_8-jdk-hotspot.tar</p>

<ol>
  <li>æ‰§è¡Œé•œåƒ</li>
</ol>

<p>æ‰§è¡Œpowerjob-server</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="se">\</span>
         <span class="nt">--name</span> powerjob-server <span class="se">\</span>
         <span class="nt">-p</span> 7701:7701 <span class="nt">-p</span> 27001:27001 <span class="nt">-p</span> 27002:27002 <span class="nt">-p</span> 10086:10086 <span class="nt">-p</span> 5001:5005 <span class="nt">-p</span> 10001:10000 <span class="se">\</span>
         <span class="nt">-e</span> <span class="nv">JVMOPTIONS</span><span class="o">=</span><span class="s2">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=10000 -Dcom.sun.management.jmxremote.rmi.port=10000 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"</span> <span class="se">\</span>
         <span class="nt">-e</span> <span class="nv">PARAMS</span><span class="o">=</span><span class="s2">"--spring.profiles.active=local"</span> <span class="se">\</span>
         <span class="nt">-e</span> <span class="nv">TZ</span><span class="o">=</span><span class="s2">"Asia/Shanghai"</span> <span class="se">\</span>
		 <span class="nt">-v</span> ~/docker/powerjob-server:/root/powerjob-server <span class="nt">-v</span> ~/.m2:/root/.m2 <span class="se">\</span>
         tjqq/powerjob-server:1.0.2
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ³¨æ„ï¼šå¦‚æœæ˜¯serverå¯åŠ¨çš„ä¸ºæˆ‘çš„æœ¬åœ°æ¨¡å¼localæœ¬åœ°åº“ï¼ŒæœåŠ¡å™¨æƒ…å†µéœ€è¦ä¿®æ”¹ä¸ºdaily</p>

<p>æ‰§è¡Œpowerjob-agent, æ‰§è¡ŒåŒä¸€å°æœåŠ¡å™¨ä¸‹çš„éœ€è¦æ ¹æ®serverçš„å®¹å™¨åœ°å€ä¿®æ”¹172.17.0.2ï¼Œå¦‚æœæ˜¯è·¨èŠ‚ç‚¹æ‰§è¡Œ-s åå¡«å†™serverå®¹å™¨æ‰€åœ¨æœåŠ¡å™¨ipåœ°å€
æŸ¥çœ‹å®¹å™¨ipåœ°å€å‘½ä»¤</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">inspect</span><span class="w"> </span><span class="nt">-f</span><span class="w"> </span><span class="s1">''</span><span class="w"> </span><span class="nx">powerjob-server</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>æ³¨æ„ï¼šæ‰§è¡Œagentå‘½ä»¤å¿…é¡»ç­‰å¾…serverå¯åŠ¨æˆåŠŸåï¼Œå¯è®¿é—®server ip:7701 æˆ– http://serverIp:7701/swagger-ui.htmlæ£€æŸ¥serveræ˜¯å¦å¯åŠ¨æˆåŠŸ</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">--name</span><span class="w"> </span><span class="nf">powerjob-agent</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">-p</span><span class="w"> </span><span class="mi">7001</span><span class="p">:</span><span class="mi">7001</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="mi">5002</span><span class="p">:</span><span class="mi">5005</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="mi">10002</span><span class="p">:</span><span class="mi">10000</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-e</span><span class="w"> </span><span class="nx">JVMOPTIONS</span><span class="o">=</span><span class="s2">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=10000 -Dcom.sun.management.jmxremote.rmi.port=10000 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-e</span><span class="w"> </span><span class="nx">PARAMS</span><span class="o">=</span><span class="s2">"-s 172.17.0.2:7720 -a agent002 -p 7001 -c ENABLE "</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-v</span><span class="w"> </span><span class="nx">/root/docker/powerjob-agent:/root</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">-v</span><span class="w"> </span><span class="nf">/data/datax:/data/datax</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nf">tjqq/powerjob-agent:1.0.2</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>å¦‚åŒä¸€ä¸ªæœåŠ¡å™¨éœ€è¦å¯åŠ¨å¤šä¸ªagent å¯è°ƒæ•´å…¶ä¸­ç«¯å£å·7001ï¼Œå¦‚æœå…¨éƒ¨è°ƒæ•´ä¸º7001ï¼Œå¹¶ä¿®æ”¹åç§°ä¸ºpowerjob-agent2</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nf">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">--name</span><span class="w"> </span><span class="nf">powerjob-agent2</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">-p</span><span class="w"> </span><span class="mi">7002</span><span class="p">:</span><span class="mi">7002</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="mi">5003</span><span class="p">:</span><span class="mi">5005</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="mi">10003</span><span class="p">:</span><span class="mi">10000</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-e</span><span class="w"> </span><span class="nx">JVMOPTIONS</span><span class="o">=</span><span class="s2">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=10000 -Dcom.sun.management.jmxremote.rmi.port=10000 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false"</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-e</span><span class="w"> </span><span class="nx">PARAMS</span><span class="o">=</span><span class="s2">"-s 172.17.0.2:7720 -a agent002 -p 7002 -c ENABLE "</span><span class="w"> </span><span class="nf">\</span><span class="w">
         </span><span class="nt">-v</span><span class="w"> </span><span class="nx">/root/docker/powerjob-agent:/root</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nt">-v</span><span class="w"> </span><span class="nf">/data/datax:/data/datax</span><span class="w"> </span><span class="nx">\</span><span class="w">
         </span><span class="nf">tjqq/powerjob-agent:1.0.2</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><strong>ç‰¹åˆ«æ³¨æ„ï¼š</strong>dataxé…ç½®ä¸ºæˆ‘çš„æœ¬åœ°æµ‹è¯•ï¼ŒæœåŠ¡å™¨éœ€è¦å»æ‰-d LOCALå‚æ•°</p>

:ET