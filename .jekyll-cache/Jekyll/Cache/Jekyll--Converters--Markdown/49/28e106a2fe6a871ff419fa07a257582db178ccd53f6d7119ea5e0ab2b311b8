I"7¡<h1 id="1-å‰å°mavenä¾èµ–">1. å‰å°Mavenä¾èµ–</h1>

<p>å¼€å‘Akkaé›†ç¾¤å¯ä½¿ç”¨Mavenæ·»åŠ æœ€ä½ä¾èµ–é…ç½®å¦‚ä¸‹</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;akka.version&gt;</span>2.6.8<span class="nt">&lt;/akka.version&gt;</span>
        <span class="nt">&lt;scala.binary.version&gt;</span>2.13<span class="nt">&lt;/scala.binary.version&gt;</span>
        <span class="nt">&lt;lombok.version&gt;</span>1.18.12<span class="nt">&lt;/lombok.version&gt;</span>
        <span class="nt">&lt;logback.version&gt;</span>1.2.3<span class="nt">&lt;/logback.version&gt;</span>
        <span class="nt">&lt;junit.version&gt;</span>4.12<span class="nt">&lt;/junit.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>

<span class="nt">&lt;dependencies&gt;</span>
  <span class="c">&lt;!-- lombok --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${lombok.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- logback --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${logback.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- akka actor typed --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>akka-actor-typed_2.13<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${akka.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- akka actor test --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>akka-actor-testkit-typed_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${akka.version}<span class="nt">&lt;/version&gt;</span>
      <span class="c">&lt;!--&lt;scope&gt;test&lt;/scope&gt;--&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- akka remote --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>akka-remote_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${akka.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- akka cluster --&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>akka-cluster-typed_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${akka.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
  <span class="c">&lt;!-- akka serialization jackson--&gt;</span>
  <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.typesafe.akka<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>akka-serialization-jackson_${scala.binary.version}<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>${akka.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;/dependency&gt;</span>
<span class="err">&lt;</span>/&gt;
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="å¸¸ç”¨é…ç½®configæ–¹å¼">å¸¸ç”¨é…ç½®configæ–¹å¼</h1>

<p>é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºActorSystemæ—¶å¦‚ä¸æŒ‡å®šå…·ä½“çš„configï¼Œé‚£ä¹ˆä¼šé»˜è®¤è¯»å–application.confé…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯é€šå¸¸å»ºè®®éƒ½è‡ªå·±å›ºå®šé…ç½®çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ç¨‹åºåŠ¨æ€æŒ‡å®šä¸€äº›å®šåˆ¶éœ€è¦çš„é…ç½®ã€‚</p>

<p>å¸¸ç”¨æ–¹å¼ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="n">ä»å†™è¦†ç›–å®šåˆ¶é…ç½®</span><span class="err">ï¼Œ</span><span class="n">æ¯”å¦‚ç«¯å£å’Œè§’è‰²</span>
<span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">overrides</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">overrides</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"akka.remote.artery.canonical.port"</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
<span class="n">overrides</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"akka.cluster.roles"</span><span class="o">,</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">role</span><span class="o">));</span>

<span class="n">ç„¶åæ·»åŠ stats</span><span class="o">.</span><span class="na">confé…ç½®</span><span class="err">ï¼Œ</span><span class="n">æ–‡ä»¶åå¯ç›´æ¥æ ¹æ®é¡¹ç›®è°ƒæ•´</span>
 <span class="nc">Config</span> <span class="n">config</span> <span class="o">=</span> <span class="nc">ConfigFactory</span><span class="o">.</span><span class="na">parseMap</span><span class="o">(</span><span class="n">overrides</span><span class="o">)</span>
<span class="o">.</span><span class="na">withFallback</span><span class="o">(</span><span class="nc">ConfigFactory</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"stats"</span><span class="o">));</span>

<span class="c1">//æŒ‡å®šconfigåˆ›å»ºActorSystem</span>
 <span class="nc">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">RootBehavior</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span> <span class="s">"ClusterSystem"</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span>

<span class="c1">//RootBehaviorä¸­åˆ›å»ºé›†ç¾¤</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RootBehavior</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">Behavior</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Behaviors</span><span class="o">.</span><span class="na">setup</span><span class="o">(</span><span class="n">context</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="c1">//åˆ›å»ºé›†ç¾¤</span>
            <span class="nc">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSystem</span><span class="o">());</span>
            <span class="o">...</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="2-hello-akkaclusterç¤ºä¾‹">2. Hello AkkaClusterç¤ºä¾‹</h1>

<h2 id="21-æœ€å°é›†ç¾¤é…ç½®å¦‚ä¸‹">2.1. æœ€å°é›†ç¾¤é…ç½®å¦‚ä¸‹</h2>

<p>æœ€å°çš„Akkaé›†ç¾¤ç¤ºä¾‹ï¼Œé…ç½®å¦‚ä¸‹</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">akka</span> { 
  <span class="n">actor</span>.<span class="n">provider</span> = <span class="n">cluster</span> 
  <span class="n">remote</span>.<span class="n">artery</span> { 
    <span class="n">canonical</span> { 
      <span class="n">hostname</span> = <span class="s2">"127.0.0.1"</span> 
      <span class="n">port</span> = <span class="m">2551</span> 
    } 
  } 
} 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å¯ç›´æ¥è§£æç”ŸæˆAkka Configï¼Œä¹Ÿå¯é…ç½®åˆ°application.confï¼Œé»˜è®¤åˆ›å»ºActorSystemå¦‚æœæœªæŒ‡å®šConfigä¼šåŠ è½½application.confé…ç½®ã€‚ä¹Ÿå¯é…ç½®å…¶ä»–confæ–‡ä»¶é…ç½®ï¼Œé€šè¿‡ConfigFactory.loadåŠ è½½é…ç½®æ–‡ä»¶åˆ›å»ºConfigã€‚</p>

<p>ç¤ºä¾‹ä¸­ä½¿ç”¨ç›´æ¥Stringæ–¹æ³•åˆ›å»ºConfigé…ç½®å¹¶è¦†ç›–<code class="language-plaintext highlighter-rouge">akka.remote.classic.netty.tcp.port</code>å’Œ<code class="language-plaintext highlighter-rouge">akka.remote.artery.canonical.port</code>é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre> <span class="kd">private</span> <span class="nc">Config</span> <span class="n">clusterConfig</span> <span class="o">=</span>
            <span class="nc">ConfigFactory</span><span class="o">.</span><span class="na">parseString</span><span class="o">(</span>
                    <span class="s">"akka { \n"</span>
                            <span class="o">+</span> <span class="s">"  actor.provider = cluster \n"</span>
                            <span class="o">+</span> <span class="s">"  remote.artery { \n"</span>
                            <span class="o">+</span> <span class="s">"    canonical { \n"</span>
                            <span class="o">+</span> <span class="s">"      hostname = \"127.0.0.1\" \n"</span>
                            <span class="o">+</span> <span class="s">"      port = 2551 \n"</span>
                            <span class="o">+</span> <span class="s">"    } \n"</span>
                            <span class="o">+</span> <span class="s">"  } \n"</span>
                            <span class="o">+</span> <span class="s">"}  \n"</span><span class="o">);</span>
    <span class="kd">private</span> <span class="nc">Config</span> <span class="n">noPort</span> <span class="o">=</span>
            <span class="nc">ConfigFactory</span><span class="o">.</span><span class="na">parseString</span><span class="o">(</span>
                    <span class="s">"      akka.remote.classic.netty.tcp.port = 0 \n"</span>
                            <span class="o">+</span> <span class="s">"      akka.remote.artery.canonical.port = 0 \n"</span>
                            <span class="o">+</span> <span class="s">"      akka.cluster.jmx.multi-mbeans-in-same-jvm = on \n"</span>
                            <span class="o">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p><strong>æ³¨æ„</strong></p>
  <blockquote>
    <p>ä¸ºäº†æµ‹è¯•éœ€è¦ï¼Œæˆ‘ä»¬è®¾ç½®æ”¯æŒåŒä¸€ä¸ªJVMè¿›ç¨‹å…è®¸å¯åŠ¨å¤šä¸ªé›†ç¾¤ï¼Œéœ€è¦é…ç½®<code class="language-plaintext highlighter-rouge">akka.cluster.jmx.multi-mbeans-in-same-jvm = on</code></p>
  </blockquote>
</blockquote>

<h2 id="22-æ ¹æ®é…ç½®åˆ›å»ºactorsystem">2.2. æ ¹æ®é…ç½®åˆ›å»ºActorSystem</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nc">ActorSystem</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">system</span> <span class="o">=</span>
                <span class="nc">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Behaviors</span><span class="o">.</span><span class="na">empty</span><span class="o">(),</span> <span class="s">"ClusterSystem"</span><span class="o">,</span> <span class="n">noPort</span><span class="o">.</span><span class="na">withFallback</span><span class="o">(</span><span class="n">clusterConfig</span><span class="o">));</span>

<span class="nc">ActorSystem</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">system2</span> <span class="o">=</span>
        <span class="nc">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Behaviors</span><span class="o">.</span><span class="na">empty</span><span class="o">(),</span> <span class="s">"ClusterSystem2"</span><span class="o">,</span> <span class="n">noPort</span><span class="o">.</span><span class="na">withFallback</span><span class="o">(</span><span class="n">clusterConfig</span><span class="o">));</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="23-åˆ›å»ºåŠ å…¥ç¦»å¼€é›†ç¾¤">2.3. åˆ›å»ºã€åŠ å…¥ã€ç¦»å¼€é›†ç¾¤</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre> <span class="k">try</span> <span class="o">{</span>
    <span class="c1">// #cluster-create</span>
    <span class="nc">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>
    <span class="nc">Cluster</span> <span class="n">cluster2</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">system2</span><span class="o">);</span>

    <span class="c1">// #cluster-join</span>
    <span class="n">cluster</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Join</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cluster</span><span class="o">.</span><span class="na">selfMember</span><span class="o">().</span><span class="na">address</span><span class="o">()));</span>
    <span class="n">cluster2</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Join</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cluster2</span><span class="o">.</span><span class="na">selfMember</span><span class="o">().</span><span class="na">address</span><span class="o">()));</span>

    <span class="c1">// TODO wait for/verify cluster to form</span>

    <span class="c1">// #cluster-leave</span>
    <span class="n">cluster</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Leave</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cluster</span><span class="o">.</span><span class="na">selfMember</span><span class="o">().</span><span class="na">address</span><span class="o">()));</span>
    <span class="n">cluster2</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Leave</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">cluster2</span><span class="o">.</span><span class="na">selfMember</span><span class="o">().</span><span class="na">address</span><span class="o">()));</span>

    <span class="c1">// TODO wait for/verify node 2 leaving</span>

<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="c1">// #actorSystem-terminateç»ˆæ­¢</span>
    <span class="n">system</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
    <span class="n">system2</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="24-æµ‹è¯•é›†ç¾¤åˆ›å»ºåŠ å…¥ç¦»å¼€">2.4. æµ‹è¯•é›†ç¾¤åˆ›å»ºã€åŠ å…¥ã€ç¦»å¼€</h2>

<p>ç›´æ¥@testæµ‹è¯•ï¼Œæµ‹è¯•è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>

<pre><code class="language-log">SLF4J: A number (1) of logging calls during the initialization phase have been intercepted and are
SLF4J: now being replayed. These are subject to the filtering rules of the underlying logging system.
SLF4J: See also http://www.slf4j.org/codes.html#replay
[2020-09-15 16:51:27,369] [INFO] [akka.event.slf4j.Slf4jLogger] [ClusterSystem-akka.actor.default-dispatcher-3] [] - Slf4jLogger started
[2020-09-15 16:51:28,049] [INFO] [akka.remote.artery.tcp.ArteryTcpTransport] [ClusterSystem-akka.actor.default-dispatcher-3] [ArteryTcpTransport(akka://ClusterSystem)] - Remoting started with transport [Artery tcp]; listening on address [akka://ClusterSystem@127.0.0.1:64600] with UID [4688141471941267513]
[2020-09-15 16:51:28,089] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Starting up, Akka version [2.6.8] ...
[2020-09-15 16:51:28,288] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Registered cluster JMX MBean [akka:type=Cluster,port=64600]
[2020-09-15 16:51:28,288] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Started up successfully
[2020-09-15 16:51:28,326] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - No downing-provider-class configured, manual cluster downing required, see https://doc.akka.io/docs/akka/current/typed/cluster.html#downing
[2020-09-15 16:51:28,327] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - No seed-nodes configured, manual cluster join required, see https://doc.akka.io/docs/akka/current/typed/cluster.html#joining
[2020-09-15 16:51:29,704] [INFO] [akka.event.slf4j.Slf4jLogger] [ClusterSystem2-akka.actor.default-dispatcher-3] [] - Slf4jLogger started
[2020-09-15 16:51:29,745] [INFO] [akka.remote.artery.tcp.ArteryTcpTransport] [ClusterSystem2-akka.actor.default-dispatcher-3] [ArteryTcpTransport(akka://ClusterSystem2)] - Remoting started with transport [Artery tcp]; listening on address [akka://ClusterSystem2@127.0.0.1:64609] with UID [420093861921554813]
[2020-09-15 16:51:29,747] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Starting up, Akka version [2.6.8] ...
[2020-09-15 16:51:29,758] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Registered cluster JMX MBean [akka:type=Cluster,port=64609]
[2020-09-15 16:51:29,758] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Started up successfully
[2020-09-15 16:51:29,767] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - No downing-provider-class configured, manual cluster downing required, see https://doc.akka.io/docs/akka/current/typed/cluster.html#downing
[2020-09-15 16:51:29,768] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - No seed-nodes configured, manual cluster join required, see https://doc.akka.io/docs/akka/current/typed/cluster.html#joining

[2020-09-15 16:51:29,892] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Node [akka://ClusterSystem@127.0.0.1:64600] is JOINING itself (with roles [dc-default]) and forming new cluster
[2020-09-15 16:51:29,892] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Node [akka://ClusterSystem2@127.0.0.1:64609] is JOINING itself (with roles [dc-default]) and forming new cluster
[2020-09-15 16:51:29,898] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - is the new leader among reachable nodes (more leaders may exist)
[2020-09-15 16:51:29,898] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - is the new leader among reachable nodes (more leaders may exist)
[2020-09-15 16:51:29,917] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Leader is moving node [akka://ClusterSystem@127.0.0.1:64600] to [Up]
[2020-09-15 16:51:29,917] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Leader is moving node [akka://ClusterSystem2@127.0.0.1:64609] to [Up]
[2020-09-15 16:51:29,931] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-3] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Marked address [akka://ClusterSystem@127.0.0.1:64600] as [Leaving]
[2020-09-15 16:51:29,933] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-15] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Marked address [akka://ClusterSystem2@127.0.0.1:64609] as [Leaving]
[2020-09-15 16:51:30,365] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Leader is moving node [akka://ClusterSystem@127.0.0.1:64600] to [Exiting]
[2020-09-15 16:51:30,369] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Exiting completed
[2020-09-15 16:51:30,371] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Shutting down...
[2020-09-15 16:51:30,373] [INFO] [akka.cluster.Cluster] [ClusterSystem-akka.actor.default-dispatcher-6] [Cluster(akka://ClusterSystem)] - Cluster Node [akka://ClusterSystem@127.0.0.1:64600] - Successfully shut down
[2020-09-15 16:51:30,391] [INFO] [akka.remote.RemoteActorRefProvider$RemotingTerminator] [ClusterSystem-akka.actor.default-dispatcher-3] [akka://ClusterSystem@127.0.0.1:64600/system/remoting-terminator] - Shutting down remote daemon.
[2020-09-15 16:51:30,394] [INFO] [akka.remote.RemoteActorRefProvider$RemotingTerminator] [ClusterSystem-akka.actor.default-dispatcher-3] [akka://ClusterSystem@127.0.0.1:64600/system/remoting-terminator] - Remote daemon shut down; proceeding with flushing remote transports.
[2020-09-15 16:51:30,419] [INFO] [akka.remote.RemoteActorRefProvider$RemotingTerminator] [ClusterSystem-akka.actor.default-dispatcher-3] [akka://ClusterSystem@127.0.0.1:64600/system/remoting-terminator] - Remoting shut down.
[2020-09-15 16:51:30,778] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Leader is moving node [akka://ClusterSystem2@127.0.0.1:64609] to [Exiting]
[2020-09-15 16:51:30,779] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Exiting completed
[2020-09-15 16:51:30,779] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Shutting down...
[2020-09-15 16:51:30,780] [INFO] [akka.cluster.Cluster] [ClusterSystem2-akka.actor.default-dispatcher-16] [Cluster(akka://ClusterSystem2)] - Cluster Node [akka://ClusterSystem2@127.0.0.1:64609] - Successfully shut down
[2020-09-15 16:51:30,789] [INFO] [akka.remote.RemoteActorRefProvider$RemotingTerminator] [ClusterSystem2-akka.actor.default-dispatcher-15] [akka://ClusterSystem2@127.0.0.1:64609/system/remoting-terminator] - Shutting down remote daemon.
[2020-09-15 16:51:30,789] [INFO] [akka.remote.RemoteActorRefProvider$RemotingTerminator] [ClusterSystem2-akka.actor.default-dispatcher-15] [akka://ClusterSystem2@127.0.0.1:64609/system/remoting-terminator] - Remote daemon shut down; proceeding with flushing remote transports.
[2020-09-15 16:51:30,791] [INFO] [akka.actor.LocalActorRef] [ClusterSystem2-akka.actor.default-dispatcher-16] [akka://ClusterSystem2/system/cluster/core/publisher] - Message [akka.cluster.InternalClusterAction$PublishChanges] from Actor[akka://ClusterSystem2/system/cluster/core/daemon#-964571468] to Actor[akka://ClusterSystem2/system/cluster/core/publisher#-1466189001] was not delivered. [1] dead letters encountered. If this is not an expected behavior then Actor[akka://ClusterSystem2/system/cluster/core/publisher#-1466189001] may have terminated unexpectedly. This logging can be turned off or adjusted with configuration settings 'akka.log-dead-letters' and 'akka.log-dead-letters-during-shutdown'.

Process finished with exit code 0
</code></pre>

<h2 id="25-é›†ç¾¤è®¢é˜…">2.5. é›†ç¾¤è®¢é˜…</h2>

<p>é›†ç¾¤è®¢é˜…ï¼šå¯ç”¨äºåœ¨é›†ç¾¤çŠ¶æ€æ›´æ”¹æ—¶æ¥æ”¶æ¶ˆæ¯,æ­¤ç¤ºä¾‹è®¢é˜…äº†ä¸€ä¸ªActorRef<MemberEvent>è®¢é˜…æœåŠ¡å™¨ï¼Œæ§åˆ¶é›†ç¾¤æˆå‘˜æ·»åŠ å’Œæˆå‘˜ç¦»å¼€æ—¶ï¼Œè®¢é˜…ç”¨æˆ·subscriberå°†æ”¶åˆ°äº‹ä»¶MemberUpï¼ŒMemberLeftï¼ŒMemberExitedå’ŒMemberRemovedç­‰ä¿¡æ¯ã€‚</MemberEvent></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre> <span class="cm">/**
     * é›†ç¾¤è®¢é˜…ï¼šå¯ç”¨äºåœ¨é›†ç¾¤çŠ¶æ€æ›´æ”¹æ—¶æ¥æ”¶æ¶ˆæ¯
     *
     * @throws Exception
     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clusterSubscribe</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">ActorSystem</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">system</span> <span class="o">=</span>
                <span class="nc">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Behaviors</span><span class="o">.</span><span class="na">empty</span><span class="o">(),</span> <span class="s">"ClusterSystem"</span><span class="o">,</span> <span class="n">noPort</span><span class="o">.</span><span class="na">withFallback</span><span class="o">(</span><span class="n">clusterConfig</span><span class="o">));</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>

            <span class="nc">TestProbe</span><span class="o">&lt;</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberEvent</span><span class="o">&gt;</span> <span class="n">testProbe</span> <span class="o">=</span> <span class="nc">TestProbe</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">system</span><span class="o">);</span>
            <span class="nc">ActorRef</span><span class="o">&lt;</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberEvent</span><span class="o">&gt;</span> <span class="n">subscriber</span> <span class="o">=</span> <span class="n">testProbe</span><span class="o">.</span><span class="na">getRef</span><span class="o">();</span>
            <span class="c1">// #cluster-subscribe</span>
            
            <span class="n">cluster</span><span class="o">.</span><span class="na">subscriptions</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Subscribe</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">subscriber</span><span class="o">,</span> <span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberEvent</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
            <span class="c1">// #cluster-subscribe</span>

            <span class="nc">Address</span> <span class="n">anotherMemberAddress</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="na">selfMember</span><span class="o">().</span><span class="na">address</span><span class="o">();</span>
            <span class="c1">// #cluster-leave-example</span>
            <span class="n">cluster</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Join</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">anotherMemberAddress</span><span class="o">));</span>
            <span class="n">cluster</span><span class="o">.</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="nc">Leave</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">anotherMemberAddress</span><span class="o">));</span>
            <span class="c1">// subscriber will receive events MemberLeft, MemberExited and MemberRemoved</span>
            <span class="c1">// #cluster-leave-example</span>
            <span class="n">testProbe</span><span class="o">.</span><span class="na">expectMessageClass</span><span class="o">(</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberUp</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">testProbe</span><span class="o">.</span><span class="na">expectMessageClass</span><span class="o">(</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberLeft</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">testProbe</span><span class="o">.</span><span class="na">expectMessageClass</span><span class="o">(</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberExited</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">testProbe</span><span class="o">.</span><span class="na">expectMessageClass</span><span class="o">(</span><span class="nc">ClusterEvent</span><span class="o">.</span><span class="na">MemberRemoved</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">system</span><span class="o">.</span><span class="na">terminate</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="26-è®¾ç½®ç§å­èŠ‚ç‚¹">2.6. è®¾ç½®ç§å­èŠ‚ç‚¹</h2>

<p><strong>ç§å­èŠ‚ç‚¹ç®€ä»‹</strong></p>

<p>ç§å­èŠ‚ç‚¹æ˜¯åŠ å…¥é›†ç¾¤çš„åˆå§‹æ¥è§¦ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼å®ç°</p>
<ul>
  <li>é…ç½®æ–‡ä»¶æŒ‡å®š</li>
  <li>JVMå¯åŠ¨å‚æ•°æŒ‡å®š</li>
  <li>ç¨‹åºä¸­æ·»åŠ </li>
</ul>

<p>åœ¨åŠ å…¥è¿‡ç¨‹ä¹‹åï¼Œç§å­èŠ‚ç‚¹å¹¶ä¸ç‰¹æ®Šï¼Œå®ƒä»¬ä»¥ä¸å…¶ä»–èŠ‚ç‚¹å®Œå…¨ç›¸åŒçš„æ–¹å¼å‚ä¸åˆ°é›†ç¾¤ä¸­ã€‚</p>

<p>é€šè¿‡é›†ç¾¤å¼•å¯¼è‡ªåŠ¨è¿æ¥åˆ°ç§å­èŠ‚ç‚¹ï¼Œä½¿ç”¨å¼€æºçš„Akkaç®¡ç†é¡¹ç›®çš„æ¨¡å—Cluster Bootstrapï¼Œå¯ä»¥è‡ªåŠ¨å‘ç°è¿æ¥è¿‡ç¨‹çš„èŠ‚ç‚¹ã€‚è¯·å‚é˜…å…¶æ–‡æ¡£ä»¥äº†è§£æ›´å¤šç»†èŠ‚ã€‚</p>

<p>å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹å¯åŠ¨æ—¶ï¼Œå®ƒå‘æ‰€æœ‰é…ç½®çš„ç§å­èŠ‚ç‚¹å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå‘ç¬¬ä¸€ä¸ªå“åº”çš„èŠ‚ç‚¹å‘é€ä¸€ä¸ªjoinå‘½ä»¤ã€‚å¦‚æœæ²¡æœ‰ä¸€ä¸ªç§å­èŠ‚ç‚¹å“åº”(å¯èƒ½è¿˜æ²¡æœ‰å¯åŠ¨)ï¼Œå®ƒå°†é‡è¯•æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°æˆåŠŸæˆ–å…³é—­ã€‚</p>

<p>ç§å­èŠ‚ç‚¹å¯ä»¥æŒ‰ç…§ä»»ä½•é¡ºåºå¯åŠ¨ã€‚æ²¡æœ‰å¿…è¦è®©æ‰€æœ‰ç§å­èŠ‚ç‚¹éƒ½è¿è¡Œï¼Œä½†æ˜¯åœ¨åˆå§‹å¯åŠ¨é›†ç¾¤æ—¶å¿…é¡»å¯åŠ¨é…ç½®ä¸ºç§å­èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„èŠ‚ç‚¹ã€‚å¦åˆ™ï¼Œå…¶ä»–ç§å­èŠ‚ç‚¹å°†ä¸ä¼šè¢«åˆå§‹åŒ–ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯ä»¥åŠ å…¥é›†ç¾¤ã€‚</p>

<p><strong>ç§å­èŠ‚ç‚¹åŠ å…¥æ–¹å¼</strong></p>

<p>å…·ä½“åŠ å…¥æ–¹å¼</p>
<ol>
  <li>confé…ç½®æ–‡ä»¶æŒ‡å®š
akka{
  cluster{
     seed-nodes = [â€œakka://ClusterSystem@host1:2552â€,
     â€œakka://ClusterSystem@host2:2552â€]
  }
 }</li>
  <li>
    <p>å¯åœ¨JVMå¯åŠ¨æ˜¯æŒ‡å®š
-Dakka.cluster.seed-nodes.0=akka://ClusterSystem@host1:2552
-Dakka.cluster.seed-nodes.1=akka://ClusterSystem@host2:2552</p>
  </li>
  <li>é€šè¿‡æœ¬ç¤ºä¾‹ç¨‹åºä¸­åŠ å…¥ç§å­èŠ‚ç‚¹
 Cluster.get(system).manager().tell(new JoinSeedNodes(seedNodes));</li>
</ol>

<p><strong>ç¤ºä¾‹ç¨‹åºæ·»åŠ ç§å­èŠ‚ç‚¹</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">illustrateJoinSeedNodes</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">ActorSystem</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">system</span> <span class="o">=</span>
            <span class="nc">ActorSystem</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">Behaviors</span><span class="o">.</span><span class="na">empty</span><span class="o">(),</span> <span class="s">"ClusterSystem"</span><span class="o">,</span> <span class="n">noPort</span><span class="o">.</span><span class="na">withFallback</span><span class="o">(</span><span class="n">clusterConfig</span><span class="o">));</span>

    <span class="c1">// #join-seed-nodes</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Address</span><span class="o">&gt;</span> <span class="n">seedNodes</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="n">seedNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AddressFromURIString</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"akka://ClusterSystem@127.0.0.1:2551"</span><span class="o">));</span>
    <span class="n">seedNodes</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">AddressFromURIString</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"akka://ClusterSystem@127.0.0.1:2552"</span><span class="o">));</span>

    <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">system</span><span class="o">).</span><span class="na">manager</span><span class="o">().</span><span class="na">tell</span><span class="o">(</span><span class="k">new</span> <span class="nc">JoinSeedNodes</span><span class="o">(</span><span class="n">seedNodes</span><span class="o">));</span>
    <span class="c1">// #join-seed-nodes</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="27-é›†ç¾¤ä¼šå‘˜è§’è‰²">2.7. é›†ç¾¤ä¼šå‘˜è§’è‰²</h2>

<p>é›†ç¾¤çš„è§’è‰²é€šè¿‡æŒ‡å®šé…ç½®akka.cluster.rolesï¼Œå³overrides.put(â€œakka.cluster.rolesâ€, Collections.singletonList(role))å³å¯æŒ‡å®šé›†ç¾¤ä¼šå‘˜è§’è‰²ï¼Œè·å–è§’è‰²å¯é€šè¿‡ä¸‹é¢ç¤ºä¾‹æ–¹å¼è·å–é›†ç¾¤è§’è‰²ã€‚</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre> <span class="cm">/**
     * é›†ç¾¤è§’è‰²ç¤ºä¾‹
     *
     * é€šè¿‡æŒ‡å®šé…ç½®akka.cluster.roles
     * overrides.put("akka.cluster.roles", Collections.singletonList(role));
     */</span>
    <span class="kt">void</span> <span class="nf">illustrateRoles</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ActorContext</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="n">context</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="c1">// #hasRole</span>
        <span class="nc">Member</span> <span class="n">selfMember</span> <span class="o">=</span> <span class="nc">Cluster</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getSystem</span><span class="o">()).</span><span class="na">selfMember</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selfMember</span><span class="o">.</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"backend"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">context</span><span class="o">.</span><span class="na">spawn</span><span class="o">(</span><span class="nc">Backend</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span> <span class="s">"back"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">selfMember</span><span class="o">.</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"front"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">context</span><span class="o">.</span><span class="na">spawn</span><span class="o">(</span><span class="nc">Frontend</span><span class="o">.</span><span class="na">create</span><span class="o">(),</span> <span class="s">"front"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// #hasRole</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

:ET