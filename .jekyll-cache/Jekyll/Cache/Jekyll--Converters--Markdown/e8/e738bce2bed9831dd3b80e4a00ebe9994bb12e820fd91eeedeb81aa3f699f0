I"ят<h1 id="1-е®‰иЈ…еђЇеЉЁи®їй—®">1. е®‰иЈ…еђЇеЉЁи®їй—®</h1>

<p><strong>Step 1: дё‹иЅЅ</strong></p>

<p>дё‹иЅЅењ°еќЂпјљhttps://www.apache.org/dyn/closer.cgi?path=/druid/
дё‹иЅЅжњЂж–°з‰€зљ„Druid</p>

<p><strong>Step 2: дёЉдј е№¶и§ЈеЋ‹</strong></p>

<p>дёЉдј е€°йѓЁзЅІжњЌеЉЎе™Ёдё‹пјЊењЁз»€з«Їдё­иїђиЎЊд»Ґдё‹е‘Ѕд»¤жќҐжЏђеЏ–Druid</p>

<p>mkdir /var/lib/druid
tar -xzf apache-druid-0.20.0-bin.tar.gz -C /var/lib/druid</p>

<p><strong>Step 3:и®ѕзЅ®зЋЇеўѓеЏй‡Џ</strong></p>

<p>sudo echo вЂexport DRUID_HOME=/var/lib/druidвЂ™В В» /etc/profile
source /etc/profile</p>

<p><strong>Step 4пјљеђЇеЉЁ</strong>
cd $DRUID_HOME
./bin/start-micro-quickstart</p>

<p><strong>Step 4пјљи®їй—®DruidжЋ§е€¶еЏ°</strong></p>

<p>еЏЇд»Ґи®їй—®http://ip:8888/unified-console.htmlжќҐDruidжЋ§е€¶еЏ°пјЊжЋ§е€¶еЏ°з”±Druid Routerиї›зЁ‹еђЇеЉЁгЂ‚</p>

<h1 id="2-д»Ћжњ¬ењ°еЇје…Ґж•°жЌ®">2. д»Ћжњ¬ењ°еЇје…Ґж•°жЌ®</h1>

<h2 id="21-дЅїз”ЁdruidжЋ§е€¶еЏ°-data-loaderжќҐеЉ иЅЅж•°жЌ®">2.1. дЅїз”ЁDruidжЋ§е€¶еЏ°-Data LoaderжќҐеЉ иЅЅж•°жЌ®</h2>

<p><strong>Step 1пјљиї›е…ҐLoad data</strong></p>

<p>з‚№е‡»жЋ§е€¶еЏ°дё­зљ„ Load data</p>

<p><img src="https://liulv.work/images/img/20201209161135.png" alt="20201209161135" /></p>

<p><strong>Step 2пјљйЂ‰ж‹©жњ¬ењ°зЈЃз›</strong></p>

<p>йЂ‰ж‹© Local disk з„¶еђЋз‚№е‡» Connect data</p>

<p><img src="https://liulv.work/images/img/20201209161340.png" alt="20201209161340" /></p>

<p><strong>Step 3: и®ѕзЅ®Connect</strong></p>

<p>ењЁ Base directory дё­иѕ“е…Ґ quickstart/tutorial/, ењЁ File filter дё­иѕ“е…Ґ wikiticker-2015-09-12-sampled.json.gzгЂ‚ Base directory е’Њ File filter е€†ејЂжЇе› дёєеЏЇиѓЅйњЂи¦ЃеђЊж—¶д»Ће¤љдёЄж–‡д»¶дё­ж‘„еЏ–ж•°жЌ®гЂ‚з„¶еђЋз‚№е‡»applyзЎ®дїќж‚Ёзњ‹е€°зљ„ж•°жЌ®жЇж­ЈзЎ®зљ„пјЊе†Ќз‚№е‡»Next: Parse data</p>

<p><img src="https://liulv.work/images/img/20201209161603.png" alt="20201209161603" /></p>

<p><img src="https://liulv.work/images/img/20201209161703.png" alt="20201209161703" /></p>

<p><strong>Step 4: и®ѕзЅ®Parse data</strong></p>

<p>иѕ“е…Ґж јејЏи®ѕзЅ®json, з‚№е‡»дё‹дёЂж­Ґ</p>

<p><img src="https://liulv.work/images/img/20201209161858.png" alt="20201209161858" /></p>

<p><strong>Step 5: и®ѕзЅ®Parse time</strong></p>

<p>и®ѕзЅ®зљ„е€†еЊєе€—пјЊиї™жЇй»и®¤и®ѕзЅ®timeе€—еЌіеЏЇпјЊз‚№е‡»дё‹дёЂж­Ґ</p>

<p><img src="https://liulv.work/images/img/20201209162047.png" alt="20201209162047" /></p>

<p><strong>Step 6: и®ѕзЅ®иЅ¬жЌў</strong></p>

<p>еЏЇз‚№е‡»еЇ№еє”е€—пјЊиї›иЎЊи°ѓж•ґиЅ¬жЌўпјЊиї™й‡ЊдёЌйњЂи¦Ѓд»»дЅ•иЅ¬жЌўпјЊеЏЇз›ґжЋҐдё‹дёЂж­Ґ</p>

<p><img src="https://liulv.work/images/img/20201209162311.png" alt="20201209162311" /></p>

<p><strong>Step 7: и®ѕзЅ®иї‡ж»¤</strong></p>

<p>еЏЇз‚№е‡»еЇ№еє”е€—иї›иЎЊиї‡ж»¤и®ѕзЅ®пјЊи®ѕзЅ®иї‡ж»¤еЂјпјЊиї™й‡ЊдёЌйњЂи¦Ѓд»»дЅ•иї‡ж»¤пјЊеЏЇз›ґжЋҐдё‹дёЂж­Ґ</p>

<p><img src="https://liulv.work/images/img/20201209162435.png" alt="20201209162435" /></p>

<p><strong>Step 7: и°ѓж•ґschema-е€—еђЌе’Њз±»ећ‹з­‰</strong></p>

<p>еЏЇйЂ‰ж‹©еЇ№еє”е€—иї›иЎЊдї®ж”№пјЊиї™й‡Ње…ЁйѓЁдЅїз”Ёjsonй»и®¤зљ„пјЊеЏЇз›ґжЋҐдё‹дёЂж­Ґ</p>

<p><img src="https://liulv.work/images/img/20201209162654.png" alt="20201209162654" /></p>

<p><strong>Step 8: и®ѕзЅ®е€†еЊє</strong></p>

<p>е€†еЊєз±»ећ‹еЏЇи®ѕзЅ®з»џдёЂзљ„е’Њд»»ж„Џзљ„пјЊиї™й‡Њи®ѕзЅ®з»џдёЂзљ„пјЊе№¶дё”жЊ‰е¤©иї›иЎЊе€†еЊє</p>

<p><img src="https://liulv.work/images/img/20201209162852.png" alt="20201209162852" /></p>

<p><strong>Step 9: и°ѓдји®ѕзЅ®</strong></p>

<p>иї™й‡ЊдёЌиї›иЎЊд»»дЅ•дјеЊ–пјЊз›ґжЋҐдё‹дёЂж­ҐжЏђдє¤</p>

<p><img src="https://liulv.work/images/img/20201209163005.png" alt="20201209163005" /></p>

<p><strong>Step 10: жЏђдє¤и®ѕзЅ®</strong></p>

<p>дї®ж”№ж•°жЌ®жєђеђЌз§°</p>

<p><img src="https://liulv.work/images/img/20201209163119.png" alt="20201209163119" /></p>

<p><strong>Step 11: дї®ж”№jsonи§„иЊѓ</strong></p>

<p>иї™й‡Њжљ‚ж—¶дёЌйњЂи¦Ѓдї®ж”№пјЊз›ґжЋҐжЏђдє¤еЌіеЏЇ</p>

<p><img src="https://liulv.work/images/img/20201209163217.png" alt="20201209163217" /></p>

<p><strong>Step 12: жЏђдє¤е®Њж€ђдјљиї›е…Ґе€°д»»еЉЎе€—иЎЁ</strong></p>

<p><img src="https://liulv.work/images/img/20201209163811.png" alt="20201209163811" /></p>

<p>еЏЇз‚№е‡»иЇ¦жѓ…жЊ‰й’®жџҐзњ‹иїђиЎЊжѓ…е†µ</p>

<p><img src="https://liulv.work/images/img/20201209163914.png" alt="20201209163914" /></p>

<p><img src="https://liulv.work/images/img/20201209164006.png" alt="20201209164006" /></p>

<p><strong>Step 13: жџҐзњ‹ж•°жЌ®жєђе№¶жџҐиЇўж•°жЌ®</strong></p>

<p>з‚№е‡»DatasourceжЇеђ¦е·Із»Џж–°еўћwikiticker-test</p>

<p><img src="https://liulv.work/images/img/20201209164137.png" alt="20201209164137" /></p>

<p>з‚№е‡»Queryиї›иЎЊж•°жЌ®жџҐиЇў</p>

<p><img src="https://liulv.work/images/img/20201209164235.png" alt="20201209164235" /></p>

<h2 id="22-дЅїз”Ёе‘Ѕд»¤иЎЊж–№ејЏеЉ иЅЅж•°жЌ®">2.2. дЅїз”Ёе‘Ѕд»¤иЎЊж–№ејЏеЉ иЅЅж•°жЌ®</h2>

<p>дёєдє†ж–№дѕїпјЊењЁDruidзљ„иЅЇд»¶еЊ…дё­жЏђдѕ›дє†дёЂдёЄж‰№ж‘„еЏ–зљ„её®еЉ©и„љжњ¬ bin/post-index-task</p>

<p>иЇҐи„љжњ¬дјље°†ж•°жЌ®ж‘„еЏ–д»»еЉЎеЏ‘еёѓе€°Druid Overlordе№¶иЅ®иЇўDruidпјЊз›ґе€°еЏЇд»ҐжџҐиЇўж•°жЌ®дёєж­ўгЂ‚</p>

<p>ењЁDruidж №з›®еЅ•иїђиЎЊд»Ґдё‹е‘Ѕд»¤пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/wikipedia-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>еЏЇд»Ґзњ‹е€°д»Ґдё‹зљ„иѕ“е‡єпјљ</p>

<pre><code class="language-log">Beginning indexing data for wikipedia
Task started: index_wikipedia_2018-07-27T06:37:44.323Z
Task log:     http://localhost:8081/druid/indexer/v1/task/index_wikipedia_2018-07-27T06:37:44.323Z/log
Task status:  http://localhost:8081/druid/indexer/v1/task/index_wikipedia_2018-07-27T06:37:44.323Z/status
Task index_wikipedia_2018-07-27T06:37:44.323Z still running...
Task index_wikipedia_2018-07-27T06:37:44.323Z still running...
Task finished with status: SUCCESS
Completed indexing data for wikipedia. Now loading indexed data onto the cluster...
wikipedia loading complete! You may now query your data
</code></pre>

<p>жЏђдє¤д»»еЉЎи§„иЊѓеђЋпјЊж‚ЁеЏЇд»ҐжЊ‰з…§дёЉиї°з›ёеђЊзљ„и§„иЊѓз­‰еѕ…ж•°жЌ®еЉ иЅЅз„¶еђЋжџҐиЇў</p>

<h2 id="23-дЅїз”ЁhttpиЇ·ж±‚еЉ иЅЅж•°жЌ®">2.3. дЅїз”ЁHTTPиЇ·ж±‚еЉ иЅЅж•°жЌ®</h2>

<p>ж€‘д»¬з®Ђзџ­ењ°и®Ёи®єдёЂдё‹е¦‚дЅ•ењЁдёЌдЅїз”Ёи„љжњ¬зљ„жѓ…е†µдё‹жЏђдє¤ж•°жЌ®ж‘„еЏ–д»»еЉЎпјЊж‚Ёе°†дёЌйњЂи¦ЃиїђиЎЊиї™дє›е‘Ѕд»¤гЂ‚</p>

<p>и¦ЃжЏђдє¤д»»еЉЎпјЊеЏЇд»ҐењЁдёЂдёЄж–°зљ„з»€з«Їдё­йЂљиї‡д»Ґдё‹ж–№ејЏжЏђдє¤д»»еЉЎе€°Druidпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">curl</span><span class="w"> </span><span class="nt">-X</span><span class="w"> </span><span class="s1">'POST'</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s1">'Content-Type:application/json'</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="err">@</span><span class="nx">quickstart/tutorial/wikipedia-index.json</span><span class="w"> </span><span class="nx">http://localhost:8081/druid/indexer/v1/task</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>еЅ“д»»еЉЎжЏђдє¤ж€ђеЉџеђЋдјљж‰“еЌ°е‡єжќҐд»»еЉЎзљ„ID</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> {"task":"index_wikipedia_2018-06-09T21:30:32.802Z"}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ж‚ЁеЏЇд»Ґе¦‚дёЉж‰Ђиї°д»ЋжЋ§е€¶еЏ°з›‘и§†ж­¤д»»еЉЎзљ„зЉ¶жЂЃ</p>

<h1 id="3-д»ЋhadoopеЉ иЅЅж•°жЌ®">3. д»ЋHadoopеЉ иЅЅж•°жЌ®</h1>

<p>жњ¬з« иЉ‚д»‹з»Ќе¦‚дЅ•дЅїз”ЁиїњзЁ‹Hadoopй›†зѕ¤е°†ж•°жЌ®ж–‡д»¶еЉ иЅЅе€°Apache Druidдё­гЂ‚</p>

<h2 id="31-е‰ЌжЏђ">3.1. е‰ЌжЏђ</h2>

<p>е·Із»ЏењЁеђЊдёЂеЏЇд»Ґдє’йЂљзЅ‘з»ње®‰иЈ…дє†Druid е’Њ Hadoop, е№¶дё”йѓЅе·Із»ЏеђЇеЉЁ</p>

<h2 id="32-ж‹·иґќж•°жЌ®е€°sharedз›®еЅ•">3.2. ж‹·иґќж•°жЌ®е€°sharedз›®еЅ•</h2>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">cp</span><span class="w"> </span><span class="nv">$DRUID_HOME</span><span class="nx">/quickstart/tutorial/wikiticker-2015-09-12-sampled.json.gz</span><span class="w"> </span><span class="nx">/tmp/shared/wikiticker-2015-09-12-sampled.json.gz</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="33-и®ѕзЅ®hadoopз›®еЅ•">3.3. и®ѕзЅ®Hadoopз›®еЅ•</h2>

<p>ењЁHadoopе®№е™Ёshellдё­пјЊиїђиЎЊд»Ґдё‹е‘Ѕд»¤жќҐи®ѕзЅ®жњ¬ж¬Ўж•™зЁ‹йњЂи¦Ѓзљ„HDFSз›®еЅ•пјЊеђЊж—¶ж‹·иґќиѕ“е…Ґж•°жЌ®е€°HDFSдёЉ</p>

<p>hdfs dfs -mkdir /druid
hdfs dfs -mkdir /druid/segments
hdfs dfs -mkdir /quickstart
hdfs dfs -chmod 777 /druid
hdfs dfs -chmod 777 /druid/segments
hdfs dfs -chmod 777 /quickstart
hdfs dfs -chmod -R 777 /tmp
hdfs dfs -chmod -R 777 /user
hdfs dfs -put /shared/wikiticker-2015-09-12-sampled.json.gz /quickstart/wikiticker-2015-09-12-sampled.json.gz</p>

<h1 id="4-жџҐиЇўж•°жЌ®">4. жџҐиЇўж•°жЌ®</h1>

<p>жњ¬ж•™зЁ‹е°†д»ҐDruid SQLе’ЊDruidзљ„еЋџз”џжџҐиЇўж јејЏзљ„з¤єдѕ‹жј”з¤єе¦‚дЅ•ењЁApache Druidдё­жџҐиЇўж•°жЌ®гЂ‚</p>

<p>жњ¬ж•™зЁ‹еЃ‡е®љж‚Ёе·Із»Џе®Њж€ђдє†ж‘„еЏ–ж•™зЁ‹д№‹дёЂпјЊе› дёєж€‘д»¬е°†жџҐиЇўWikipediaзј–иѕ‘ж ·дѕ‹ж•°жЌ®гЂ‚</p>

<p>Druidж”ЇжЊЃSQLжџҐиЇўгЂ‚</p>

<p>иЇҐжџҐиЇўжЈЂзґўдє†2015е№ґ9жњ€12ж—Ґиў«зј–иѕ‘жњЂе¤љзљ„10дёЄз»ґеџєз™ѕз§‘йЎµйќў</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">page</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Edits</span>
<span class="k">FROM</span> <span class="n">wikipedia</span>
<span class="k">WHERE</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="o">&lt;=</span> <span class="nv">"__time"</span> <span class="k">AND</span> <span class="nv">"__time"</span> <span class="o">&lt;</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">page</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Edits</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">10</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>и®©ж€‘д»¬жќҐзњ‹е‡ з§ЌдёЌеђЊзљ„жџҐиЇўж–№жі•</p>

<h2 id="41-йЂљиї‡жЋ§е€¶еЏ°queryжџҐиЇў">4.1. йЂљиї‡жЋ§е€¶еЏ°QueryжџҐиЇў</h2>

<p><img src="https://liulv.work/images/img/20201209165417.png" alt="20201209165417" /></p>

<h2 id="42-йЂљиї‡dsqlжџҐиЇўsql">4.2. йЂљиї‡dsqlжџҐиЇўSQL</h2>

<p>дёєж–№дѕїиµ·и§ЃпјЊDruidиЅЇд»¶еЊ…дё­еЊ…ж‹¬дє†дёЂдёЄSQLе‘Ѕд»¤иЎЊе®ўж€·з«ЇпјЊдЅЌдєЋDruidж №з›®еЅ•дё­зљ„ bin/dsql</p>

<p>иїђиЎЊ bin/dsql, еЏЇд»Ґзњ‹е€°е¦‚дё‹пјљ</p>

<p>Welcome to dsql, the command-line client for Druid SQL.
Type вЂњ\hвЂќ for help.
dsql&gt;</p>

<p><img src="https://liulv.work/images/img/20201209165626.png" alt="20201209165626" /></p>

<h2 id="43-йЂљиї‡httpжџҐиЇўsql">4.3. йЂљиї‡HTTPжџҐиЇўSQL</h2>

<p>SQLжџҐиЇўдЅњдёєJSONйЂљиї‡HTTPжЏђдє¤</p>

<p>ж•™зЁ‹еЊ…ж‹¬дёЂдёЄз¤єдѕ‹ж–‡д»¶, иЇҐж–‡д»¶quickstart/tutorial/wikipedia-top-pages-sql.jsonеЊ…еђ«дёЉйќўжѕз¤єзљ„SQLжџҐиЇў, ж€‘д»¬е°†иЇҐжџҐиЇўжЏђдє¤з»™Druid BrokerгЂ‚</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="err">curl -X 'POST' -H 'Content-Type:application/json' -d @quickstart/tutorial/wikipedia-top-pages-sql.json http://localhost:8888/druid/v2/sql
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="44-ж›ґе¤љdruid-sqlз¤єдѕ‹">4.4. ж›ґе¤љDruid SQLз¤єдѕ‹</h2>

<h3 id="441-ж—¶й—ґжџҐиЇў">4.4.1. ж—¶й—ґжџҐиЇў</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">FLOOR</span><span class="p">(</span><span class="n">__time</span> <span class="k">to</span> <span class="n">HOUR</span><span class="p">)</span> <span class="k">AS</span> <span class="n">HourTime</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">deleted</span><span class="p">)</span> <span class="k">AS</span> <span class="n">LinesDeleted</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209165956.png" alt="20201209165956" /></p>

<h3 id="442-иЃљеђ€жџҐиЇў">4.4.2. иЃљеђ€жџҐиЇў</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">channel</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">channel</span><span class="p">,</span> <span class="n">page</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">SUM</span><span class="p">(</span><span class="n">added</span><span class="p">)</span> <span class="k">DESC</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209170146.png" alt="20201209170146" /></p>

<h3 id="443-жџҐиЇўеЋџе§‹ж•°жЌ®">4.4.3. жџҐиЇўеЋџе§‹ж•°жЌ®</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="n">page</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 02:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 03:00:00'</span>
<span class="k">LIMIT</span> <span class="mi">5</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209172941.png" alt="20201209172941" /></p>

<h3 id="444-жџҐзњ‹ж‰§иЎЊи®Ўе€’">4.4.4. жџҐзњ‹ж‰§иЎЊи®Ўе€’</h3>

<p>з‚№е‡»иїђиЎЊж—Ѓиѕ№вЂ¦ Explain SQL query</p>

<p><img src="https://liulv.work/images/img/20201209173045.png" alt="20201209173045" /></p>

<p><img src="https://liulv.work/images/img/20201209173114.png" alt="20201209173114" /></p>

<p>е¦‚жћњж‚Ёд»Ґе…¶д»–ж–№ејЏжџҐиЇўпјЊе€™еЏЇд»ҐйЂљиї‡ењЁDruid SQLжџҐиЇўд№‹е‰Ќж·»еЉ  EXPLAIN PLAN FOR жќҐиЋ·еѕ—жџҐиЇўи®Ўе€’гЂ‚</p>

<p>дЅїз”ЁдёЉиѕ№зљ„дёЂдёЄз¤єдѕ‹пјљ</p>

<p>EXPLAIN PLAN FOR SELECT page, COUNT(*) AS Edits FROM wikipedia WHERE вЂњ__timeвЂќ BETWEEN TIMESTAMP вЂ2015-09-12 00:00:00вЂ™ AND TIMESTAMP вЂ2015-09-13 00:00:00вЂ™ GROUP BY page ORDER BY Edits DESC LIMIT 10;</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">dsql</span><span class="o">&gt;</span> <span class="k">EXPLAIN</span> <span class="n">PLAN</span> <span class="k">FOR</span> <span class="k">SELECT</span> <span class="n">page</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Edits</span> <span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">page</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Edits</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
<span class="err">в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ</span>
<span class="err">в”‚</span> <span class="n">PLAN</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="err">в”‚</span>
<span class="err">в”њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¤</span>
<span class="err">в”‚</span> <span class="n">DruidQueryRel</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="err">{</span><span class="nv">"queryType"</span><span class="p">:</span><span class="nv">"topN"</span><span class="p">,</span><span class="nv">"dataSource"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"table"</span><span class="p">,</span><span class="nv">"name"</span><span class="p">:</span><span class="nv">"wikipedia"</span><span class="err">}</span><span class="p">,</span><span class="nv">"virtualColumns"</span><span class="p">:[],</span><span class="nv">"dimension"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"default"</span><span class="p">,</span><span class="nv">"dimension"</span><span class="p">:</span><span class="nv">"page"</span><span class="p">,</span><span class="nv">"outputName"</span><span class="p">:</span><span class="nv">"d0"</span><span class="p">,</span><span class="nv">"outputType"</span><span class="p">:</span><span class="nv">"STRING"</span><span class="err">}</span><span class="p">,</span><span class="nv">"metric"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"numeric"</span><span class="p">,</span><span class="nv">"metric"</span><span class="p">:</span><span class="nv">"a0"</span><span class="err">}</span><span class="p">,</span><span class="nv">"threshold"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="nv">"intervals"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"intervals"</span><span class="p">,</span><span class="nv">"intervals"</span><span class="p">:[</span><span class="nv">"2015-09-12T00:00:00.000Z/2015-09-13T00:00:00.001Z"</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="nv">"filter"</span><span class="p">:</span><span class="k">null</span><span class="p">,</span><span class="nv">"granularity"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"all"</span><span class="err">}</span><span class="p">,</span><span class="nv">"aggregations"</span><span class="p">:[</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"count"</span><span class="p">,</span><span class="nv">"name"</span><span class="p">:</span><span class="nv">"a0"</span><span class="err">}</span><span class="p">],</span><span class="nv">"postAggregations"</span><span class="p">:[],</span><span class="nv">"context"</span><span class="p">:</span><span class="err">{}</span><span class="p">,</span><span class="nv">"descending"</span><span class="p">:</span><span class="k">false</span><span class="err">}</span><span class="p">],</span> <span class="n">signature</span><span class="o">=</span><span class="p">[</span><span class="err">{</span><span class="n">d0</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span> <span class="n">a0</span><span class="p">:</span><span class="n">LONG</span><span class="err">}</span><span class="p">])</span> <span class="err">в”‚</span>
<span class="err">в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”</span>
<span class="n">Retrieved</span> <span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">03</span><span class="n">s</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="5-з‰№е€«жіЁж„Џ1">5. з‰№е€«жіЁж„Џ1</h1>

<p>Druid Hadoop Dockerе®‰иЈ…д№‹е‰ЌйњЂи¦Ѓе…ій—­SELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>getenforce
</pre></td></tr></tbody></table></code></pre></div></div>

<p>иї”е›ћ
Enforcing</p>

<p>ж‰§иЎЊе…ій—­SELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>setenforce 0
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config
</pre></td></tr></tbody></table></code></pre></div></div>

<p>жЈЂжџҐSELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>getenforce
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="6-roll-upиЃљеђ€ж“ЌдЅњ">6. Roll-upиЃљеђ€ж“ЌдЅњ</h1>

<p>Apache DruidеЏЇд»ҐйЂљиї‡roll-upењЁж•°жЌ®ж‘„еЏ–й¶ж®µеЇ№еЋџе§‹ж•°жЌ®иї›иЎЊж±‡жЂ»гЂ‚ Roll-upжЇеЇ№йЂ‰е®ље€—й›†зљ„дёЂзє§иЃљеђ€ж“ЌдЅњпјЊе®ѓеЏЇд»Ґе‡Џе°Џе­е‚Ёж•°жЌ®зљ„е¤§е°ЏгЂ‚</p>

<p>жњ¬ж•™зЁ‹дё­е°†и®Ёи®єењЁдёЂдёЄз¤єдѕ‹ж•°жЌ®й›†дёЉиї›иЎЊroll-upзљ„з»“жћњгЂ‚</p>

<p>жњ¬ж•™зЁ‹ж€‘д»¬еЃ‡и®ѕж‚Ёе·Із»ЏжЊ‰з…§еЌ•жњЌеЉЎе™ЁйѓЁзЅІдё­жЏЏиї°дё‹иЅЅдє†DruidпјЊе№¶иїђиЎЊењЁжњ¬ењ°жњєе™ЁдёЉгЂ‚</p>

<p>е®Њж€ђеЉ иЅЅжњ¬ењ°ж–‡д»¶е’Њж•°жЌ®жџҐиЇўдё¤йѓЁе€†е†…е®№д№џжЇйќћеёёжњ‰её®еЉ©зљ„гЂ‚</p>

<h2 id="61-ж•°жЌ®е‡†е¤‡">6.1. ж•°жЌ®е‡†е¤‡</h2>

<p>дЅїз”ЁдёЂдёЄзЅ‘з»њжµЃдє‹д»¶ж•°жЌ®зљ„е°Џж ·жњ¬пјЊиЎЁз¤єењЁз‰№е®љж—¶й—ґе†…д»Ћжєђе€°з›®ж ‡IPењ°еќЂзљ„жµЃй‡Џзљ„ж•°жЌ®еЊ…е’Ње­—иЉ‚и®Ўж•°гЂ‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">9024</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:51Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">21133</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:59Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">5780</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6289</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">377</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">359971</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:03:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">10204</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:33:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6289</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:33:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">93999</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:35:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">2818</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>з¤єдѕ‹ж•°жЌ®ењЁDruidе®‰иЈ…з›®еЅ•<code class="language-plaintext highlighter-rouge">quickstart/tutorial/rollup-data.json</code>дё‹пјЊж€‘д»¬е°†дЅїз”Ёж­¤жЋҐе…Ґж•°жЌ®и§„иЊѓжќҐжЋҐе…Ґж•°жЌ®гЂ‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup-tutorial"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"dstIP"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"timestampSpec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"column"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"week"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"minute"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-03"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/tutorial"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup-data.json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"appendToExisting"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsInMemory"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25000</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>йЂљиї‡ењЁ granularitySpec йЂ‰йЎ№дё­и®ѕзЅ® rollup : true жќҐеђЇз”ЁRoll-up</p>

<p>жіЁж„ЏпјЊж€‘д»¬е°†srcIPе’ЊdstIPе®љд№‰дёєз»ґеє¦пјЊе°†packetsе’Њbytesе€—е®љд№‰дёєдє†longSumз±»ећ‹зљ„жЊ‡ж ‡пјЊе№¶е°† queryGranularity й…ЌзЅ®е®љд№‰дёє minuteгЂ‚</p>

<p>еЉ иЅЅиї™дє›ж•°жЌ®еђЋпјЊж€‘д»¬е°†зњ‹е€°е¦‚дЅ•дЅїз”Ёиї™дє›е®љд№‰гЂ‚</p>

<h2 id="62-еЉ иЅЅж•°жЌ®">6.2. еЉ иЅЅж•°жЌ®</h2>

<p>ењЁDruidзљ„ж №з›®еЅ•дё‹иїђиЎЊд»Ґдё‹е‘Ѕд»¤пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/rollup-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>и„љжњ¬иїђиЎЊе®Њж€ђд»ҐеђЋпјЊж€‘д»¬е°†жџҐиЇўж•°жЌ®гЂ‚</p>

<p><img src="https://liulv.work/images/img/20201210145621.png" alt="20201210145621" /></p>

<h2 id="63-жџҐиЇўж•°жЌ®">6.3. жџҐиЇўж•°жЌ®</h2>

<p>зЋ°ењЁиїђиЎЊ bin/dsql з„¶еђЋж‰§иЎЊжџҐиЇў select * from вЂњrollup-tutorialвЂќ; жќҐжџҐзњ‹е·Із»Џиў«ж‘„е…Ґзљ„ж•°жЌ®</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="kt">root</span><span class="err">@</span><span class="kt">localhost</span><span class="w"> </span><span class="kt">apache</span><span class="nt">-druid-0</span><span class="mf">.20.0</span><span class="p">]</span><span class="c"># bin/dsql</span><span class="w">
</span><span class="nf">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">dsql</span><span class="p">,</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">command-line</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">Druid</span><span class="w"> </span><span class="nx">SQL.</span><span class="w">
</span><span class="nf">Connected</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="p">[</span><span class="kt">http</span><span class="p">:</span><span class="nf">//localhost:8082/</span><span class="p">]</span><span class="o">.</span><span class="w">

</span><span class="kt">Type</span><span class="w"> </span><span class="s2">"\h"</span><span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="no">help.</span><span class="w">
</span><span class="kt">dsql</span><span class="err">&gt;</span><span class="w"> </span><span class="kt">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">from</span><span class="w"> </span><span class="s2">"rollup-tutorial"</span><span class="p">;</span><span class="w">
</span><span class="err">в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="nf">__time</span><span class="w">                   </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">bytes</span><span class="w">  </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">dstIP</span><span class="w">   </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">packets</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">srcIP</span><span class="w">   </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¤</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w">  </span><span class="nx">35937</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">3</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">286</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">366260</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">2</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">415</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w">  </span><span class="nx">10204</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">1</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">в”‚</span><span class="w">      </span><span class="nx">49</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-02T21</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">100288</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">2</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">8.8.8.8</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">161</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">7.7.7.7</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-02T21</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w">   </span><span class="nx">2818</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">1</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">8.8.8.8</span><span class="w"> </span><span class="err">в”‚</span><span class="w">      </span><span class="nx">12</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">7.7.7.7</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”</span><span class="w">
</span><span class="kt">Retrieved</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kt">rows</span><span class="w"> </span><span class="kt">in</span><span class="w"> </span><span class="mf">0.18</span><span class="nf">s.</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>ж€‘д»¬жќҐзњ‹еЏ‘з”џењЁ 2018-01-01T01:01 зљ„дё‰жќЎеЋџе§‹ж•°жЌ®пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">9024</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:51Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">21133</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:59Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">5780</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>иї™дё‰жќЎж•°жЌ®е·Із»Џиў«roll upдёєд»Ґдё‹дёЂиЎЊж•°жЌ®пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="err">в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="nf">__time</span><span class="w">                   </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">bytes</span><span class="w">  </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">dstIP</span><span class="w">   </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">packets</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">srcIP</span><span class="w">   </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в”њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¤</span><span class="w">
</span><span class="err">в”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">в”‚</span><span class="w">  </span><span class="nx">35937</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">3</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">в”‚</span><span class="w">     </span><span class="nx">286</span><span class="w"> </span><span class="err">в”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">в”‚</span><span class="w">
</span><span class="err">в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>иї™иѕ“е…Ґзљ„ж•°жЌ®иЎЊе·Із»Џиў«жЊ‰з…§ж—¶й—ґе€—е’Њз»ґеє¦е€— {timestamp, srcIP, dstIP} ењЁжЊ‡ж ‡е€— {packages, bytes} дёЉеЃљж±‚е’ЊиЃљеђ€.</p>

<p>ењЁиї›иЎЊе€†з»„д№‹е‰ЌпјЊеЋџе§‹иѕ“е…Ґж•°жЌ®зљ„ж—¶й—ґж€іжЊ‰е€†й’џиї›иЎЊж ‡и®°/еёѓе±ЂпјЊиї™жЇз”±дєЋж‘„еЏ–и§„иЊѓдё­зљ„ вЂњqueryGranularityвЂќпјљвЂќminuteвЂќ и®ѕзЅ®йЂ ж€ђзљ„гЂ‚ еђЊж ·пјЊ2018-01-01T01:02 жњџй—ґеЏ‘з”џзљ„иї™дё¤иµ·дє‹д»¶д№џе·Із»Џж±‡жЂ»гЂ‚</p>

<h1 id="7-й…ЌзЅ®ж•°жЌ®дїќз•™и§„е€™">7. й…ЌзЅ®ж•°жЌ®дїќз•™и§„е€™</h1>

<p>еЃ‡и®ѕж€‘д»¬жѓіе€ й™¤2015е№ґ9жњ€12ж—Ґе‰Ќ12е°Џж—¶зљ„ж•°жЌ®пјЊдїќз•™2015е№ґ9жњ€12ж—ҐеђЋ12е°Џж—¶зљ„ж•°жЌ®гЂ‚</p>

<p>иї›е…Ґе€°Datasourcesи§†е›ѕпјЊз‚№е‡»зј–иѕ‘жЊ‰й’®-з„¶еђЋе†Ќз‚№е‡»Edit retention rules</p>

<p><img src="https://liulv.work/images/img/20201210150714.png" alt="20201210150714" /></p>

<p>дёЂдёЄи§„е€™й…ЌзЅ®зЄ—еЏЈе‡єзЋ°дє†пјљ</p>

<p><img src="https://liulv.work/images/img/20201210150821.png" alt="20201210150821" /></p>

<p>зЋ°ењЁз‚№е‡» + New rule жЊ‰й’®дё¤ж¬Ў</p>

<p>ењЁдёЉиѕ№зљ„и§„е€™жЎ†дё­пјЊйЂ‰ж‹© Load е’Њ by Interval з„¶еђЋиѕ“е…ҐењЁ by Interval ж—Ѓиѕ№зљ„иѕ“е…ҐжЎ†дё­иѕ“е…Ґ 2015-09-12T12:00:00.000Z/2015-09-13T00:00:00.000Z, е‰Їжњ¬еЏЇд»ҐйЂ‰ж‹©дїќжЊЃ2пјЊењЁ _default_tier дё­</p>

<p>ењЁдё‹иѕ№зљ„и§„е€™жЎ†дё­пјЊйЂ‰ж‹© Drop е’Њ forever</p>

<p>и§„е€™зњ‹дёЉеЋ»жЇиї™ж ·зљ„пјљ</p>

<p><img src="https://liulv.work/images/img/20201210151143.png" alt="20201210151143" /></p>

<p>зЋ°ењЁз‚№е‡» Next, и§„е€™й…ЌзЅ®иї‡зЁ‹е°†и¦Ѓж±‚жЏђдѕ›з”Ёж€·еђЌе’ЊжіЁй‡ЉпјЊд»Ґдѕїиї›иЎЊж›ґж”№ж—Ґеї—и®°еЅ•гЂ‚ж‚ЁеЏЇд»ҐеђЊж—¶иѕ“е…Ґж•™зЁ‹гЂ‚</p>

<p>зЋ°ењЁз‚№е‡» Save, еЏЇд»ҐењЁDatasourcesи§†е›ѕдё­зњ‹е€°ж–°зљ„и§„е€™</p>

<p><img src="https://liulv.work/images/img/20201210151757.png" alt="20201210151757" /></p>

<p>з»™й›†зѕ¤е‡ е€†й’џж—¶й—ґеє”з”Ёи§„е€™ж›ґж”№пјЊз„¶еђЋиЅ¬е€°DruidжЋ§е€¶еЏ°дё­зљ„segmentsи§†е›ѕгЂ‚2015е№ґ9жњ€12ж—Ґе‰Ќ12е°Џж—¶зљ„ж®µж–‡д»¶зЋ°е·Іж¶€е¤±</p>

<p><img src="https://liulv.work/images/img/20201210151931.png" alt="20201210151931" /></p>

<p>з”џж€ђзљ„дїќз•™и§„е€™й“ѕе¦‚дё‹:</p>

<p>loadByInterval 2015-09-12T12/2015-09-13 (12 hours)
dropForever
loadForever (й»и®¤и§„е€™)
и§„е€™й“ѕжЇи‡ЄдёЉиЂЊдё‹и®Ўз®—зљ„пјЊй»и®¤и§„е€™й“ѕе§‹з»€ж·»еЉ ењЁеє•йѓЁ</p>

<p>ж€‘д»¬е€ље€ље€›е»єзљ„ж•™зЁ‹и§„е€™й“ѕењЁжЊ‡е®љзљ„12е°Џж—¶й—ґйљ”е†…еЉ иЅЅж•°жЌ®</p>

<p>е¦‚жћњж•°жЌ®дёЌењЁ12е°Џж—¶зљ„й—ґйљ”е†…пјЊе€™и§„е€™й“ѕдё‹дёЂж­Ґе°†и®Ўз®— dropForeverпјЊиї™е°†е€ й™¤д»»дЅ•ж•°жЌ®</p>

<p>dropForever з»€ж­ўдє†и§„е€™й“ѕпјЊжњ‰ж•€ењ°и¦†з›–дє†й»и®¤зљ„ loadForever и§„е€™пјЊењЁиї™дёЄи§„е€™й“ѕдё­ж°ёиїњдёЌдјље€°иѕѕиЇҐи§„е€™</p>

<p>жіЁж„ЏпјЊењЁжњ¬ж•™зЁ‹дё­пјЊж€‘д»¬е®љд№‰дє†дёЂдёЄз‰№е®љй—ґйљ”зљ„еЉ иЅЅи§„е€™</p>

<p>з›ёеЏЌпјЊе¦‚жћњеёЊжњ›ж №жЌ®ж•°жЌ®зљ„з”џе‘Ѕе‘Ёжњџдїќз•™ж•°жЌ®пј€дѕ‹е¦‚пјЊдїќз•™д»Ћиї‡еЋ»3дёЄжњ€е€°зЋ°ењЁ3дёЄжњ€зљ„ж•°жЌ®пј‰пјЊе€™еє”е®љд№‰дёЂдёЄе‘ЁжњџжЂ§еЉ иЅЅи§„е€™</p>

<h1 id="8-ж•°жЌ®ж›ґж–°">8. ж•°жЌ®ж›ґж–°</h1>

<p>жњ¬ж•™зЁ‹жј”з¤єе¦‚дЅ•ж›ґж–°зЋ°жњ‰ж•°жЌ®пјЊеђЊж—¶е±•з¤єи¦†з›–(Overwrite)е’ЊиїЅеЉ (append)зљ„дё¤дёЄж–№ејЏгЂ‚</p>

<h2 id="81-ж•°жЌ®и¦†з›–overwrite">8.1. ж•°жЌ®и¦†з›–Overwrite</h2>

<h3 id="811-еЉ иЅЅе€ќе§‹ж•°жЌ®">8.1.1. еЉ иЅЅе€ќе§‹ж•°жЌ®</h3>

<p>жњ¬иЉ‚ж•™зЁ‹дЅїз”Ёзљ„д»»еЉЎж‘„еЏ–и§„иЊѓдЅЌдєЋ quickstart/tutorial/updates-init-index.json, жњ¬и§„иЊѓд»Ћ quickstart/tutorial/updates-data.json иѕ“е…Ґж–‡д»¶е€›е»єдёЂдёЄеђЌз§°дёє updates-tutorial зљ„ж•°жЌ®жєђ</p>

<p>жЏђдє¤д»»еЉЎпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/updates-init-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>ж€‘д»¬жњ‰дё‰дёЄеЊ…еђ«вЂќеЉЁз‰©вЂќз»ґеє¦е’ЊвЂќж•°е­—вЂќжЊ‡ж ‡зљ„е€ќе§‹иЎЊпјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201210153051.png" alt="20201210153051" /></p>

<h3 id="812-е°†ж—§ж•°жЌ®дёЋж–°ж•°жЌ®еђ€е№¶е№¶и¦†з›–">8.1.2. е°†ж—§ж•°жЌ®дёЋж–°ж•°жЌ®еђ€е№¶е№¶и¦†з›–</h3>

<p>зЋ°ењЁж€‘д»¬е°ќиЇ•ењЁ updates-tutorial ж•°жЌ®жєђиїЅеЉ дёЂдє›ж–°зљ„ж•°жЌ®пјЊж€‘д»¬е°†д»Ћ quickstart/tutorial/updates-data3.json еўћеЉ ж–°зљ„ж•°жЌ®</p>

<p>quickstart/tutorial/updates-append-index.json д»»еЉЎи§„иЊѓй…ЌзЅ®дёєд»ЋзЋ°жњ‰зљ„ updates-tutorial ж•°жЌ®жєђе’Њ quickstart/tutorial/updates-data3.json ж–‡д»¶иЇ»еЏ–ж•°жЌ®пјЊиЇҐд»»еЉЎе°†з»„еђ€жќҐи‡Єдё¤дёЄиѕ“е…Ґжєђзљ„ж•°жЌ®пјЊз„¶еђЋз”Ёж–°зљ„з»„еђ€ж•°жЌ®и¦†з›–еЋџе§‹ж•°жЌ®гЂ‚</p>

<p>жЏђдє¤д»»еЉЎпјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">bin</span><span class="o">/</span><span class="n">post</span><span class="o">-</span><span class="k">index</span><span class="o">-</span><span class="n">task</span> <span class="c1">--file quickstart/tutorial/updates-append-index.json --url http://localhost:8081</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>жџҐиЇўеђ€е№¶еђЋзљ„ж•°жЌ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>еЅ“Druidе®Њж€ђд»Ћиї™дёЄи¦†з›–д»»еЉЎеЉ иЅЅж–°ж®µж—¶пјЊж–°иЎЊе°†иў«ж·»еЉ е€°ж•°жЌ®жєђдё­гЂ‚иЇ·жіЁж„ЏпјЊвЂњLionвЂќиЎЊеЏ‘з”џдє†roll upпјљ</p>

<pre><code class="language-log">[root@localhost apache-druid-0.20.0]# bin/dsql

Welcome to dsql, the command-line client for Druid SQL.
Connected to [http://localhost:8082/].

Type "\h" for help.
dsql&gt; 
dsql&gt; 
dsql&gt; select * from "updates-tutorial";
в”Њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¬в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ђ
в”‚ __time                   в”‚ animal   в”‚ count в”‚ number в”‚
в”њв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”јв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”¤
в”‚ 2018-01-01T01:01:00.000Z в”‚ lion     в”‚     1 в”‚    300 в”‚
в”‚ 2018-01-01T01:01:00.000Z в”‚ tiger    в”‚     1 в”‚    100 в”‚
в”‚ 2018-01-01T03:01:00.000Z в”‚ aardvark в”‚     1 в”‚     42 в”‚
в”‚ 2018-01-01T03:01:00.000Z в”‚ giraffe  в”‚     1 в”‚  14124 в”‚
в”‚ 2018-01-01T05:01:00.000Z в”‚ mongoose в”‚     1 в”‚    737 в”‚
в”‚ 2018-01-01T06:01:00.000Z в”‚ snake    в”‚     1 в”‚   1234 в”‚
в”‚ 2018-01-01T07:01:00.000Z в”‚ octopus  в”‚     1 в”‚    115 в”‚
в””в”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”ґв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”Ђв”
Retrieved 7 rows in 0.13s.
</code></pre>

<h3 id="813-иїЅеЉ ж•°жЌ®">8.1.3. иїЅеЉ ж•°жЌ®</h3>

<p>зЋ°ењЁе°ќиЇ•еЏ¦дёЂз§ЌиїЅеЉ ж•°жЌ®зљ„ж–№ејЏ</p>

<p>quickstart/tutorial/updates-append-index2.json д»»еЉЎи§„иЊѓд»Ћ quickstart/tutorial/updates-data4.json ж–‡д»¶иЇ»еЏ–ж•°жЌ®пјЊз„¶еђЋиїЅеЉ е€° updates-tutorial ж•°жЌ®жєђгЂ‚жіЁж„Џе€°ењЁи§„иЊѓдё­ appendToExisting и®ѕзЅ®дёє true</p>

<p>жЏђдє¤д»»еЉЎпјљ</p>

<p>bin/post-index-task вЂ“file quickstart/tutorial/updates-append-index2.json вЂ“url http://localhost:8081</p>

<p>еЉ иЅЅж–°ж•°жЌ®еђЋпјЊж€‘д»¬еЏЇд»Ґзњ‹е€°вЂќoctopusвЂќеђЋйќўйўќе¤–зљ„дё¤иЎЊгЂ‚иЇ·жіЁж„ЏпјЊзј–еЏ·дёє222зљ„ж–°вЂќbearвЂќиЎЊе°љжњЄдёЋзЋ°жњ‰зљ„bear-111иЎЊеђ€е№¶пјЊе› дёєж–°ж•°жЌ®дїќе­ењЁеЌ•з‹¬зљ„ж®µдё­гЂ‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="9-еђ€е№¶ж®µж–‡д»¶">9. еђ€е№¶ж®µж–‡д»¶</h1>

<p>е› дёєжЇЏдёЂдёЄж®µйѓЅжњ‰дёЂдє›е†…е­е’Ње¤„зђ†ејЂй”ЂпјЊж‰Ђд»Ґжњ‰ж—¶е‡Џе°‘ж®µзљ„жЂ»ж•°жЇжњ‰з›Љзљ„пјЊжњ‰е…іиЇ¦з»†дїЎжЃЇпјЊиЇ·жџҐй…ж®µе¤§е°ЏдјеЊ–пјЊж‰Ђд»ҐйњЂи¦Ѓеђ€е№¶ж®µж–‡д»¶гЂ‚</p>

<h2 id="91-еЉ иЅЅе€ќе§‹еЊ–ж–‡д»¶">9.1. еЉ иЅЅе€ќе§‹еЊ–ж–‡д»¶</h2>

<p>ж€‘д»¬е°†дЅїз”ЁWikipediaзј–иѕ‘ж•°жЌ®пјЊе№¶дЅїз”Ёе€›е»єжЇЏе°Џж—¶ж®µзљ„зґўеј•и§„иЊѓ</p>

<p>иї™д»Ѕи§„иЊѓдЅЌдєЋ quickstart/tutorial/ompaction-init-index.json, е®ѓе°†е€›е»єдёЂдёЄеђЌз§°дёє ompaction-tutorial зљ„ж•°жЌ®жєђ</p>

<p>зЋ°ењЁеЉ иЅЅиї™д»Ѕе€ќе§‹ж•°жЌ®пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/compaction-init-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<blockquote>
  <p>![WARNING] иЇ·жіЁж„ЏпјЊж‘„еЏ–и§„иЊѓдё­зљ„ maxRowsPerSegment и®ѕзЅ®дёє1000, иї™жЇдёєдє†жЇЏе°Џж—¶з”џж€ђе¤љдёЄж®µпјЊдёЌе»єи®®ењЁз”џдє§дё­дЅїз”ЁгЂ‚й»и®¤дёє5000000пјЊеЏЇиѓЅйњЂи¦Ѓиї›иЎЊи°ѓж•ґд»ҐдјеЊ–ж‚Ёзљ„ж®µж–‡д»¶гЂ‚</p>
</blockquote>

<p>жЏђе‰Ќж•°жЌ®е®Њж€ђеђЋпјЊеЏЇд»Ґе€° http://localhost:8888/unified-console.html#datasources DruidжЋ§е€¶еЏ°жџҐзњ‹ж–°зљ„ж•°жЌ®жєђгЂ‚</p>

<p><img src="https://liulv.work/images/img/20201214151548.png" alt="20201214151548" /></p>

<p>жџҐзњ‹Availabilityж ЏпјЊз‚№е‡»еЇ№еє”зљ„ж•°жЌ®жєђзљ„segmentжџҐзњ‹ж®µ</p>

<p><img src="https://liulv.work/images/img/20201214151916.png" alt="20201214151916" /></p>

<p>иЇҐж•°жЌ®жєђжњ‰51дёЄж®µж–‡д»¶пјЊиѕ“е…Ґж•°жЌ®жЇЏе°Џж—¶1-3дёЄж®µ</p>

<p><img src="https://liulv.work/images/img/20201214152009.png" alt="20201214152009" /></p>

<p>еЇ№иЇҐж•°жЌ®жєђж‰§иЎЊдёЂдёЄ COUNT(*) жџҐиЇўеЏЇд»Ґзњ‹е€°39244иЎЊж•°жЌ®пјљ</p>

<p><img src="https://liulv.work/images/img/20201214152151.png" alt="20201214152151" /></p>

<h2 id="92-еђ€е№¶ж•°жЌ®жЊ‰е°Џж—¶">9.2. еђ€е№¶ж•°жЌ®пј€жЊ‰е°Џж—¶пј‰</h2>

<p>зЋ°ењЁж€‘д»¬е°†еђ€е№¶иї™51дёЄе°Џзљ„ж®µпјЊењЁ quickstart/tutorial/compaction-keep-granularity.json ж–‡д»¶дё­ж€‘д»¬еЊ…еђ«дє†дёЂдёЄжњ¬ж•™зЁ‹ж•°жЌ®жєђзљ„еђ€е№¶д»»еЉЎи§„иЊѓгЂ‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"compact"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"compaction-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"interval"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-09-12/2015-09-13"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRowsInMemory"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25000</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>иЇҐд»»еЉЎдјљеђ€е№¶ compaction-tutorial ж•°жЌ®жєђењЁ 2015-09-12/2015-09-13 ж—¶й—ґиЊѓе›ґе†…зљ„ж‰Ђжњ‰зљ„ж®µ</p>

<p>tuningConfig дё­зљ„еЏ‚ж•°жЋ§е€¶еђ€е№¶еђЋзљ„ж®µж–‡д»¶й›†еђ€дё­жњ‰е¤ље°‘дёЄж®µгЂ‚</p>

<p>ењЁжњ¬ж•™зЁ‹з¤єдѕ‹дё­пјЊжЇЏе°Џж—¶еЏЄе€›е»єдёЂдёЄеђ€е№¶ж®µпјЊе› дёєжЇЏе°Џж—¶зљ„иЎЊж•°е°‘дєЋ5000000 maxRowsPerSegmentпј€иЇ·жіЁж„ЏпјЊиЎЊжЂ»ж•°дёє39244пј‰гЂ‚</p>

<p>зЋ°ењЁжЏђдє¤иї™дёЄд»»еЉЎпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/compaction-keep-granularity.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>д»»еЉЎиїђиЎЊз»“жќџеђЋпјЊжџҐзњ‹datasource,еЏ‘зЋ°еЏЄжњ‰24дёЄsegments</p>

<p><img src="https://liulv.work/images/img/20201214152843.png" alt="20201214152843" /></p>

<p>е€·ж–° Segments и§†е›ѕ, вЂњSegmentsвЂќи§†е›ѕеє”жѕз¤єжњ‰24дёЄе€†ж®µпјЊжЇЏе°Џж—¶дёЂдёЄпјљ</p>

<p><img src="https://liulv.work/images/img/20201214152909.png" alt="20201214152909" /></p>

<h2 id="93-з”Ёж–°зљ„ж®µзІ’еє¦еђ€е№¶ж•°жЌ®жЊ‰е¤©">9.3. з”Ёж–°зљ„ж®µзІ’еє¦еђ€е№¶ж•°жЌ®(жЊ‰е¤©)</h2>

<p>еђ€е№¶д»»еЉЎиїеЏЇд»Ґз”џж€ђдёЌеђЊдєЋиѕ“е…Ґж®µзІ’еє¦зљ„еђ€е№¶ж®µ</p>

<p>ж€‘д»¬ењЁ quickstart/tutorial/compaction-day-granularity.json ж–‡д»¶дё­еЊ…еђ«дє†дёЂдёЄеЏЇд»Ґе€›е»є DAY зІ’еє¦зљ„еђ€е№¶д»»еЉЎж‘„еЏ–и§„иЊѓпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"compact"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"compaction-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"interval"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-09-12/2015-09-13"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"segmentGranularity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DAY"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"maxRowsInMemory"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"forceExtendableShardSpecs"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>иЇ·жіЁж„Џиї™дёЄеђ€е№¶д»»еЉЎи§„иЊѓдё­ segmentGranularity й…ЌзЅ®йЎ№и®ѕзЅ®дёєдє† DAY, зЋ°ењЁжЏђдє¤иї™дёЄд»»еЉЎпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/compaction-day-granularity.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Coordinatorе°†ж—§зљ„иѕ“е…Ґж®µж ‡и®°дёєжњЄдЅїз”ЁйњЂи¦ЃдёЂж®µж—¶й—ґпјЊе› ж­¤ж‚ЁеЏЇиѓЅдјљзњ‹е€°жЂ»е…±жњ‰25дёЄж®µзљ„дё­й—ґзЉ¶жЂЃгЂ‚жњЂз»€пјЊеЏЄжњ‰дёЂдёЄе¤©зІ’еє¦зљ„ж®µ</p>

<p><img src="https://liulv.work/images/img/20201214154047.png" alt="20201214154047" /></p>

<h1 id="10-ж•°жЌ®е€ й™¤">10. ж•°жЌ®е€ й™¤</h1>

<h2 id="101-еЉ иЅЅе€ќе§‹ж•°жЌ®">10.1. еЉ иЅЅе€ќе§‹ж•°жЌ®</h2>

<p>ж€‘д»¬е°†дЅїз”ЁWikipediaзј–иѕ‘ж•°жЌ®пјЊе№¶дЅїз”Ёе€›е»єжЇЏе°Џж—¶ж®µзљ„зґўеј•и§„иЊѓ, иї™д»Ѕи§„иЊѓдЅЌдєЋ quickstart/tutorial/deletion-index.json, е®ѓе°†е€›е»єдёЂдёЄеђЌз§°дёє deletion-tutorial зљ„ж•°жЌ®жєђ</p>

<p>зЋ°ењЁеЉ иЅЅиї™д»Ѕе€ќе§‹ж•°жЌ®пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/deletion-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>еЅ“еЉ иЅЅе®Њж€ђеђЋпјЊењЁжµЏи§€е™Ёдё­и®їй—®http://localhost:8888/unified-console.html#datasources</p>

<p><img src="https://liulv.work/images/img/20201214154326.png" alt="20201214154326" /></p>

<h2 id="102-е¦‚дЅ•ж°ёд№…е€ й™¤ж•°жЌ®">10.2. е¦‚дЅ•ж°ёд№…е€ й™¤ж•°жЌ®</h2>

<p>ж°ёд№…е€ й™¤дёЂдёЄж®µйњЂи¦Ѓдё¤ж­Ґпјљ</p>

<ol>
  <li>ж®µеї…йЎ»й¦–е…€ж ‡и®°дёєвЂќжњЄдЅїз”ЁвЂќгЂ‚еЅ“з”Ёж€·йЂљиї‡Coordinator APIж‰‹еЉЁз¦Ѓз”Ёж®µж—¶пјЊе°±дјљеЏ‘з”џиї™з§Ќжѓ…е†µ</li>
  <li>ењЁж®µиў«ж ‡и®°дёєвЂќжњЄдЅїз”ЁвЂќд№‹еђЋпјЊдёЂдёЄKillд»»еЉЎе°†д»ЋDruidзљ„е…ѓж•°жЌ®е­е‚Ёе’Њж·±е±‚е­е‚Ёдё­е€ й™¤д»»дЅ•вЂњжњЄдЅїз”ЁвЂќзљ„ж®µ</li>
</ol>

<p>зЋ°ењЁи®©ж€‘д»¬йЂљиї‡дЅїз”ЁCoordinator APIжЊ‰ж—¶й—ґй—ґйљ”е’Њж®µidе€ й™¤дёЂдє›ж®µгЂ‚</p>

<h2 id="103-йЂљиї‡ж—¶й—ґй—ґйљ”з¦Ѓз”Ёж®µ">10.3. йЂљиї‡ж—¶й—ґй—ґйљ”з¦Ѓз”Ёж®µ</h2>

<p>и®©ж€‘д»¬ењЁжЊ‡е®љзљ„ж—¶й—ґй—ґйљ”е†…з¦Ѓз”Ёж®µгЂ‚иї™дјље°†й—ґйљ”дё­зљ„ж‰Ђжњ‰ж®µж ‡и®°дёєвЂќжњЄдЅїз”ЁвЂќпјЊдЅ†дёЌдјље°†е®ѓд»¬д»Ћж·±е±‚е­е‚Ёдё­з§»й™¤гЂ‚и®©ж€‘д»¬з¦Ѓз”Ёй—ґйљ” 2015-09-12T18:00:00.000Z/2015-09-12T20:00:00.000Zдё­зљ„ж®µпјЊеЌіењЁ18е€°20е°Џж—¶д№‹й—ґ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">curl</span><span class="w"> </span><span class="nt">-X</span><span class="w"> </span><span class="s1">'POST'</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s1">'Content-Type:application/json'</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="s1">'{ "interval" : "2015-09-12T18:00:00.000Z/2015-09-12T20:00:00.000Z" }'</span><span class="w"> </span><span class="nx">http://localhost:8081/druid/coordinator/v1/datasources/deletion-tutorial/markUnused</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>иЇҐе‘Ѕд»¤е®Њж€ђеђЋпјЊж‚Ёеє”иЇҐзњ‹е€°з¬¬18е’Њ19е°Џж—¶зљ„ж®µе·Іиў«з¦Ѓз”Ёпјљ</p>

<p><img src="https://liulv.work/images/img/20201214154809.png" alt="20201214154809" /></p>

<p>иЇ·жіЁж„ЏпјЊз¬¬18е°Џж—¶е’Њз¬¬19е°Џж—¶зљ„ж•°жЌ®ж®µд»ЌењЁж·±е±‚е­е‚Ёдё­е‘Ѕд»¤:</p>
<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">ls</span><span class="w"> </span><span class="nt">-l1</span><span class="w"> </span><span class="nx">var/druid/segments/deletion-tutorial/</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201214154902.png" alt="20201214154902" /></p>

<h2 id="104-йЂљиї‡ж®µidз¦Ѓз”Ёж®µ">10.4. йЂљиї‡ж®µIDз¦Ѓз”Ёж®µ</h2>

<p>и®©ж€‘д»¬жЊ‰ж®µidз¦Ѓз”ЁдёЂдє›ж®µгЂ‚иї™е°†е†Ќж¬Ўе°†ж®µж ‡и®°дёєвЂњжњЄдЅїз”ЁвЂќпјЊдЅ†дёЌдјље°†е®ѓд»¬д»Ћж·±е±‚е­е‚Ёдё­з§»й™¤гЂ‚ж‚ЁеЏЇд»Ґд»ЋUIдё­зњ‹е€°е®Њж•ґзљ„ж®µidпјЊе¦‚дё‹ж‰Ђиї°гЂ‚</p>

<p>ењЁвЂќSegmentsвЂќи§†е›ѕдё­пјЊеЌ•е‡»вЂ¦ж“ЌдЅњжЊ‰й’®иї›е…ҐView SQL query for table</p>

<p><img src="https://liulv.work/images/img/20201214155933.png" alt="20201214155933" /></p>

<p>жџҐиЇўз»“жћњйЎµж‹‰дјёsegment_id</p>

<p><img src="https://liulv.work/images/img/1607932812(1).png" alt="1607932812(1)" /></p>

<p><img src="https://liulv.work/images/img/1607932900(1).png" alt="1607932900(1)" /></p>

<p>дїЎжЃЇжЎ†зљ„йЎ¶йѓЁжѕз¤єе®Њж•ґзљ„ж®µIDпјЊдѕ‹е¦‚ deletion-tutorial_2015-09-12T14:00:00.000Z_2015-09-12T15:00:00.000Z_2019-02-28T01:11:51.606ZпјЊз¬¬14е°Џж—¶зљ„ж®µгЂ‚</p>

<p>и®©ж€‘д»¬еђ‘CoordinatorеЏ‘йЂЃдёЂдёЄPOSTиЇ·ж±‚жќҐз¦Ѓз”Ё13з‚№е’Њ14з‚№зљ„ж®µ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"segmentIds"</span><span class="p">:</span><span class="w">
  </span><span class="p">[</span><span class="w">
    </span><span class="s2">"deletion-tutorial_2015-09-12T13:00:00.000Z_2015-09-12T14:00:00.000Z_2019-05-01T17:38:46.961Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"deletion-tutorial_2015-09-12T14:00:00.000Z_2015-09-12T15:00:00.000Z_2019-05-01T17:38:46.961Z"</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>jsonж–‡д»¶дЅЌдєЋquickstart/tutorial/deletion-disable-segments.json, е¦‚дё‹еђ‘CoordinatorжЏђдє¤дёЂдёЄPOSTиЇ·ж±‚пјљ</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="s1">'POST'</span> <span class="o">-</span><span class="n">H</span> <span class="s1">'Content-Type:application/json'</span> <span class="o">-</span><span class="n">d</span> <span class="o">@</span><span class="n">quickstart</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="n">deletion</span><span class="o">-</span><span class="n">disable</span><span class="o">-</span><span class="n">segments</span><span class="p">.</span><span class="n">json</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8081</span><span class="o">/</span><span class="n">druid</span><span class="o">/</span><span class="n">coordinator</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">datasources</span><span class="o">/</span><span class="n">deletion</span><span class="o">-</span><span class="n">tutorial</span><span class="o">/</span><span class="n">markUnused</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/1607933017(1).png" alt="1607933017(1)" /></p>

<p>е‘Ѕд»¤ж‰§иЎЊе®Њж€ђеђЋпјЊеЏЇд»Ґзњ‹е€°13ж—¶е’Њ14ж—¶зљ„ж®µе·Із»Џиў«з¦Ѓз”Ёпјљ</p>

<p><strong>дЅ†жЇ дЅ†жЇпјЊ ж€‘иї™й‡Њж‰§иЎЊз¦Ѓз”ЁдёЌдє†</strong></p>

<h2 id="105-иїђиЎЊkillд»»еЉЎ">10.5. иїђиЎЊKillд»»еЉЎ</h2>

<p>зЋ°ењЁж€‘д»¬е·Із»Џз¦Ѓз”Ёдє†дёЂдє›ж®µпјЊж€‘д»¬еЏЇд»ҐжЏђдє¤дёЂдёЄKillд»»еЉЎпјЊе®ѓе°†д»Ће…ѓж•°жЌ®е’Њж·±е±‚е­е‚Ёдё­е€ й™¤з¦Ѓз”Ёзљ„ж®µгЂ‚</p>

<p>ењЁ quickstart/tutorial/deletion-kill.json жЏђдѕ›дє†дёЂдёЄKillд»»еЉЎзљ„и§„иЊѓ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kill"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"deletion-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"interval"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-09-12/2015-09-13"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>йЂљиї‡д»Ґдё‹зљ„е‘Ѕд»¤е°†д»»еЉЎжЏђдє¤е€°Overlordпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">curl</span><span class="w"> </span><span class="nt">-X</span><span class="w"> </span><span class="s1">'POST'</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s1">'Content-Type:application/json'</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="err">@</span><span class="nx">quickstart/tutorial/deletion-kill.json</span><span class="w"> </span><span class="nx">http://localhost:8081/druid/indexer/v1/task</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>д»»еЉЎж‰§иЎЊе®Њж€ђеђЋпјЊеЏЇд»Ґзњ‹е€°е·Із»Џз¦Ѓз”Ёзљ„ж®µе·Із»Џиў«д»Ћж·±еє¦е­е‚Ёдё­з§»й™¤дє†пјљ</p>

<p><img src="https://liulv.work/images/img/1607933796(1).png" alt="1607933796(1)" /></p>

<h1 id="11-ж•°жЌ®жЋҐе…Ґзљ„и§„иЊѓ">11. ж•°жЌ®жЋҐе…Ґзљ„и§„иЊѓ</h1>

<p>жњ¬з« иЉ‚е°†жЊ‡еЇјиЇ»иЂ…е®љд№‰ж‘„еЏ–и§„иЊѓзљ„иї‡зЁ‹пјЊжЊ‡е‡єе…ій”®зљ„жіЁж„Џдє‹йЎ№е’ЊжЊ‡еЇјеЋџе€™гЂ‚</p>

<h2 id="111-з¤єдѕ‹ж•°жЌ®">11.1. з¤єдѕ‹ж•°жЌ®</h2>

<p>еЃ‡и®ѕж€‘д»¬жњ‰е¦‚дё‹зљ„зЅ‘з»њжµЃж•°жЌ®пјљ</p>

<ul>
  <li>srcIP: еЏ‘йЂЃз«Їзљ„IPењ°еќЂ</li>
  <li>srcPort: еЏ‘йЂЃз«Їзљ„з«ЇеЏЈ</li>
  <li>dstIP: жЋҐж”¶з«Їзљ„IPењ°еќЂ</li>
  <li>dstPort: жЋҐж”¶з«Їзљ„з«ЇеЏЈ</li>
  <li>protocol: IPеЌЏи®®еЏ·з Ѓ</li>
  <li>packets: дј иѕ“зљ„ж•°жЌ®еЊ…ж•°</li>
  <li>bytes: дј иѕ“зљ„е­—иЉ‚ж•°</li>
  <li>cost: еЏ‘йЂЃжµЃй‡Џзљ„ж€ђжњ¬</li>
</ul>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.4</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:51Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">3.1</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:59Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">7.9</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">10.2</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:03:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.3</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T02:33:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">10000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">22.4</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T02:33:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">20000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">34.5</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T02:35:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">4000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">30000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">46.3</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>е°†дёЉйќўзљ„JSONе†…е®№дїќе­е€° quickstart/ дё­еђЌдёєinsertion-tutorial-data.json зљ„ж–‡д»¶дё­гЂ‚</p>

<p>и®©ж€‘д»¬жќҐдє†и§ЈдёЂдё‹е®љд№‰еЏЇеЉ иЅЅж­¤ж•°жЌ®зљ„ж‘„еЏ–и§„иЊѓзљ„иї‡зЁ‹гЂ‚</p>

<p>еЇ№дєЋжњ¬ж•™зЁ‹пјЊж€‘д»¬е°†дЅїз”Ёжњ¬ењ°ж‰№зґўеј•д»»еЉЎгЂ‚дЅїз”Ёе…¶д»–д»»еЉЎз±»ећ‹ж—¶пјЊж‘„еЏ–и§„иЊѓзљ„жџђдє›ж–№йќўдјљжњ‰ж‰ЂдёЌеђЊпјЊжњ¬ж•™зЁ‹е°†жЊ‡е‡єиї™дє›ж–№йќўгЂ‚</p>

<h2 id="112-е®љд№‰schema">11.2. е®љд№‰schema</h2>

<p>Druidж‘„еЏ–и§„иЊѓдё­жњЂж ёеїѓзљ„е…ѓзґ жЇ dataSchemaгЂ‚ dataSchema е®љд№‰дє†е¦‚дЅ•е°†иѕ“е…Ґж•°жЌ®и§ЈжћђдёєдёЂз»„е€—пјЊиї™дє›е€—е°†е­е‚ЁењЁDruidдё­гЂ‚</p>

<p>и®©ж€‘д»¬д»ЋдёЂдёЄз©єзљ„ dataSchema ејЂе§‹пјЊе№¶ењЁе®Њж€ђж•™зЁ‹зљ„иї‡зЁ‹дё­еђ‘е®ѓж·»еЉ е­—ж®µгЂ‚</p>

<p>ењЁ quickstart/ дё­е€›е»єдёЂдёЄеђЌдёє insertion-tutorial-index.json зљ„ж–°ж–‡д»¶пјЊе…¶дё­еЊ…еђ«д»Ґдё‹е†…е®№пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="1121-ж•°жЌ®жєђеђЌз§°">11.2.1. ж•°жЌ®жєђеђЌз§°</h3>

<p>ж•°жЌ®жєђзљ„еђЌз§°йЂљиї‡ dataSource е­—ж®µжќҐењЁ dataSchema дё­иў«жЊ‡е®љпјљ</p>

<p>вЂњdataSchemaвЂќ : {
  вЂњdataSourceвЂќ : вЂњingestion-tutorialвЂќ,
}</p>

<h3 id="1122-ж—¶й—ґе€—">11.2.2. ж—¶й—ґе€—</h3>

<p>dataSchema йњЂи¦ЃзџҐйЃ“е¦‚дЅ•д»Ћиѕ“е…Ґж•°жЌ®дё­жЏђеЏ–дё»ж—¶й—ґж€іе­—ж®µгЂ‚</p>

<p>иѕ“е…Ґж•°жЌ®дё­зљ„timestampе€—еђЌдёєвЂќtsвЂќпјЊеЊ…еђ«ISO 8601ж—¶й—ґж€іпјЊе› ж­¤и®©ж€‘д»¬е°†еЊ…еђ«иЇҐдїЎжЃЇзљ„ timestampSpec ж·»еЉ е€° dataSchemaпјљ</p>

<p>вЂњdataSchemaвЂќ : {
  вЂњdataSourceвЂќ : вЂњingestion-tutorialвЂќ,
  вЂњtimestampSpecвЂќ : {
    вЂњformatвЂќ : вЂњisoвЂќ,
    вЂњcolumnвЂќ : вЂњtsвЂќ
  }
}</p>

<h2 id="113-rollup">11.3. Rollup</h2>
<p>ењЁжЋҐж”¶ж•°жЌ®ж—¶пјЊж€‘д»¬еї…йЎ»иЂѓи™‘жЇеђ¦и¦ЃдЅїз”Ёrollup</p>

<ul>
  <li>е¦‚жћњеђЇз”Ёдє†rollupпјЊж€‘д»¬йњЂи¦Ѓе°†иѕ“е…Ґе€—е€†дёєдё¤з±»пјЊвЂќdimensionsвЂќе’ЊвЂќmetricsвЂќгЂ‚вЂќdimensionsвЂќ жЇз”ЁдєЋrollupзљ„е€†з»„е€—пјЊвЂќmetricsвЂќжЇе°†и¦ЃиЃљеђ€зљ„е€—гЂ‚</li>
  <li>е¦‚жћњз¦Ѓз”Ёдє†rollupпјЊе€™ж‰Ђжњ‰е€—йѓЅиў«и§†дёєвЂќdimensionsвЂќпјЊе№¶дё”дёЌдјљеЏ‘з”џйў„иЃљеђ€гЂ‚</li>
</ul>

<p>еЇ№дєЋжњ¬ж•™зЁ‹пјЊи®©ж€‘д»¬еђЇз”ЁrollupгЂ‚иї™жЇз”Ё dataSchema дёЉgranularitySpec жЊ‡е®љзљ„гЂ‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>з»јеђ€</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="err">'</span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="1131-йЂ‰ж‹©dimensionе’Њmetrics">11.3.1. йЂ‰ж‹©dimensionе’ЊMetrics</h3>

<p>еЇ№дєЋиї™дёЄз¤єдѕ‹ж•°жЌ®й›†пјЊд»Ґдё‹жЇеЇ№вЂќdimensionsвЂќе’ЊвЂќmetricsвЂќзљ„еђ€зђ†е€’е€†пјљ</p>

<ul>
  <li>Dimensions: srcIP, srcPort, dstIP, dstPort, protocol</li>
  <li>Metrics: packets, bytes, cost</li>
</ul>

<p>иї™й‡Њзљ„з»ґеє¦жЇдёЂз»„е±ћжЂ§пјЊз”ЁдєЋж ‡иЇ†IPжµЃй‡Џзљ„еЌ•еђ‘жµЃпјЊиЂЊеє¦й‡Џе€™иЎЁз¤єз”±з»ґеє¦е€†з»„жЊ‡е®љзљ„IPжµЃй‡Џзљ„дє‹е®ћгЂ‚</p>

<p>и®©ж€‘д»¬зњ‹зњ‹е¦‚дЅ•ењЁж‘„еЏ–и§„иЊѓдё­е®љд№‰иї™дє›з»ґеє¦е’Њеє¦й‡ЏгЂ‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
  </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"doubleSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>жЇЏдёЄз»ґеє¦йѓЅжњ‰дёЂдёЄ еђЌз§° е’ЊдёЂдёЄ з±»ећ‹пјЊе…¶дё­ з±»ећ‹ еЏЇд»ҐжЇвЂќlongвЂќгЂЃвЂќfloatвЂќгЂЃвЂќdoubleвЂќж€–вЂќstringвЂќгЂ‚</p>

<p>жіЁж„ЏпјЊsrcIP жЇдёЂдёЄвЂќstringвЂќз»ґеє¦пј›еЇ№дєЋstringз»ґеє¦пјЊеЏЄйњЂжЊ‡е®љдёЂдёЄз»ґеє¦еђЌз§°е°±и¶іе¤џдє†пјЊе› дёєвЂќstringвЂќжЇй»и®¤зљ„з»ґеє¦з±»ећ‹гЂ‚</p>

<p>иїи¦ЃжіЁж„ЏпјЊprotocol жЇиѕ“е…Ґж•°жЌ®дё­зљ„дёЂдёЄж•°еЂјпјЊдЅ†ж€‘д»¬е°†е…¶дЅњдёєвЂќstringвЂќе€—ж‘„еЏ–пј›Druidе°†ењЁж‘„еЏ–жњџй—ґе°†иѕ“е…Ґlongејєе€¶дёєstringгЂ‚</p>

<p>е®љд№‰Metricsж—¶пјЊйњЂи¦ЃжЊ‡е®љењЁrollupжњџй—ґеЇ№иЇҐе€—ж‰§иЎЊдЅ•з§Ќз±»ећ‹зљ„иЃљеђ€</p>

<p>ењЁиї™й‡ЊпјЊж€‘д»¬ењЁдё¤дёЄLongз±»ећ‹зљ„Metricsе€—пј€ж•°жЌ®еЊ…е’Ње­—иЉ‚пј‰дёЉе®љд№‰дє†longSumиЃљеђ€пјЊе№¶дёєcostе€—е®љд№‰дє†дёЂдёЄdoubleSumиЃљеђ€</p>

<p>жіЁж„ЏпјЊmetricsSpec дёЋ dimensionSpec ж€– parseSpec дЅЌдєЋдёЌеђЊзљ„еµЊеҐ—зє§е€«пј›е®ѓдёЋ dataSchema дё­зљ„ parser е±ћдєЋз›ёеђЊзљ„еµЊеҐ—зє§е€«</p>

<p>жіЁж„ЏпјЊж€‘д»¬иїе®љд№‰дє†дёЂдёЄ count иЃљеђ€е™ЁгЂ‚и®Ўж•°иЃљеђ€е™Ёе°†и·џиёЄеЋџе§‹иѕ“е…Ґж•°жЌ®дё­жњ‰е¤ље°‘иЎЊиґЎзЊ®з»™жњЂз»€жЋҐж”¶ж•°жЌ®дё­зљ„вЂќroll upвЂќиЎЊгЂ‚</p>

<p>з»јеђ€</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
    </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"doubleSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">

</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="114-no-rollup">11.4. No Rollup</h2>

<p>е¦‚жћњж€‘д»¬жІЎдЅїз”ЁrollupпјЊж‰Ђжњ‰зљ„е€—йѓЅе°†ењЁ dimensionsSpec дё­жЊ‡е®љпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="w">   </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>з»јеђ€</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
    </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="115-е®љд№‰зІ’еє¦">11.5. е®љд№‰зІ’еє¦</h2>

<p>ењЁиї™дёЂз‚№дёЉпјЊж€‘д»¬е·Із»ЏењЁ dataSchema дё­е®љд№‰дє† parser е’ЊmetricsSpecпјЊе№¶дё”ж€‘д»¬е‡ д№Ће·Із»Џе®Њж€ђдє†ж‘„еЏ–и§„иЊѓзљ„зј–е†™</p>

<p>ж€‘д»¬йњЂи¦ЃењЁ granularitySpec дё­и®ѕзЅ®дёЂдє›е±ћжЂ§пјљ</p>

<ul>
  <li>granularitySpecз±»ећ‹пјљuniform е’Њ arbitrary жЇдё¤з§Ќж”ЇжЊЃзљ„з±»ећ‹гЂ‚ењЁжњ¬ж•™зЁ‹дё­пјЊж€‘д»¬е°†дЅїз”Ё uniform зІ’еє¦и§„иЊѓпјЊе…¶дё­ж‰Ђжњ‰ж®µйѓЅе…·жњ‰з»џдёЂзљ„й—ґйљ”пј€дѕ‹е¦‚пјљж‰Ђжњ‰ж®µйѓЅеЊ…еђ«дёЂе°Џж—¶зљ„ж•°жЌ®пј‰</li>
  <li>ж®µзІ’еє¦пјљеЌ•дёЄж®µдё­еЊ…еђ«зљ„ж•°жЌ®зљ„ж—¶й—ґй—ґйљ”е¤§е°Џпјџдѕ‹е¦‚пјљDAY, WEEK</li>
  <li>ж—¶й—ґе€—дё­ж—¶й—ґж€ізљ„bucketingзІ’еє¦пј€з§°дёєqueryGranularity)</li>
</ul>

<h3 id="1151-ж®µзІ’еє¦">11.5.1. ж®µзІ’еє¦</h3>

<p>ж®µзІ’еє¦з”± granularitySpec дё­зљ„ SegmentGranularity е±ћжЂ§й…ЌзЅ®гЂ‚еЇ№дєЋжњ¬ж•™зЁ‹пјЊж€‘д»¬е°†е€›е»єе°Џж—¶ж®µпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>ж€‘д»¬зљ„иѕ“е…Ґж•°жЌ®жњ‰дё¤дёЄз‹¬з«‹е°Џж—¶зљ„дє‹д»¶пјЊе› ж­¤ж­¤д»»еЉЎе°†з”џж€ђдё¤дёЄж®µгЂ‚</p>

<h3 id="1152-жџҐиЇўзІ’еє¦">11.5.2. жџҐиЇўзІ’еє¦</h3>

<p>жџҐиЇўзІ’еє¦з”± granularitySpec дё­зљ„ queryGranularity е±ћжЂ§й…ЌзЅ®гЂ‚еЇ№дєЋжњ¬ж•™зЁ‹пјЊж€‘д»¬дЅїз”Ёе€†й’џзІ’еє¦:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MINUTE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>и¦ЃжџҐзњ‹жџҐиЇўзІ’еє¦зљ„еЅ±е“ЌпјЊи®©ж€‘д»¬д»ЋеЋџе§‹иѕ“е…Ґж•°жЌ®дё­жџҐзњ‹иї™дёЂиЎЊ:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:03:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.3</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>еЅ“иї™дёЂиЎЊд»Ґе€†й’џжџҐиЇўзІ’еє¦ж‘„еЏ–ж—¶пјЊDruidдјље°†иЇҐиЎЊзљ„ж—¶й—ґж€іи®ѕзЅ®дёєе€†й’џжЎ¶пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"ts"</span><span class="p">:</span><span class="s2">"2018-01-01T01:03:00Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"srcPort"</span><span class="p">:</span><span class="mi">5000</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstPort"</span><span class="p">:</span><span class="mi">7000</span><span class="p">,</span><span class="w"> </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="nl">"cost"</span><span class="p">:</span><span class="w"> </span><span class="mf">4.3</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="1153-е®љд№‰ж—¶й—ґй—ґйљ”batch-only">11.5.3. е®љд№‰ж—¶й—ґй—ґйљ”пј€batch onlyпј‰</h3>

<p>еЇ№дєЋж‰№е¤„зђ†д»»еЉЎпјЊйњЂи¦Ѓе®љд№‰ж—¶й—ґй—ґйљ”гЂ‚ж—¶й—ґж€іи¶…е‡єж—¶й—ґй—ґйљ”зљ„иѕ“е…ҐиЎЊе°†дёЌдјљиў«жЋҐж”¶гЂ‚</p>

<p>ж—¶й—ґй—ґйљ”жЊ‡е®љењЁ granularitySpec й…ЌзЅ®йЎ№дё­intervalsзљ„й…ЌзЅ®ж—¶й—ґиЊѓе›ґпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MINUTE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-02"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>з»јеђ€</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"doubleSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MINUTE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-02"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="116-е®љд№‰д»»еЉЎз±»ећ‹">11.6. е®љд№‰д»»еЉЎз±»ећ‹</h2>

<p>ж€‘д»¬зЋ°ењЁе·Із»Џе®Њж€ђдє† dataSchema зљ„е®љд№‰гЂ‚е‰©дё‹зљ„ж­ҐйЄ¤жЇе°†ж€‘д»¬е€›е»єзљ„ж•°жЌ®жЁЎејЏж”ѕе…ҐдёЂдёЄж‘„еЏ–д»»еЉЎи§„иЊѓдё­пјЊе№¶жЊ‡е®љиѕ“е…ҐжєђгЂ‚</p>

<p>dataSchema ењЁж‰Ђжњ‰д»»еЉЎз±»ећ‹д№‹й—ґе…±дє«пјЊдЅ†жЇЏдёЄд»»еЉЎз±»ећ‹йѓЅжњ‰и‡Єе·±зљ„и§„иЊѓж јејЏгЂ‚еЇ№дєЋжњ¬ж•™зЁ‹пјЊж€‘д»¬е°†дЅїз”Ёжњ¬жњєж‰№е¤„зђ†ж‘„еЏ–д»»еЉЎtypeз±»ећ‹е®љд№‰дёєпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="err">....</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="117-е®љд№‰иѕ“е…Ґжєђ">11.7. е®љд№‰иѕ“е…Ґжєђ</h2>

<p>зЋ°ењЁи®©ж€‘д»¬е®љд№‰иѕ“е…ҐжєђпјЊе®ѓењЁ ioConfig еЇ№и±Ўдё­жЊ‡е®љгЂ‚жЇЏдёЄд»»еЉЎз±»ећ‹йѓЅжњ‰и‡Єе·±зљ„ ioConfig з±»ећ‹гЂ‚и¦ЃиЇ»еЏ–иѕ“е…Ґж•°жЌ®пјЊж€‘д»¬йњЂи¦ЃжЊ‡е®љдёЂдёЄinputSourceгЂ‚ж€‘д»¬е‰Ќйќўдїќе­зљ„з¤єдѕ‹зЅ‘з»њжµЃж•°жЌ®йњЂи¦Ѓд»Ћжњ¬ењ°ж–‡д»¶дё­иЇ»еЏ–пјЊиЇҐж–‡д»¶й…ЌзЅ®е¦‚дё‹пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial-data.json"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="118-е®љд№‰ж•°жЌ®ж јејЏ">11.8. е®љд№‰ж•°жЌ®ж јејЏ</h2>

<p>е®љд№‰ж•°жЌ®ж јејЏд№џжЇењЁ ioConfig еЇ№и±Ўдё­жЊ‡е®љпјЊе› дёєж€‘д»¬зљ„иѕ“е…Ґж•°жЌ®дёєJSONе­—з¬¦дёІпјЊж€‘д»¬дЅїз”Ёjsonзљ„ inputFormat:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>з»јеђ€пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"doubleSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MINUTE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-02"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial-data.json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="119-йўќе¤–зљ„и°ѓж•ґ">11.9. йўќе¤–зљ„и°ѓж•ґ</h2>

<p>жЇЏдёЂдёЄж‘„е…Ґд»»еЉЎйѓЅжњ‰дёЂдёЄ tuningConfig йѓЁе€†пјЊиЇҐйѓЁе€†е…Ѓи®ёз”Ёж€·еЏЇд»Ґи°ѓж•ґдёЌеђЊзљ„ж‘„е…ҐеЏ‚ж•°</p>

<p>дѕ‹е¦‚пјЊж€‘д»¬ж·»еЉ дёЂдёЄ tuningConfigпјЊе®ѓдёєжњ¬ењ°ж‰№е¤„зђ†ж‘„еЏ–д»»еЉЎи®ѕзЅ®з›®ж ‡ж®µе¤§е°Џпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>жіЁж„ЏпјљжЇЏдёЂз±»ж‘„е…Ґд»»еЉЎйѓЅжњ‰и‡Єе·±зљ„ tuningConfig з±»ећ‹</p>

<h2 id="1110-жњЂз»€еЅўж€ђзљ„и§„иЊѓ">11.10. жњЂз»€еЅўж€ђзљ„и§„иЊѓ</h2>

<p>ж€‘д»¬е·Із»Џе®љд№‰дє†ж‘„еЏ–и§„иЊѓпјЊзЋ°ењЁеє”иЇҐе¦‚дё‹ж‰Ђз¤єпјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"timestampSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"format"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"column"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ts"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"srcPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstIP"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dstPort"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"doubleSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"cost"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HOUR"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MINUTE"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-02"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"ingestion-tutorial-data.json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="1111-жЏђдє¤д»»еЉЎе’ЊжџҐиЇўж•°жЌ®">11.11. жЏђдє¤д»»еЉЎе’ЊжџҐиЇўж•°жЌ®</h2>

<p>ењЁDruidж №з›®еЅ•дё‹ж‰§иЎЊдё‹йќўе‘Ѕд»¤пјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/ingestion-tutorial-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>и„љжњ¬иїђиЎЊе®Њж€ђеђЋж€‘д»¬еЏЇд»ҐжџҐиЇўж•°жЌ®гЂ‚</p>

<p>иїђиЎЊ bin/dsql дё­иїђиЎЊ select * from вЂњingestion-tutorialвЂќ жџҐиЇўж€‘д»¬ж‘„е…Ґд»Ђд№€ж ·зљ„ж•°жЌ®</p>

<p><img src="https://liulv.work/images/img/20201215115911.png" alt="20201215115911" /></p>

<h1 id="12-иѕ“е…Ґж•°жЌ®еЏжЌў">12. иѕ“е…Ґж•°жЌ®еЏжЌў</h1>

<p>жњ¬з« иЉ‚е°†д»‹з»Ќе¦‚дЅ•дЅїз”ЁиЅ¬жЌўи§„иЊѓењЁжЋҐж”¶жњџй—ґиї‡ж»¤е’ЊиЅ¬жЌўиѕ“е…Ґж•°жЌ®гЂ‚</p>

<h2 id="121-ж ·дѕ‹ж•°жЌ®">12.1. ж ·дѕ‹ж•°жЌ®</h2>

<p>ж€‘д»¬ењЁ quickstart/tutorial/transform-data.json дё­еЊ…ж‹¬дє†ж ·дѕ‹ж•°жЌ®пјЊдёєдє†ж–№дѕїж€‘д»¬е±•з¤єдёЂдё‹пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T07:01:35Z"</span><span class="p">,</span><span class="nl">"animal"</span><span class="p">:</span><span class="s2">"octopus"</span><span class="p">,</span><span class="w">  </span><span class="nl">"location"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nl">"number"</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T05:01:35Z"</span><span class="p">,</span><span class="nl">"animal"</span><span class="p">:</span><span class="s2">"mongoose"</span><span class="p">,</span><span class="w"> </span><span class="nl">"location"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"number"</span><span class="p">:</span><span class="mi">200</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T06:01:35Z"</span><span class="p">,</span><span class="nl">"animal"</span><span class="p">:</span><span class="s2">"snake"</span><span class="p">,</span><span class="w"> </span><span class="nl">"location"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nl">"number"</span><span class="p">:</span><span class="mi">300</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"animal"</span><span class="p">:</span><span class="s2">"lion"</span><span class="p">,</span><span class="w"> </span><span class="nl">"location"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nl">"number"</span><span class="p">:</span><span class="mi">300</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="122-дЅїз”ЁиЅ¬жЌўи§„иЊѓеЉ иЅЅж•°жЌ®">12.2. дЅїз”ЁиЅ¬жЌўи§„иЊѓеЉ иЅЅж•°жЌ®</h2>

<p>ењЁиЅ¬жЌўи§„иЊѓдё­пјЊж€‘д»¬жњ‰дё¤дёЄиЎЁиѕѕејЏиЅ¬жЌўпјљ</p>

<ul>
  <li>super-animal: ењЁ вЂњanimalвЂќ е€—зљ„еЂје‰ЌеЉ дёЉвЂќsuper-вЂњгЂ‚иї™е°†з”ЁиЅ¬жЌўеђЋзљ„з‰€жњ¬и¦†з›– animal е€—пјЊе› дёєиЅ¬жЌўзљ„еђЌз§°жЇ animal</li>
  <li>triple-number: е°†ж•°е­—е€—д№д»Ґ3, иї™е°†е€›е»єдёЂдёЄж–°зљ„дё‰дЅЌж•°е€—гЂ‚жіЁж„ЏпјЊж€‘д»¬еђЊж—¶жЋҐж”¶еЋџе§‹е€—е’ЊиЅ¬жЌўе€—</li>
</ul>

<p>еЏ¦е¤–пјЊж€‘д»¬жњ‰дёЂдёЄеЊ…еђ«дё‰дёЄе­ђеЏҐзљ„ORиї‡ж»¤е™Ёпјљ</p>

<ul>
  <li>super-animal еЂјеЊ№й…ЌвЂќsuper-mongooseвЂќ</li>
  <li>triple-number еЂјеЊ№й…Ќ300</li>
  <li>locationеЂјеЊ№й…Ќ3</li>
</ul>

<p>иї™дёЄиї‡ж»¤е™ЁйЂ‰ж‹©е‰Ќ3иЎЊпјЊе®ѓе°†жЋ’й™¤иѕ“е…Ґж•°жЌ®дё­зљ„жњЂеђЋдёЂдёЄвЂќlionвЂќиЎЊгЂ‚иЇ·жіЁж„ЏпјЊиї‡ж»¤е™ЁжЇењЁиЅ¬жЌўд№‹еђЋеє”з”Ёзљ„гЂ‚иї™дёЄењЁspec - dataSchema -transformSpec иЉ‚з‚№дё‹й…ЌзЅ®пјЊе¦‚дё‹пјљ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="w">  </span><span class="nl">"transformSpec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"transforms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"animal"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"concat('super-', animal)"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"number * 3"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"or"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"animal"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"super-mongoose"</span><span class="w"> </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"300"</span><span class="w"> </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"location"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="w"> </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>е®Њж•ґ</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"transform-tutorial"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"timestampSpec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"column"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"animal"</span><span class="p">,</span><span class="w">
          </span><span class="p">{</span><span class="w"> </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"location"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w"> </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"number"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"week"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"minute"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-03"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"transformSpec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"transforms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"animal"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"concat('super-', animal)"</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"expression"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"expression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"number * 3"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"filter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"or"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"animal"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"super-mongoose"</span><span class="w"> </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"triple-number"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"300"</span><span class="w"> </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"selector"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dimension"</span><span class="p">:</span><span class="w"> </span><span class="s2">"location"</span><span class="p">,</span><span class="w"> </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="w"> </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/tutorial"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"transform-data.json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="s2">"json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"appendToExisting"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsInMemory"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25000</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="123-жЏђдє¤д»»еЉЎ">12.3. жЏђдє¤д»»еЉЎ</h2>

<p>зЋ°ењЁжЏђдє¤дЅЌдєЋ quickstart/tutorial/transform-index.json зљ„д»»еЉЎпјљ</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/transform-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="124-жџҐиЇўе·ІиЅ¬жЌўзљ„ж•°жЌ®">12.4. жџҐиЇўе·ІиЅ¬жЌўзљ„ж•°жЌ®</h2>

<p>иїђиЎЊ bin/dsql жЏђдє¤ select * from вЂњtransform-tutorialвЂќ жџҐиЇўжќҐзњ‹ж‘„е…Ґзљ„ж•°жЌ®пјљ</p>

<p><img src="https://liulv.work/images/img/20201215161618.png" alt="20201215161618" /></p>

<h1 id="13-жћ¶жћ„и®ѕи®Ў">13. жћ¶жћ„и®ѕи®Ў</h1>

<p>Druidжњ‰дёЂдёЄе¤љиї›зЁ‹гЂЃе€†еёѓејЏзљ„жћ¶жћ„пјЊиЇҐжћ¶жћ„и®ѕи®Ўдёєдє‘еЏ‹еҐЅдё”ж“дєЋж“ЌдЅњгЂ‚жЇЏдёЄDruidиї›зЁ‹йѓЅеЏЇд»Ґз‹¬з«‹й…ЌзЅ®е’Њж‰©е±•пјЊењЁй›†зѕ¤дёЉжЏђдѕ›жњЂе¤§зљ„зЃµжґ»жЂ§гЂ‚иї™з§Ќи®ѕи®ЎиїжЏђдѕ›дє†еўћејєзљ„е®№й”™иѓЅеЉ›пјљдёЂдёЄз»„д»¶зљ„дё­ж–­дёЌдјљз«‹еЌіеЅ±е“Ќе…¶д»–з»„д»¶гЂ‚</p>

<h2 id="131-иї›зЁ‹дёЋжњЌеЉЎ">13.1. иї›зЁ‹дёЋжњЌеЉЎ</h2>

<p>Druidжњ‰и‹Ґе№ІдёЌеђЊз±»ећ‹зљ„иї›зЁ‹пјЊз®ЂеЌ•жЏЏиї°е¦‚дё‹пјљ</p>

<ul>
  <li><a href="#">Coordinator</a> иї›зЁ‹з®Ўзђ†й›†зѕ¤дё­ж•°жЌ®зљ„еЏЇз”ЁжЂ§</li>
  <li><a href="#">Overlord</a> иї›зЁ‹жЋ§е€¶ж•°жЌ®ж‘„еЏ–иґџиЅЅзљ„е€†й…Ќ</li>
  <li><a href="#">Broker</a> иї›зЁ‹е¤„зђ†жќҐи‡Єе¤–йѓЁе®ўж€·з«Їзљ„жџҐиЇўиЇ·ж±‚</li>
  <li><a href="#">Router</a> иї›зЁ‹жЇдёЂдёЄеЏЇйЂ‰иї›зЁ‹пјЊеЏЇд»Ґе°†иЇ·ж±‚и·Їз”±е€°BrokersгЂЃCoordinatorsе’ЊOverlords</li>
  <li><a href="#">Historical</a> иї›зЁ‹е­е‚ЁеЏЇжџҐиЇўзљ„ж•°жЌ®</li>
  <li><a href="#">MiddleManager</a> иї›зЁ‹иґџиґЈж‘„еЏ–ж•°жЌ®</li>
</ul>

<p>Druidиї›зЁ‹еЏЇд»ҐжЊ‰з…§ж‚Ёе–њж¬ўзљ„ж–№ејЏйѓЁзЅІпјЊдЅ†жЇдёєдє†дѕїдєЋйѓЁзЅІпјЊж€‘д»¬е»єи®®е°†е®ѓд»¬з»„з»‡ж€ђдё‰з§ЌжњЌеЉЎе™Ёз±»ећ‹пјљMasterгЂЃQueryе’ЊDataгЂ‚</p>

<ul>
  <li><strong>Master</strong>: иїђиЎЊCoordinatorе’ЊOverlordиї›зЁ‹пјЊз®Ўзђ†ж•°жЌ®еЏЇз”ЁжЂ§е’Њж‘„еЏ–</li>
  <li><strong>Query:</strong> иїђиЎЊBrokerе’ЊеЏЇйЂ‰зљ„Routerиї›зЁ‹пјЊе¤„зђ†жќҐи‡Єе¤–йѓЁе®ўж€·з«Їзљ„иЇ·ж±‚</li>
  <li><strong>Data:</strong> иїђиЎЊHistoricalе’ЊMiddleManagerиї›зЁ‹пјЊж‰§иЎЊж‘„еЏ–иґџиЅЅе’Ње­е‚Ёж‰Ђжњ‰еЏЇжџҐиЇўзљ„ж•°жЌ®</li>
</ul>

<p>е…ідєЋиї›зЁ‹е’ЊжњЌеЉЎз»„з»‡зљ„ж›ґе¤љдїЎжЃЇпјЊеЏЇд»ҐжџҐзњ‹Druid<a href="#">иї›зЁ‹дёЋжњЌеЉЎ</a></p>

<h2 id="132-е¤–йѓЁдѕќиµ–">13.2. е¤–йѓЁдѕќиµ–</h2>

<p>й™¤дє†е†…зЅ®зљ„иї›зЁ‹з±»ећ‹е¤–пјЊDruidеђЊж—¶жњ‰дё‰дёЄе¤–йѓЁдѕќиµ–пјЊе®ѓд»¬ж—ЁењЁе€©з”ЁзЋ°жњ‰зљ„еџєзЎЂи®ѕж–Ѕпј€е¦‚жћњжњ‰зљ„иЇќпј‰гЂ‚</p>

<h2 id="133-ж·±еє¦е­е‚Ё">13.3. ж·±еє¦е­е‚Ё</h2>

<p>жЇЏдёЄDruidжњЌеЉЎе™ЁйѓЅеЏЇд»Ґи®їй—®зљ„е…±дє«ж–‡д»¶е­е‚ЁгЂ‚ењЁй›†зѕ¤йѓЁзЅІдё­пјЊйЂљеёёдЅїз”ЁдёЂдёЄеѓЏS3ж€–HDFSиї™ж ·зљ„е€†еёѓејЏеЇ№и±Ўе­е‚ЁпјЊж€–иЂ…жЇдёЂдёЄзЅ‘з»њжЊ‚иЅЅзљ„ж–‡д»¶зі»з»џгЂ‚ењЁеЌ•жњЌеЉЎе™ЁйѓЁзЅІдё­пјЊйЂљеёёдЅїз”Ёжњ¬ењ°зЈЃз›гЂ‚DruidдЅїз”Ёж·±еє¦е­е‚ЁжќҐе­е‚Ёд»»дЅ•е·Іиў«зі»з»џжЋҐж”¶зљ„ж•°жЌ®гЂ‚</p>

<p>DruidеЏЄдЅїз”Ёж·±еє¦е­е‚ЁдЅњдёєж•°жЌ®е¤‡д»ЅпјЊе№¶дЅњдёєењЁеђЋеЏ°Druidиї›зЁ‹д№‹й—ґдј иѕ“ж•°жЌ®зљ„дёЂз§Ќж–№ејЏгЂ‚дёєдє†е“Ќеє”жџҐиЇўпјЊHistoricalиї›зЁ‹дёЌдјљд»Ћж·±е±‚е­е‚Ёдё­иЇ»еЏ–ж•°жЌ®пјЊиЂЊжЇд»Ћжњ¬ењ°зЈЃз›иЇ»еЏ–ењЁж‰§иЎЊд»»дЅ•жџҐиЇўд№‹е‰Ќйў„зј“е­зљ„ж®µпјЊиї™ж„Џе‘ізќЂDruidењЁжџҐиЇўжњџй—ґдёЌйњЂи¦Ѓи®їй—®ж·±е±‚е­е‚ЁпјЊиї™жњ‰еЉ©дєЋе®ѓжЏђдѕ›е°ЅеЏЇиѓЅжњЂеҐЅзљ„жџҐиЇўе»¶иїџгЂ‚иї™д№џж„Џе‘ізќЂж‚Ёеї…йЎ»ењЁж·±е±‚е­е‚Ёе’Њж‰Ђжњ‰Historicalиї›зЁ‹дё­йѓЅжњ‰и¶іе¤џзљ„зЈЃз›з©єй—ґжќҐе­е‚Ёи®Ўе€’еЉ иЅЅзљ„ж•°жЌ®гЂ‚</p>

<p>ж·±еє¦е­е‚ЁжЇDruidеј№жЂ§гЂЃе®№й”™и®ѕи®Ўзљ„й‡Ќи¦Ѓз»„ж€ђйѓЁе€†гЂ‚еЌідЅїжЇЏдёЄж•°жЌ®жњЌеЉЎе™ЁйѓЅдёўе¤±е№¶й‡Ќж–°й…ЌзЅ®пјЊDruidд№џеЏЇд»Ґд»Ћж·±е±‚е­е‚ЁеђЇеЉЁгЂ‚</p>

<p>жњ‰е…іж›ґе¤љиЇ¦з»†дїЎжЃЇпјЊиЇ·еЏ‚и§Ѓж·±еє¦е­е‚Ё</p>

<h2 id="134-е…ѓж•°жЌ®е­е‚Ё">13.4. е…ѓж•°жЌ®е­е‚Ё</h2>

<p>е…ѓж•°жЌ®е­е‚ЁеЊ…еђ«еђ„з§Ќе…±дє«зљ„зі»з»џе…ѓж•°жЌ®пјЊе¦‚ж®µеЏЇз”ЁжЂ§дїЎжЃЇе’Њд»»еЉЎдїЎжЃЇгЂ‚ењЁй›†зѕ¤йѓЁзЅІдё­пјЊйЂљеёёдЅїз”ЁеѓЏPostgreSQLж€–MySQLиї™ж ·зљ„дј з»џRDBMSгЂ‚ењЁеЌ•жњЌеЉЎе™ЁйѓЁзЅІдё­пјЊйЂљеёёдЅїз”Ёжњ¬ењ°е­е‚Ёзљ„Apache Derbyж•°жЌ®еє“гЂ‚</p>

<p>жњ‰е…іж›ґе¤љиЇ¦з»†дїЎжЃЇпјЊиЇ·еЏ‚и§Ѓе…ѓж•°жЌ®е­е‚Ё.</p>

<h2 id="135-zookeeper">13.5. Zookeeper</h2>

<p>з”ЁдєЋе†…йѓЁжњЌеЉЎеЏ‘зЋ°гЂЃеЌЏи°ѓе’Њйў†еЇјйЂ‰дёѕгЂ‚</p>

<p>жњ‰е…іж›ґе¤љиЇ¦з»†дїЎжЃЇпјЊиЇ·еЏ‚и§ЃZookeeper</p>

<h2 id="136-жћ¶жћ„е›ѕ">13.6. жћ¶жћ„е›ѕ</h2>

<p>дё‹е›ѕжѕз¤єдє†дЅїз”Ёе»єи®®зљ„Master/Query/DataжњЌеЉЎз»„з»‡пјЊжџҐиЇўе’Њж•°жЌ®е¦‚дЅ•йЂљиї‡ж­¤дЅ“зі»з»“жћ„жµЃеЉЁпјљ</p>

<p><img src="https://liulv.work/images/img/20201215180836.png" alt="20201215180836" /></p>

<h2 id="137-е­е‚Ёи®ѕи®Ў">13.7. е­е‚Ёи®ѕи®Ў</h2>

<p><strong>ж•°жЌ®жєђе’Њж®µ</strong></p>

<p>Druidж•°жЌ®иў«е­е‚ЁењЁвЂќdatasourcesвЂќдё­пјЊз±»дјјдєЋдј з»џRDBMSдё­зљ„иЎЁгЂ‚жЇЏдёЂдёЄж•°жЌ®жєђеЏЇд»Ґж №жЌ®ж—¶й—ґиї›иЎЊе€†еЊєпјЊеЏЇйЂ‰ењ°иїеЏЇд»Ґиї›дёЂж­Ґж №жЌ®е…¶д»–е±ћжЂ§иї›иЎЊе€†еЊєгЂ‚жЇЏдёЂдёЄж—¶й—ґиЊѓе›ґз§°дёєдёЂдёЄвЂќеќ—пј€chunkпј‰вЂќ(дѕ‹е¦‚пјЊе¦‚жћњж•°жЌ®жєђжЊ‰е¤©е€†еЊєпјЊе€™дёєдёЂе¤©)гЂ‚ењЁдёЂдёЄеќ—дё­пјЊж•°жЌ®иў«е€†дёєдёЂдёЄж€–иЂ…е¤љдёЄвЂќж®µпј€segmentsпј‰вЂќгЂ‚жЇЏдёЄж®µжЇдёЂдёЄеЌ•з‹¬зљ„ж–‡д»¶пјЊдёЂи€¬жѓ…е†µдё‹з”±ж•°з™ѕдё‡жќЎж•°жЌ®з»„ж€ђгЂ‚з”±дєЋж®µиў«з»„з»‡ж€ђж—¶й—ґеќ—пјЊе› ж­¤жњ‰ж—¶е°†ж®µи§†дёєе­ењЁдєЋе¦‚дё‹ж—¶й—ґзєїдёЉжЇжњ‰её®еЉ©зљ„пјљ</p>

<p><img src="https://liulv.work/images/img/20201215181028.png" alt="20201215181028" /></p>

<p>дёЂдёЄж•°жЌ®жєђеЏЇиѓЅжњ‰е‡ дёЄж®µе€°е‡ еЌЃдё‡з”љи‡іе‡ з™ѕдё‡дёЄж®µгЂ‚жЇЏдёЄж®µйѓЅжЇењЁMiddleManagerдёЉе€›е»єзљ„пјЊдЅ†ж­¤ж—¶ж®µжЇеЏЇеЏзљ„е’ЊжњЄжЏђдє¤зљ„гЂ‚ж®µжћ„е»єиї‡зЁ‹еЊ…ж‹¬д»Ґдё‹ж­ҐйЄ¤пјЊж—ЁењЁз”џж€ђдёЂдёЄзґ§е‡‘дё”ж”ЇжЊЃеї«йЂџжџҐиЇўзљ„ж•°жЌ®ж–‡д»¶пјљ</p>

<ul>
  <li>иЅ¬жЌўдёєе€—ж јејЏ</li>
  <li>жћ„е»єдЅЌе›ѕзґўеј•</li>
  <li>дЅїз”ЁдёЌеђЊзљ„з®—жі•иї›иЎЊеЋ‹зј©
    <ul>
      <li>е­—з¬¦дёІе€—idе­е‚ЁжњЂе°ЏеЊ–зљ„е­—е…ёзј–з Ѓ</li>
      <li>еЇ№дЅЌе›ѕзґўеј•еЃљеЋ‹зј©</li>
      <li>ж‰Ђжњ‰е€—зљ„з±»ећ‹ж„џзџҐеЋ‹зј©</li>
    </ul>
  </li>
</ul>

:ET