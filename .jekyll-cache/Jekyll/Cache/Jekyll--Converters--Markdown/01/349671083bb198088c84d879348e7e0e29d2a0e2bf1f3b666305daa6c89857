I"­ş<h1 id="1-å®‰è£…å¯åŠ¨è®¿é—®">1. å®‰è£…å¯åŠ¨è®¿é—®</h1>

<p><strong>Step 1: ä¸‹è½½</strong></p>

<p>ä¸‹è½½åœ°å€ï¼šhttps://www.apache.org/dyn/closer.cgi?path=/druid/
ä¸‹è½½æœ€æ–°ç‰ˆçš„Druid</p>

<p><strong>Step 2: ä¸Šä¼ å¹¶è§£å‹</strong></p>

<p>ä¸Šä¼ åˆ°éƒ¨ç½²æœåŠ¡å™¨ä¸‹ï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æå–Druid</p>

<p>mkdir /var/lib/druid
tar -xzf apache-druid-0.20.0-bin.tar.gz -C /var/lib/druid</p>

<p><strong>Step 3:è®¾ç½®ç¯å¢ƒå˜é‡</strong></p>

<p>sudo echo â€˜export DRUID_HOME=/var/lib/druidâ€™Â Â» /etc/profile
source /etc/profile</p>

<p><strong>Step 4ï¼šå¯åŠ¨</strong>
cd $DRUID_HOME
./bin/start-micro-quickstart</p>

<p><strong>Step 4ï¼šè®¿é—®Druidæ§åˆ¶å°</strong></p>

<p>å¯ä»¥è®¿é—®http://ip:8888/unified-console.htmlæ¥Druidæ§åˆ¶å°ï¼Œæ§åˆ¶å°ç”±Druid Routerè¿›ç¨‹å¯åŠ¨ã€‚</p>

<h1 id="2-ä»æœ¬åœ°å¯¼å…¥æ•°æ®">2. ä»æœ¬åœ°å¯¼å…¥æ•°æ®</h1>

<h2 id="21-ä½¿ç”¨druidæ§åˆ¶å°-data-loaderæ¥åŠ è½½æ•°æ®">2.1. ä½¿ç”¨Druidæ§åˆ¶å°-Data Loaderæ¥åŠ è½½æ•°æ®</h2>

<p><strong>Step 1ï¼šè¿›å…¥Load data</strong></p>

<p>ç‚¹å‡»æ§åˆ¶å°ä¸­çš„ Load data</p>

<p><img src="https://liulv.work/images/img/20201209161135.png" alt="20201209161135" /></p>

<p><strong>Step 2ï¼šé€‰æ‹©æœ¬åœ°ç£ç›˜</strong></p>

<p>é€‰æ‹© Local disk ç„¶åç‚¹å‡» Connect data</p>

<p><img src="https://liulv.work/images/img/20201209161340.png" alt="20201209161340" /></p>

<p><strong>Step 3: è®¾ç½®Connect</strong></p>

<p>åœ¨ Base directory ä¸­è¾“å…¥ quickstart/tutorial/, åœ¨ File filter ä¸­è¾“å…¥ wikiticker-2015-09-12-sampled.json.gzã€‚ Base directory å’Œ File filter åˆ†å¼€æ˜¯å› ä¸ºå¯èƒ½éœ€è¦åŒæ—¶ä»å¤šä¸ªæ–‡ä»¶ä¸­æ‘„å–æ•°æ®ã€‚ç„¶åç‚¹å‡»applyç¡®ä¿æ‚¨çœ‹åˆ°çš„æ•°æ®æ˜¯æ­£ç¡®çš„ï¼Œå†ç‚¹å‡»Next: Parse data</p>

<p><img src="https://liulv.work/images/img/20201209161603.png" alt="20201209161603" /></p>

<p><img src="https://liulv.work/images/img/20201209161703.png" alt="20201209161703" /></p>

<p><strong>Step 4: è®¾ç½®Parse data</strong></p>

<p>è¾“å…¥æ ¼å¼è®¾ç½®json, ç‚¹å‡»ä¸‹ä¸€æ­¥</p>

<p><img src="https://liulv.work/images/img/20201209161858.png" alt="20201209161858" /></p>

<p><strong>Step 5: è®¾ç½®Parse time</strong></p>

<p>è®¾ç½®çš„åˆ†åŒºåˆ—ï¼Œè¿™æ˜¯é»˜è®¤è®¾ç½®timeåˆ—å³å¯ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥</p>

<p><img src="https://liulv.work/images/img/20201209162047.png" alt="20201209162047" /></p>

<p><strong>Step 6: è®¾ç½®è½¬æ¢</strong></p>

<p>å¯ç‚¹å‡»å¯¹åº”åˆ—ï¼Œè¿›è¡Œè°ƒæ•´è½¬æ¢ï¼Œè¿™é‡Œä¸éœ€è¦ä»»ä½•è½¬æ¢ï¼Œå¯ç›´æ¥ä¸‹ä¸€æ­¥</p>

<p><img src="https://liulv.work/images/img/20201209162311.png" alt="20201209162311" /></p>

<p><strong>Step 7: è®¾ç½®è¿‡æ»¤</strong></p>

<p>å¯ç‚¹å‡»å¯¹åº”åˆ—è¿›è¡Œè¿‡æ»¤è®¾ç½®ï¼Œè®¾ç½®è¿‡æ»¤å€¼ï¼Œè¿™é‡Œä¸éœ€è¦ä»»ä½•è¿‡æ»¤ï¼Œå¯ç›´æ¥ä¸‹ä¸€æ­¥</p>

<p><img src="https://liulv.work/images/img/20201209162435.png" alt="20201209162435" /></p>

<p><strong>Step 7: è°ƒæ•´schema-åˆ—åå’Œç±»å‹ç­‰</strong></p>

<p>å¯é€‰æ‹©å¯¹åº”åˆ—è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œå…¨éƒ¨ä½¿ç”¨jsoné»˜è®¤çš„ï¼Œå¯ç›´æ¥ä¸‹ä¸€æ­¥</p>

<p><img src="https://liulv.work/images/img/20201209162654.png" alt="20201209162654" /></p>

<p><strong>Step 8: è®¾ç½®åˆ†åŒº</strong></p>

<p>åˆ†åŒºç±»å‹å¯è®¾ç½®ç»Ÿä¸€çš„å’Œä»»æ„çš„ï¼Œè¿™é‡Œè®¾ç½®ç»Ÿä¸€çš„ï¼Œå¹¶ä¸”æŒ‰å¤©è¿›è¡Œåˆ†åŒº</p>

<p><img src="https://liulv.work/images/img/20201209162852.png" alt="20201209162852" /></p>

<p><strong>Step 9: è°ƒä¼˜è®¾ç½®</strong></p>

<p>è¿™é‡Œä¸è¿›è¡Œä»»ä½•ä¼˜åŒ–ï¼Œç›´æ¥ä¸‹ä¸€æ­¥æäº¤</p>

<p><img src="https://liulv.work/images/img/20201209163005.png" alt="20201209163005" /></p>

<p><strong>Step 10: æäº¤è®¾ç½®</strong></p>

<p>ä¿®æ”¹æ•°æ®æºåç§°</p>

<p><img src="https://liulv.work/images/img/20201209163119.png" alt="20201209163119" /></p>

<p><strong>Step 11: ä¿®æ”¹jsonè§„èŒƒ</strong></p>

<p>è¿™é‡Œæš‚æ—¶ä¸éœ€è¦ä¿®æ”¹ï¼Œç›´æ¥æäº¤å³å¯</p>

<p><img src="https://liulv.work/images/img/20201209163217.png" alt="20201209163217" /></p>

<p><strong>Step 12: æäº¤å®Œæˆä¼šè¿›å…¥åˆ°ä»»åŠ¡åˆ—è¡¨</strong></p>

<p><img src="https://liulv.work/images/img/20201209163811.png" alt="20201209163811" /></p>

<p>å¯ç‚¹å‡»è¯¦æƒ…æŒ‰é’®æŸ¥çœ‹è¿è¡Œæƒ…å†µ</p>

<p><img src="https://liulv.work/images/img/20201209163914.png" alt="20201209163914" /></p>

<p><img src="https://liulv.work/images/img/20201209164006.png" alt="20201209164006" /></p>

<p><strong>Step 13: æŸ¥çœ‹æ•°æ®æºå¹¶æŸ¥è¯¢æ•°æ®</strong></p>

<p>ç‚¹å‡»Datasourceæ˜¯å¦å·²ç»æ–°å¢wikiticker-test</p>

<p><img src="https://liulv.work/images/img/20201209164137.png" alt="20201209164137" /></p>

<p>ç‚¹å‡»Queryè¿›è¡Œæ•°æ®æŸ¥è¯¢</p>

<p><img src="https://liulv.work/images/img/20201209164235.png" alt="20201209164235" /></p>

<h2 id="22-ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼åŠ è½½æ•°æ®">2.2. ä½¿ç”¨å‘½ä»¤è¡Œæ–¹å¼åŠ è½½æ•°æ®</h2>

<p>ä¸ºäº†æ–¹ä¾¿ï¼Œåœ¨Druidçš„è½¯ä»¶åŒ…ä¸­æä¾›äº†ä¸€ä¸ªæ‰¹æ‘„å–çš„å¸®åŠ©è„šæœ¬ bin/post-index-task</p>

<p>è¯¥è„šæœ¬ä¼šå°†æ•°æ®æ‘„å–ä»»åŠ¡å‘å¸ƒåˆ°Druid Overlordå¹¶è½®è¯¢Druidï¼Œç›´åˆ°å¯ä»¥æŸ¥è¯¢æ•°æ®ä¸ºæ­¢ã€‚</p>

<p>åœ¨Druidæ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/wikipedia-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ä»¥ä¸‹çš„è¾“å‡ºï¼š</p>

<pre><code class="language-log">Beginning indexing data for wikipedia
Task started: index_wikipedia_2018-07-27T06:37:44.323Z
Task log:     http://localhost:8081/druid/indexer/v1/task/index_wikipedia_2018-07-27T06:37:44.323Z/log
Task status:  http://localhost:8081/druid/indexer/v1/task/index_wikipedia_2018-07-27T06:37:44.323Z/status
Task index_wikipedia_2018-07-27T06:37:44.323Z still running...
Task index_wikipedia_2018-07-27T06:37:44.323Z still running...
Task finished with status: SUCCESS
Completed indexing data for wikipedia. Now loading indexed data onto the cluster...
wikipedia loading complete! You may now query your data
</code></pre>

<p>æäº¤ä»»åŠ¡è§„èŒƒåï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä¸Šè¿°ç›¸åŒçš„è§„èŒƒç­‰å¾…æ•°æ®åŠ è½½ç„¶åæŸ¥è¯¢</p>

<h2 id="23-ä½¿ç”¨httpè¯·æ±‚åŠ è½½æ•°æ®">2.3. ä½¿ç”¨HTTPè¯·æ±‚åŠ è½½æ•°æ®</h2>

<p>æˆ‘ä»¬ç®€çŸ­åœ°è®¨è®ºä¸€ä¸‹å¦‚ä½•åœ¨ä¸ä½¿ç”¨è„šæœ¬çš„æƒ…å†µä¸‹æäº¤æ•°æ®æ‘„å–ä»»åŠ¡ï¼Œæ‚¨å°†ä¸éœ€è¦è¿è¡Œè¿™äº›å‘½ä»¤ã€‚</p>

<p>è¦æäº¤ä»»åŠ¡ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¸­é€šè¿‡ä»¥ä¸‹æ–¹å¼æäº¤ä»»åŠ¡åˆ°Druidï¼š</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">curl</span><span class="w"> </span><span class="nt">-X</span><span class="w"> </span><span class="s1">'POST'</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="s1">'Content-Type:application/json'</span><span class="w"> </span><span class="nt">-d</span><span class="w"> </span><span class="err">@</span><span class="nx">quickstart/tutorial/wikipedia-index.json</span><span class="w"> </span><span class="nx">http://localhost:8081/druid/indexer/v1/task</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>å½“ä»»åŠ¡æäº¤æˆåŠŸåä¼šæ‰“å°å‡ºæ¥ä»»åŠ¡çš„ID</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> {"task":"index_wikipedia_2018-06-09T21:30:32.802Z"}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ‚¨å¯ä»¥å¦‚ä¸Šæ‰€è¿°ä»æ§åˆ¶å°ç›‘è§†æ­¤ä»»åŠ¡çš„çŠ¶æ€</p>

<h1 id="3-æŸ¥è¯¢æ•°æ®">3. æŸ¥è¯¢æ•°æ®</h1>

<p>æœ¬æ•™ç¨‹å°†ä»¥Druid SQLå’ŒDruidçš„åŸç”ŸæŸ¥è¯¢æ ¼å¼çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åœ¨Apache Druidä¸­æŸ¥è¯¢æ•°æ®ã€‚</p>

<p>æœ¬æ•™ç¨‹å‡å®šæ‚¨å·²ç»å®Œæˆäº†æ‘„å–æ•™ç¨‹ä¹‹ä¸€ï¼Œå› ä¸ºæˆ‘ä»¬å°†æŸ¥è¯¢Wikipediaç¼–è¾‘æ ·ä¾‹æ•°æ®ã€‚</p>

<p>Druidæ”¯æŒSQLæŸ¥è¯¢ã€‚</p>

<p>è¯¥æŸ¥è¯¢æ£€ç´¢äº†2015å¹´9æœˆ12æ—¥è¢«ç¼–è¾‘æœ€å¤šçš„10ä¸ªç»´åŸºç™¾ç§‘é¡µé¢</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">page</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Edits</span>
<span class="k">FROM</span> <span class="n">wikipedia</span>
<span class="k">WHERE</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="o">&lt;=</span> <span class="nv">"__time"</span> <span class="k">AND</span> <span class="nv">"__time"</span> <span class="o">&lt;</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">page</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Edits</span> <span class="k">DESC</span>
<span class="k">LIMIT</span> <span class="mi">10</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è®©æˆ‘ä»¬æ¥çœ‹å‡ ç§ä¸åŒçš„æŸ¥è¯¢æ–¹æ³•</p>

<h2 id="31-é€šè¿‡æ§åˆ¶å°queryæŸ¥è¯¢">3.1. é€šè¿‡æ§åˆ¶å°QueryæŸ¥è¯¢</h2>

<p><img src="https://liulv.work/images/img/20201209165417.png" alt="20201209165417" /></p>

<h2 id="32-é€šè¿‡dsqlæŸ¥è¯¢sql">3.2. é€šè¿‡dsqlæŸ¥è¯¢SQL</h2>

<p>ä¸ºæ–¹ä¾¿èµ·è§ï¼ŒDruidè½¯ä»¶åŒ…ä¸­åŒ…æ‹¬äº†ä¸€ä¸ªSQLå‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼Œä½äºDruidæ ¹ç›®å½•ä¸­çš„ bin/dsql</p>

<p>è¿è¡Œ bin/dsql, å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š</p>

<p>Welcome to dsql, the command-line client for Druid SQL.
Type â€œ\hâ€ for help.
dsql&gt;</p>

<p><img src="https://liulv.work/images/img/20201209165626.png" alt="20201209165626" /></p>

<h2 id="33-é€šè¿‡httpæŸ¥è¯¢sql">3.3. é€šè¿‡HTTPæŸ¥è¯¢SQL</h2>

<p>SQLæŸ¥è¯¢ä½œä¸ºJSONé€šè¿‡HTTPæäº¤</p>

<p>æ•™ç¨‹åŒ…æ‹¬ä¸€ä¸ªç¤ºä¾‹æ–‡ä»¶, è¯¥æ–‡ä»¶quickstart/tutorial/wikipedia-top-pages-sql.jsonåŒ…å«ä¸Šé¢æ˜¾ç¤ºçš„SQLæŸ¥è¯¢, æˆ‘ä»¬å°†è¯¥æŸ¥è¯¢æäº¤ç»™Druid Brokerã€‚</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="err">curl -X 'POST' -H 'Content-Type:application/json' -d @quickstart/tutorial/wikipedia-top-pages-sql.json http://localhost:8888/druid/v2/sql
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="34-æ›´å¤šdruid-sqlç¤ºä¾‹">3.4. æ›´å¤šDruid SQLç¤ºä¾‹</h2>

<h3 id="341-æ—¶é—´æŸ¥è¯¢">3.4.1. æ—¶é—´æŸ¥è¯¢</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">FLOOR</span><span class="p">(</span><span class="n">__time</span> <span class="k">to</span> <span class="n">HOUR</span><span class="p">)</span> <span class="k">AS</span> <span class="n">HourTime</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">deleted</span><span class="p">)</span> <span class="k">AS</span> <span class="n">LinesDeleted</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209165956.png" alt="20201209165956" /></p>

<h3 id="342-èšåˆæŸ¥è¯¢">3.4.2. èšåˆæŸ¥è¯¢</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="n">channel</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">added</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">channel</span><span class="p">,</span> <span class="n">page</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="k">SUM</span><span class="p">(</span><span class="n">added</span><span class="p">)</span> <span class="k">DESC</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209170146.png" alt="20201209170146" /></p>

<h3 id="343-æŸ¥è¯¢åŸå§‹æ•°æ®">3.4.3. æŸ¥è¯¢åŸå§‹æ•°æ®</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">user</span><span class="p">,</span> <span class="n">page</span>
<span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 02:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 03:00:00'</span>
<span class="k">LIMIT</span> <span class="mi">5</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201209172941.png" alt="20201209172941" /></p>

<h3 id="344-æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’">3.4.4. æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</h3>

<p>ç‚¹å‡»è¿è¡Œæ—è¾¹â€¦ Explain SQL query</p>

<p><img src="https://liulv.work/images/img/20201209173045.png" alt="20201209173045" /></p>

<p><img src="https://liulv.work/images/img/20201209173114.png" alt="20201209173114" /></p>

<p>å¦‚æœæ‚¨ä»¥å…¶ä»–æ–¹å¼æŸ¥è¯¢ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨Druid SQLæŸ¥è¯¢ä¹‹å‰æ·»åŠ  EXPLAIN PLAN FOR æ¥è·å¾—æŸ¥è¯¢è®¡åˆ’ã€‚</p>

<p>ä½¿ç”¨ä¸Šè¾¹çš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p>

<p>EXPLAIN PLAN FOR SELECT page, COUNT(*) AS Edits FROM wikipedia WHERE â€œ__timeâ€ BETWEEN TIMESTAMP â€˜2015-09-12 00:00:00â€™ AND TIMESTAMP â€˜2015-09-13 00:00:00â€™ GROUP BY page ORDER BY Edits DESC LIMIT 10;</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">dsql</span><span class="o">&gt;</span> <span class="k">EXPLAIN</span> <span class="n">PLAN</span> <span class="k">FOR</span> <span class="k">SELECT</span> <span class="n">page</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Edits</span> <span class="k">FROM</span> <span class="n">wikipedia</span> <span class="k">WHERE</span> <span class="nv">"__time"</span> <span class="k">BETWEEN</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-12 00:00:00'</span> <span class="k">AND</span> <span class="nb">TIMESTAMP</span> <span class="s1">'2015-09-13 00:00:00'</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">page</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Edits</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
<span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="err">â”‚</span> <span class="n">PLAN</span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span class="err">â”‚</span>
<span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="err">â”‚</span> <span class="n">DruidQueryRel</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="err">{</span><span class="nv">"queryType"</span><span class="p">:</span><span class="nv">"topN"</span><span class="p">,</span><span class="nv">"dataSource"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"table"</span><span class="p">,</span><span class="nv">"name"</span><span class="p">:</span><span class="nv">"wikipedia"</span><span class="err">}</span><span class="p">,</span><span class="nv">"virtualColumns"</span><span class="p">:[],</span><span class="nv">"dimension"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"default"</span><span class="p">,</span><span class="nv">"dimension"</span><span class="p">:</span><span class="nv">"page"</span><span class="p">,</span><span class="nv">"outputName"</span><span class="p">:</span><span class="nv">"d0"</span><span class="p">,</span><span class="nv">"outputType"</span><span class="p">:</span><span class="nv">"STRING"</span><span class="err">}</span><span class="p">,</span><span class="nv">"metric"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"numeric"</span><span class="p">,</span><span class="nv">"metric"</span><span class="p">:</span><span class="nv">"a0"</span><span class="err">}</span><span class="p">,</span><span class="nv">"threshold"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="nv">"intervals"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"intervals"</span><span class="p">,</span><span class="nv">"intervals"</span><span class="p">:[</span><span class="nv">"2015-09-12T00:00:00.000Z/2015-09-13T00:00:00.001Z"</span><span class="p">]</span><span class="err">}</span><span class="p">,</span><span class="nv">"filter"</span><span class="p">:</span><span class="k">null</span><span class="p">,</span><span class="nv">"granularity"</span><span class="p">:</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"all"</span><span class="err">}</span><span class="p">,</span><span class="nv">"aggregations"</span><span class="p">:[</span><span class="err">{</span><span class="nv">"type"</span><span class="p">:</span><span class="nv">"count"</span><span class="p">,</span><span class="nv">"name"</span><span class="p">:</span><span class="nv">"a0"</span><span class="err">}</span><span class="p">],</span><span class="nv">"postAggregations"</span><span class="p">:[],</span><span class="nv">"context"</span><span class="p">:</span><span class="err">{}</span><span class="p">,</span><span class="nv">"descending"</span><span class="p">:</span><span class="k">false</span><span class="err">}</span><span class="p">],</span> <span class="n">signature</span><span class="o">=</span><span class="p">[</span><span class="err">{</span><span class="n">d0</span><span class="p">:</span><span class="n">STRING</span><span class="p">,</span> <span class="n">a0</span><span class="p">:</span><span class="n">LONG</span><span class="err">}</span><span class="p">])</span> <span class="err">â”‚</span>
<span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span class="n">Retrieved</span> <span class="mi">1</span> <span class="k">row</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">03</span><span class="n">s</span><span class="p">.</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="4-ç‰¹åˆ«æ³¨æ„1">4. ç‰¹åˆ«æ³¨æ„1</h1>

<p>Druid Hadoop Dockerå®‰è£…ä¹‹å‰éœ€è¦å…³é—­SELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>getenforce
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿”å›
Enforcing</p>

<p>æ‰§è¡Œå…³é—­SELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>setenforce 0
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/SELINUX=enforcing/SELINUX=disabled/g'</span> /etc/selinux/config
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æ£€æŸ¥SELinux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>getenforce
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="5-roll-upèšåˆæ“ä½œ">5. Roll-upèšåˆæ“ä½œ</h1>

<p>Apache Druidå¯ä»¥é€šè¿‡roll-upåœ¨æ•°æ®æ‘„å–é˜¶æ®µå¯¹åŸå§‹æ•°æ®è¿›è¡Œæ±‡æ€»ã€‚ Roll-upæ˜¯å¯¹é€‰å®šåˆ—é›†çš„ä¸€çº§èšåˆæ“ä½œï¼Œå®ƒå¯ä»¥å‡å°å­˜å‚¨æ•°æ®çš„å¤§å°ã€‚</p>

<p>æœ¬æ•™ç¨‹ä¸­å°†è®¨è®ºåœ¨ä¸€ä¸ªç¤ºä¾‹æ•°æ®é›†ä¸Šè¿›è¡Œroll-upçš„ç»“æœã€‚</p>

<p>æœ¬æ•™ç¨‹æˆ‘ä»¬å‡è®¾æ‚¨å·²ç»æŒ‰ç…§å•æœåŠ¡å™¨éƒ¨ç½²ä¸­æè¿°ä¸‹è½½äº†Druidï¼Œå¹¶è¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šã€‚</p>

<p>å®ŒæˆåŠ è½½æœ¬åœ°æ–‡ä»¶å’Œæ•°æ®æŸ¥è¯¢ä¸¤éƒ¨åˆ†å†…å®¹ä¹Ÿæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>

<h2 id="51-æ•°æ®å‡†å¤‡">5.1. æ•°æ®å‡†å¤‡</h2>

<p>ä½¿ç”¨ä¸€ä¸ªç½‘ç»œæµäº‹ä»¶æ•°æ®çš„å°æ ·æœ¬ï¼Œè¡¨ç¤ºåœ¨ç‰¹å®šæ—¶é—´å†…ä»æºåˆ°ç›®æ ‡IPåœ°å€çš„æµé‡çš„æ•°æ®åŒ…å’Œå­—èŠ‚è®¡æ•°ã€‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">9024</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:51Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">21133</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:59Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">5780</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6289</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:02:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">377</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">359971</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:03:29Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">10204</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:33:14Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">6289</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:33:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">93999</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-02T21:35:45Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"7.7.7.7"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"8.8.8.8"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">2818</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>ç¤ºä¾‹æ•°æ®åœ¨Druidå®‰è£…ç›®å½•<code class="language-plaintext highlighter-rouge">quickstart/tutorial/rollup-data.json</code>ä¸‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤æ¥å…¥æ•°æ®è§„èŒƒæ¥æ¥å…¥æ•°æ®ã€‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"spec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"dataSchema"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"dataSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup-tutorial"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dimensionsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"dimensions"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"srcIP"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"dstIP"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"timestampSpec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"column"</span><span class="p">:</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"format"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iso"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"metricsSpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"count"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"packets"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w"> </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"longSum"</span><span class="p">,</span><span class="w"> </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="p">,</span><span class="w"> </span><span class="nl">"fieldName"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"bytes"</span><span class="w"> </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nl">"granularitySpec"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"uniform"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"segmentGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"week"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"queryGranularity"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"minute"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"intervals"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"2018-01-01/2018-01-03"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"rollup"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ioConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"inputSource"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"local"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseDir"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"quickstart/tutorial"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"filter"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"rollup-data.json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"inputFormat"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"appendToExisting"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"tuningConfig"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"index_parallel"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsPerSegment"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5000000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"maxRowsInMemory"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">25000</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>é€šè¿‡åœ¨ granularitySpec é€‰é¡¹ä¸­è®¾ç½® rollup : true æ¥å¯ç”¨Roll-up</p>

<p>æ³¨æ„ï¼Œæˆ‘ä»¬å°†srcIPå’ŒdstIPå®šä¹‰ä¸ºç»´åº¦ï¼Œå°†packetså’Œbytesåˆ—å®šä¹‰ä¸ºäº†longSumç±»å‹çš„æŒ‡æ ‡ï¼Œå¹¶å°† queryGranularity é…ç½®å®šä¹‰ä¸º minuteã€‚</p>

<p>åŠ è½½è¿™äº›æ•°æ®åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨è¿™äº›å®šä¹‰ã€‚</p>

<h2 id="52-åŠ è½½æ•°æ®">5.2. åŠ è½½æ•°æ®</h2>

<p>åœ¨Druidçš„æ ¹ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/rollup-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>è„šæœ¬è¿è¡Œå®Œæˆä»¥åï¼Œæˆ‘ä»¬å°†æŸ¥è¯¢æ•°æ®ã€‚</p>

<p><img src="https://liulv.work/images/img/20201210145621.png" alt="20201210145621" /></p>

<h2 id="53-æŸ¥è¯¢æ•°æ®">5.3. æŸ¥è¯¢æ•°æ®</h2>

<p>ç°åœ¨è¿è¡Œ bin/dsql ç„¶åæ‰§è¡ŒæŸ¥è¯¢ select * from â€œrollup-tutorialâ€; æ¥æŸ¥çœ‹å·²ç»è¢«æ‘„å…¥çš„æ•°æ®</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="kt">root</span><span class="err">@</span><span class="kt">localhost</span><span class="w"> </span><span class="kt">apache</span><span class="nt">-druid-0</span><span class="mf">.20.0</span><span class="p">]</span><span class="c"># bin/dsql</span><span class="w">
</span><span class="nf">Welcome</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">dsql</span><span class="p">,</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">command-line</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">Druid</span><span class="w"> </span><span class="nx">SQL.</span><span class="w">
</span><span class="nf">Connected</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="p">[</span><span class="kt">http</span><span class="p">:</span><span class="nf">//localhost:8082/</span><span class="p">]</span><span class="o">.</span><span class="w">

</span><span class="kt">Type</span><span class="w"> </span><span class="s2">"\h"</span><span class="w"> </span><span class="kt">for</span><span class="w"> </span><span class="no">help.</span><span class="w">
</span><span class="kt">dsql</span><span class="err">&gt;</span><span class="w"> </span><span class="kt">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">from</span><span class="w"> </span><span class="s2">"rollup-tutorial"</span><span class="p">;</span><span class="w">
</span><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="nf">__time</span><span class="w">                   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">bytes</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">dstIP</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">packets</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">srcIP</span><span class="w">   </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">35937</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">3</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">286</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">366260</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">2</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">415</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">10204</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">1</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">â”‚</span><span class="w">      </span><span class="nx">49</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-02T21</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">100288</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">2</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">8.8.8.8</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">161</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">7.7.7.7</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-02T21</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w">   </span><span class="nx">2818</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">1</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">8.8.8.8</span><span class="w"> </span><span class="err">â”‚</span><span class="w">      </span><span class="nx">12</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">7.7.7.7</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">
</span><span class="kt">Retrieved</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="kt">rows</span><span class="w"> </span><span class="kt">in</span><span class="w"> </span><span class="mf">0.18</span><span class="nf">s.</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬æ¥çœ‹å‘ç”Ÿåœ¨ 2018-01-01T01:01 çš„ä¸‰æ¡åŸå§‹æ•°æ®ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:35Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">9024</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:51Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">255</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">21133</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="nl">"timestamp"</span><span class="p">:</span><span class="s2">"2018-01-01T01:01:59Z"</span><span class="p">,</span><span class="nl">"srcIP"</span><span class="p">:</span><span class="s2">"1.1.1.1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dstIP"</span><span class="p">:</span><span class="s2">"2.2.2.2"</span><span class="p">,</span><span class="nl">"packets"</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="nl">"bytes"</span><span class="p">:</span><span class="mi">5780</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™ä¸‰æ¡æ•°æ®å·²ç»è¢«roll upä¸ºä»¥ä¸‹ä¸€è¡Œæ•°æ®ï¼š</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="err">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="nf">__time</span><span class="w">                   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">bytes</span><span class="w">  </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">dstIP</span><span class="w">   </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">packets</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">srcIP</span><span class="w">   </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span class="w">
</span><span class="err">â”‚</span><span class="w"> </span><span class="mi">2018</span><span class="nt">-01-01T01</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">00.000</span><span class="nf">Z</span><span class="w"> </span><span class="err">â”‚</span><span class="w">  </span><span class="nx">35937</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">3</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">2.2.2.2</span><span class="w"> </span><span class="err">â”‚</span><span class="w">     </span><span class="nx">286</span><span class="w"> </span><span class="err">â”‚</span><span class="w"> </span><span class="nx">1.1.1.1</span><span class="w"> </span><span class="err">â”‚</span><span class="w">
</span><span class="err">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™è¾“å…¥çš„æ•°æ®è¡Œå·²ç»è¢«æŒ‰ç…§æ—¶é—´åˆ—å’Œç»´åº¦åˆ— {timestamp, srcIP, dstIP} åœ¨æŒ‡æ ‡åˆ— {packages, bytes} ä¸Šåšæ±‚å’Œèšåˆ.</p>

<p>åœ¨è¿›è¡Œåˆ†ç»„ä¹‹å‰ï¼ŒåŸå§‹è¾“å…¥æ•°æ®çš„æ—¶é—´æˆ³æŒ‰åˆ†é’Ÿè¿›è¡Œæ ‡è®°/å¸ƒå±€ï¼Œè¿™æ˜¯ç”±äºæ‘„å–è§„èŒƒä¸­çš„ â€œqueryGranularityâ€ï¼šâ€minuteâ€ è®¾ç½®é€ æˆçš„ã€‚ åŒæ ·ï¼Œ2018-01-01T01:02 æœŸé—´å‘ç”Ÿçš„è¿™ä¸¤èµ·äº‹ä»¶ä¹Ÿå·²ç»æ±‡æ€»ã€‚</p>

<h1 id="6-é…ç½®æ•°æ®ä¿ç•™è§„åˆ™">6. é…ç½®æ•°æ®ä¿ç•™è§„åˆ™</h1>

<p>å‡è®¾æˆ‘ä»¬æƒ³åˆ é™¤2015å¹´9æœˆ12æ—¥å‰12å°æ—¶çš„æ•°æ®ï¼Œä¿ç•™2015å¹´9æœˆ12æ—¥å12å°æ—¶çš„æ•°æ®ã€‚</p>

<p>è¿›å…¥åˆ°Datasourcesè§†å›¾ï¼Œç‚¹å‡»ç¼–è¾‘æŒ‰é’®-ç„¶åå†ç‚¹å‡»Edit retention rules</p>

<p><img src="https://liulv.work/images/img/20201210150714.png" alt="20201210150714" /></p>

<p>ä¸€ä¸ªè§„åˆ™é…ç½®çª—å£å‡ºç°äº†ï¼š</p>

<p><img src="https://liulv.work/images/img/20201210150821.png" alt="20201210150821" /></p>

<p>ç°åœ¨ç‚¹å‡» + New rule æŒ‰é’®ä¸¤æ¬¡</p>

<p>åœ¨ä¸Šè¾¹çš„è§„åˆ™æ¡†ä¸­ï¼Œé€‰æ‹© Load å’Œ by Interval ç„¶åè¾“å…¥åœ¨ by Interval æ—è¾¹çš„è¾“å…¥æ¡†ä¸­è¾“å…¥ 2015-09-12T12:00:00.000Z/2015-09-13T00:00:00.000Z, å‰¯æœ¬å¯ä»¥é€‰æ‹©ä¿æŒ2ï¼Œåœ¨ _default_tier ä¸­</p>

<p>åœ¨ä¸‹è¾¹çš„è§„åˆ™æ¡†ä¸­ï¼Œé€‰æ‹© Drop å’Œ forever</p>

<p>è§„åˆ™çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š</p>

<p><img src="https://liulv.work/images/img/20201210151143.png" alt="20201210151143" /></p>

<p>ç°åœ¨ç‚¹å‡» Next, è§„åˆ™é…ç½®è¿‡ç¨‹å°†è¦æ±‚æä¾›ç”¨æˆ·åå’Œæ³¨é‡Šï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ”¹æ—¥å¿—è®°å½•ã€‚æ‚¨å¯ä»¥åŒæ—¶è¾“å…¥æ•™ç¨‹ã€‚</p>

<p>ç°åœ¨ç‚¹å‡» Save, å¯ä»¥åœ¨Datasourcesè§†å›¾ä¸­çœ‹åˆ°æ–°çš„è§„åˆ™</p>

<p><img src="https://liulv.work/images/img/20201210151757.png" alt="20201210151757" /></p>

<p>ç»™é›†ç¾¤å‡ åˆ†é’Ÿæ—¶é—´åº”ç”¨è§„åˆ™æ›´æ”¹ï¼Œç„¶åè½¬åˆ°Druidæ§åˆ¶å°ä¸­çš„segmentsè§†å›¾ã€‚2015å¹´9æœˆ12æ—¥å‰12å°æ—¶çš„æ®µæ–‡ä»¶ç°å·²æ¶ˆå¤±</p>

<p><img src="https://liulv.work/images/img/20201210151931.png" alt="20201210151931" /></p>

<p>ç”Ÿæˆçš„ä¿ç•™è§„åˆ™é“¾å¦‚ä¸‹:</p>

<p>loadByInterval 2015-09-12T12/2015-09-13 (12 hours)
dropForever
loadForever (é»˜è®¤è§„åˆ™)
è§„åˆ™é“¾æ˜¯è‡ªä¸Šè€Œä¸‹è®¡ç®—çš„ï¼Œé»˜è®¤è§„åˆ™é“¾å§‹ç»ˆæ·»åŠ åœ¨åº•éƒ¨</p>

<p>æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ•™ç¨‹è§„åˆ™é“¾åœ¨æŒ‡å®šçš„12å°æ—¶é—´éš”å†…åŠ è½½æ•°æ®</p>

<p>å¦‚æœæ•°æ®ä¸åœ¨12å°æ—¶çš„é—´éš”å†…ï¼Œåˆ™è§„åˆ™é“¾ä¸‹ä¸€æ­¥å°†è®¡ç®— dropForeverï¼Œè¿™å°†åˆ é™¤ä»»ä½•æ•°æ®</p>

<p>dropForever ç»ˆæ­¢äº†è§„åˆ™é“¾ï¼Œæœ‰æ•ˆåœ°è¦†ç›–äº†é»˜è®¤çš„ loadForever è§„åˆ™ï¼Œåœ¨è¿™ä¸ªè§„åˆ™é“¾ä¸­æ°¸è¿œä¸ä¼šåˆ°è¾¾è¯¥è§„åˆ™</p>

<p>æ³¨æ„ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç‰¹å®šé—´éš”çš„åŠ è½½è§„åˆ™</p>

<p>ç›¸åï¼Œå¦‚æœå¸Œæœ›æ ¹æ®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸä¿ç•™æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œä¿ç•™ä»è¿‡å»3ä¸ªæœˆåˆ°ç°åœ¨3ä¸ªæœˆçš„æ•°æ®ï¼‰ï¼Œåˆ™åº”å®šä¹‰ä¸€ä¸ªå‘¨æœŸæ€§åŠ è½½è§„åˆ™</p>

<h1 id="7-æ•°æ®æ›´æ–°">7. æ•°æ®æ›´æ–°</h1>

<p>æœ¬æ•™ç¨‹æ¼”ç¤ºå¦‚ä½•æ›´æ–°ç°æœ‰æ•°æ®ï¼ŒåŒæ—¶å±•ç¤ºè¦†ç›–(Overwrite)å’Œè¿½åŠ (append)çš„ä¸¤ä¸ªæ–¹å¼ã€‚</p>

<h2 id="71-æ•°æ®è¦†ç›–overwrite">7.1. æ•°æ®è¦†ç›–Overwrite</h2>

<h3 id="711-åŠ è½½åˆå§‹æ•°æ®">7.1.1. åŠ è½½åˆå§‹æ•°æ®</h3>

<p>æœ¬èŠ‚æ•™ç¨‹ä½¿ç”¨çš„ä»»åŠ¡æ‘„å–è§„èŒƒä½äº quickstart/tutorial/updates-init-index.json, æœ¬è§„èŒƒä» quickstart/tutorial/updates-data.json è¾“å…¥æ–‡ä»¶åˆ›å»ºä¸€ä¸ªåç§°ä¸º updates-tutorial çš„æ•°æ®æº</p>

<p>æäº¤ä»»åŠ¡ï¼š</p>

<div class="language-powershell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">bin/post-index-task</span><span class="w"> </span><span class="nt">--file</span><span class="w"> </span><span class="nx">quickstart/tutorial/updates-init-index.json</span><span class="w"> </span><span class="nt">--url</span><span class="w"> </span><span class="nx">http://localhost:8081</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>æˆ‘ä»¬æœ‰ä¸‰ä¸ªåŒ…å«â€åŠ¨ç‰©â€ç»´åº¦å’Œâ€æ•°å­—â€æŒ‡æ ‡çš„åˆå§‹è¡Œï¼š</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="https://liulv.work/images/img/20201210153051.png" alt="20201210153051" /></p>

<h3 id="712-å°†æ—§æ•°æ®ä¸æ–°æ•°æ®åˆå¹¶å¹¶è¦†ç›–">7.1.2. å°†æ—§æ•°æ®ä¸æ–°æ•°æ®åˆå¹¶å¹¶è¦†ç›–</h3>

<p>ç°åœ¨æˆ‘ä»¬å°è¯•åœ¨ updates-tutorial æ•°æ®æºè¿½åŠ ä¸€äº›æ–°çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†ä» quickstart/tutorial/updates-data3.json å¢åŠ æ–°çš„æ•°æ®</p>

<p>quickstart/tutorial/updates-append-index.json ä»»åŠ¡è§„èŒƒé…ç½®ä¸ºä»ç°æœ‰çš„ updates-tutorial æ•°æ®æºå’Œ quickstart/tutorial/updates-data3.json æ–‡ä»¶è¯»å–æ•°æ®ï¼Œè¯¥ä»»åŠ¡å°†ç»„åˆæ¥è‡ªä¸¤ä¸ªè¾“å…¥æºçš„æ•°æ®ï¼Œç„¶åç”¨æ–°çš„ç»„åˆæ•°æ®è¦†ç›–åŸå§‹æ•°æ®ã€‚</p>

<p>æäº¤ä»»åŠ¡ï¼š</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">bin</span><span class="o">/</span><span class="n">post</span><span class="o">-</span><span class="k">index</span><span class="o">-</span><span class="n">task</span> <span class="c1">--file quickstart/tutorial/updates-append-index.json --url http://localhost:8081</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>æŸ¥è¯¢åˆå¹¶åçš„æ•°æ®</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å½“Druidå®Œæˆä»è¿™ä¸ªè¦†ç›–ä»»åŠ¡åŠ è½½æ–°æ®µæ—¶ï¼Œæ–°è¡Œå°†è¢«æ·»åŠ åˆ°æ•°æ®æºä¸­ã€‚è¯·æ³¨æ„ï¼Œâ€œLionâ€è¡Œå‘ç”Ÿäº†roll upï¼š</p>

<pre><code class="language-log">[root@localhost apache-druid-0.20.0]# bin/dsql

Welcome to dsql, the command-line client for Druid SQL.
Connected to [http://localhost:8082/].

Type "\h" for help.
dsql&gt; 
dsql&gt; 
dsql&gt; select * from "updates-tutorial";
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ __time                   â”‚ animal   â”‚ count â”‚ number â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2018-01-01T01:01:00.000Z â”‚ lion     â”‚     1 â”‚    300 â”‚
â”‚ 2018-01-01T01:01:00.000Z â”‚ tiger    â”‚     1 â”‚    100 â”‚
â”‚ 2018-01-01T03:01:00.000Z â”‚ aardvark â”‚     1 â”‚     42 â”‚
â”‚ 2018-01-01T03:01:00.000Z â”‚ giraffe  â”‚     1 â”‚  14124 â”‚
â”‚ 2018-01-01T05:01:00.000Z â”‚ mongoose â”‚     1 â”‚    737 â”‚
â”‚ 2018-01-01T06:01:00.000Z â”‚ snake    â”‚     1 â”‚   1234 â”‚
â”‚ 2018-01-01T07:01:00.000Z â”‚ octopus  â”‚     1 â”‚    115 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Retrieved 7 rows in 0.13s.
</code></pre>

<h3 id="713-è¿½åŠ æ•°æ®">7.1.3. è¿½åŠ æ•°æ®</h3>

<p>ç°åœ¨å°è¯•å¦ä¸€ç§è¿½åŠ æ•°æ®çš„æ–¹å¼</p>

<p>quickstart/tutorial/updates-append-index2.json ä»»åŠ¡è§„èŒƒä» quickstart/tutorial/updates-data4.json æ–‡ä»¶è¯»å–æ•°æ®ï¼Œç„¶åè¿½åŠ åˆ° updates-tutorial æ•°æ®æºã€‚æ³¨æ„åˆ°åœ¨è§„èŒƒä¸­ appendToExisting è®¾ç½®ä¸º true</p>

<p>æäº¤ä»»åŠ¡ï¼š</p>

<p>bin/post-index-task â€“file quickstart/tutorial/updates-append-index2.json â€“url http://localhost:8081</p>

<p>åŠ è½½æ–°æ•°æ®åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°â€octopusâ€åé¢é¢å¤–çš„ä¸¤è¡Œã€‚è¯·æ³¨æ„ï¼Œç¼–å·ä¸º222çš„æ–°â€bearâ€è¡Œå°šæœªä¸ç°æœ‰çš„bear-111è¡Œåˆå¹¶ï¼Œå› ä¸ºæ–°æ•°æ®ä¿å­˜åœ¨å•ç‹¬çš„æ®µä¸­ã€‚</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="nv">"updates-tutorial"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h1 id="8-åˆå¹¶æ®µæ–‡ä»¶">8. åˆå¹¶æ®µæ–‡ä»¶</h1>

:ET